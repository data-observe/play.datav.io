import{g9 as Me,au as ye,bU as de,av as Rt,a5 as Tr,dV as xt,r as U,ad as se,a$ as Ii,V as x,aU as ve,ay as Q,dj as Pi,a8 as Nr,aF as ki,aS as Ar,aQ as Z,ac as Ne,aa as Or,c1 as Bi,b5 as lt,aL as Ti,cq as Lr,ba as Ae,ab as Ce,aN as Oe,b as ut,cs as Ni,e5 as Ai,ga as Fr,gb as Oi,cu as Li,b3 as Fi,aG as zi,b0 as Xi,cr as Yi,gc as Ri,eG as Di,M as Gi,a9 as Vi,aP as _e,cW as Wi,cX as Hi,cY as Zt,cZ as ji,c_ as Ui,c$ as $i,aZ as Zi,d1 as zr,d2 as qi,bV as qt,bW as Kt,gd as Ki,bZ as Qt,cH as Jt,cI as _t,ge as Qi,gf as Xr,gg as Ji,gh as _i,gi as we,gj as ea,gk as ot,gl as he,gm as w,gn as Le,go as Re,gp as ta,gq as er,gr as St,gs as ra,gt as ie,gu as tr,gv as De,gw as ia,gx as rr,gy as aa,gz as na,gA as oa,gB as sa,gC as la,gD as ua,bX as ir,bk as Yr,a3 as fa,ar as ha,gE as Rr,dz as ca,ax as da,cx as va,gF as Dr,gG as Gr,gH as Vr,gI as ar,gJ as pa,gK as Wr}from"./index-3a76b207.js";import{D as ga,m as ya,N as ma,n as ba}from"./index-9076ce45.js";import"./useLandscapeMode-e7a72966.js";const xa=l=>new Me.Tooltip({offsetX:10,offsetY:10,itemTypes:["node"],trigger:l.node.tooltipTrigger??"mouseenter",getContent:t=>{const r=t.item.getModel(),i=document.createElement("div");i.style.width="fit-content",i.style.padding="0px 4px 0px 10px",i.style.fontSize="12px";let a="";return Object.keys(r.data).map(n=>{a+=`<li>${n}: ${r.data[n]}</li>`}),i.innerHTML=`
                <strong><h3>${r.label}</h3></strong>
                <ul>
                ${a}
                </ul>`,i}}),Sa=l=>{const e={nodes:[]};return Object.keys(l).map((r,i)=>{e.nodes.push({id:r,label:ye.upperFirst(r),order:i,style:{fill:de(l[r])}})}),new Me.Legend({data:e,align:"center",layout:"horizontal",position:"bottom-left",padding:[1,10,1,10],containerStyle:{fill:"rgba(255,255,255,0.2)",lineWidth:0},title:" ",titleConfig:{offsetY:-8}})};var pe=(l=>(l.GreaterThan=">",l.LowerThan="<",l.Equal="=",l.Regex="regex",l))(pe||{}),Dt=(l=>(l.And="AND",l.Or="OR",l))(Dt||{});const me="node-filter-",Ct="node-relation",Ca=({graph:l,dashboardId:e,panelId:t,onFilterRulesChange:r})=>{const i=Rt(),{isOpen:a,onOpen:n,onClose:o}=Tr(),[s,f]=xt(null),[u,h]=xt(null),[c,d]=U.useState([]),[p,v]=U.useState([]),[g,y]=U.useState(!1);U.useEffect(()=>{const T=l.getNodes(),L=l.getEdges();if(T.length>0){const H=T[0].getModel(),D=[];D.push({name:"label",type:typeof H.label}),Object.keys(H.data).forEach(ee=>{D.push({name:ee,type:typeof H.data[ee]})}),v(D)}if(L.length>0){const H=L[0].getModel(),D=[];Object.keys(H.data).forEach(ee=>{D.push({name:ee,type:typeof H.data[ee]})}),d(D)}const k=se.get(me+e+"-"+t);h(k??[]);const z=se.get(Ct+e+"-"+t);y(z)},[]);const m=(s==null?void 0:s.type)==="node"?p:c,b=()=>{if(u.length>=5){i({description:"you can't add more than 5 rules",status:"error",duration:2e3,isClosable:!0});return}f({id:new Date().getTime(),type:"node",key:p[0].name,operator:p[0].type=="string"?"regex":">",value:p[0].type=="string"?"":0,combination:"AND",disabled:!1})},S=()=>{if(s.operator!="regex"){if(!ye.isNumber(s.value)){i({description:"value must be numers",status:"warning",duration:2e3,isClosable:!0});return}}else if(s.value==""){i({description:"value can't be empty",status:"warning",duration:2e3,isClosable:!0});return}let T=!1,L;for(var k=0;k<u.length;k++)if(u[k].id==s.id){T=!0,L=k;break}if(T){const z=ye.cloneDeep(u);z[L]=s,h(z),f(null),se.set(me+e+"-"+t,z)}else{const z=[...u,s];h(z),f(null),se.set(me+e+"-"+t,z)}r()},I=T=>{const L=u.filter(k=>k.id!=T);h(L),se.set(me+e+"-"+t,L),r()},M=(T,L)=>{const k=u.findIndex(D=>D.id==T),z=[...u],H=z[k];z[k]=z[k+L],z[k+L]=H,h(z),se.set(me+e+"-"+t,z),i({description:`moved ${L==1?"down":"up"}`,status:"success",duration:1500,isClosable:!0}),r()},C=T=>{const L=u[T];L.disabled=!L.disabled;const k=ye.cloneDeep(u);h(k),se.set(me+e+"-"+t,k),r(k)},E=()=>{const T=m.find(L=>L.name==s.key);return T==null?void 0:T.type},B=T=>{f(L=>{L.type=T,L.key=(T=="node"?p:c)[0].name,L.operator=(T=="node"?p:c)[0].type=="string"?"regex":">",L.value=(T=="node"?p:c)[0].type=="string"?"":0})},P=T=>{f(L=>{L.key=T,L.operator=(T=="node"?p:c)[0].type=="string"?"regex":">"})},O=T=>{y(T.currentTarget.checked),se.set(Ct+e+"-"+t,T.currentTarget.checked),r()},Y=(s==null?void 0:s.operator)=="regex"?"enter a regex to match":"enter a number",[j]=Ii(Xi);return x.createElement(x.Fragment,null,x.createElement(ve,{label:"Filtering the nodes and edges you want to see"},x.createElement(Q,{cursor:"pointer",onClick:n},x.createElement(Pi,null))),x.createElement(ga,{placement:"left",onClose:o,isOpen:a},x.createElement(Nr,null),x.createElement(ya,{maxWidth:j?"350px":"200px"},x.createElement(ki,{px:"1",borderBottomWidth:"1px",p:"2"},x.createElement(Ar,{justifyContent:"space-between",alignItems:"center"},x.createElement(Z,{textStyle:"title"},"Filtering nodes and edges"),x.createElement(Ne,{fontWeight:"normal",size:"sm",cursor:"pointer",onClick:b},"New rule"))),x.createElement(Or,{px:"1"},s&&x.createElement(x.Fragment,null,x.createElement(Bi,{fontSize:"0.8rem",spacing:"1",mt:"1"},u.length!=0&&(s.combination=="AND"?x.createElement(Ne,{size:"xs",variant:"outline",colorScheme:"gray",onClick:()=>{f(T=>{T.combination="OR"})}},"AND"):x.createElement(Ne,{size:"xs",variant:"outline",colorScheme:"gray",onClick:()=>{f(T=>{T.combination="AND"})}},"OR")),x.createElement(Z,null,"Filter"),x.createElement(lt,{value:s.type,width:"fit-content",size:"xs",onChange:T=>{const L=T.currentTarget.value;B(L)}},x.createElement("option",{value:"node"},"Nodes"),x.createElement("option",{value:"edge"},"Edges")),x.createElement(Z,null," IF "),x.createElement(lt,{value:s.key,width:"fit-content",size:"xs",onChange:T=>{const L=T.currentTarget.value;P(L)}},m.map(T=>x.createElement("option",{value:T.name},T.name))),x.createElement(lt,{value:s.operator,width:"fit-content",size:"xs",onChange:T=>{const L=T.currentTarget.value,k=L=="regex"?"":0;f(z=>{z.operator=L,z.value=k})}},E()=="number"?x.createElement(x.Fragment,null," ",x.createElement("option",{value:">"},">"),x.createElement("option",{value:"="},"="),x.createElement("option",{value:"<"},"<")):x.createElement("option",{value:"regex"},"regex")),s.operator=="regex"?x.createElement(Ti,{variant:"flushed",value:s.value,size:"xs",width:"fit-content",placeholder:Y,onChange:T=>{const L=T.currentTarget.value;f(k=>{k.value=L})}}):x.createElement(ma,{size:"xs",width:"100px",variant:"flushed",value:s.value,onChange:T=>{const L=Number(T);f(k=>{k.value=L})}},x.createElement(ba,null)),x.createElement(Ne,{size:"xs",variant:"outline",onClick:S},x.createElement(Lr,null))),x.createElement(Ae,{mt:"3"})),x.createElement(Ce,{alignItems:"left",mt:"2",fontSize:"0.9rem",spacing:"1"},u==null?void 0:u.map((T,L)=>T.id!=(s==null?void 0:s.id)&&x.createElement(Oe,null,x.createElement(Z,null,L>0&&x.createElement(ut.span,{fontWeight:"bold",color:"brand.500"},T.combination)," Filter the ",x.createElement(ut.span,{fontWeight:"bold"},T.type),"s if its data attr ",x.createElement(ut.span,{fontWeight:"bold"},T.key," ",T.operator," ",T.value," ")),x.createElement(Oe,{opacity:"0.7"},L>0&&x.createElement(Q,{onClick:()=>M(T.id,-1),cursor:"pointer"},x.createElement(Ni,null)),L<u.length-1&&x.createElement(Q,{onClick:()=>M(T.id,1),cursor:"pointer"},x.createElement(Ai,null)),x.createElement(ve,{label:T.disabled?"this rule is disabled, click to enable":"this rule is enabled, click to disable"},x.createElement(Q,{onClick:()=>C(L),cursor:"pointer"},x.createElement(Fr,{color:T.disabled?"currentColor":"var(--chakra-colors-brand-500)"}))),x.createElement(Q,{onClick:()=>f(T),cursor:"pointer"},x.createElement(Oi,null)),x.createElement(ve,{label:"remove this rule"},x.createElement(Q,{onClick:()=>I(T.id),cursor:"pointer"},x.createElement(Li,null))))))),(u==null?void 0:u.length)>0&&x.createElement(x.Fragment,null,x.createElement(Ae,{my:"2"}),x.createElement(Oe,null,x.createElement(Z,{fontSize:"0.95rem"},"Show relation nodes of the results"),x.createElement(Fi,{defaultChecked:g,onChange:O}))),x.createElement(zi,{status:"success",position:"absolute",bottom:"0",left:"0",fontSize:"0.9rem"},x.createElement(Ce,{alignItems:"left",spacing:"1"},x.createElement(Z,{fontWeight:"600"},"Rules will be evaluated :"),x.createElement(Z,null,"1. ",x.createElement("strong",null,"from top to bottom"),"  e.g (((a AND b) OR c) AND d)"),x.createElement(Z,null,"2. ",x.createElement("strong",null,"from nodes to edges"),",  edges rules will be applied only if all of the nodes rules already be applied "),x.createElement(Z,null,"3. ",x.createElement("strong",null,"edges rules are applied on the result of nodes rules"),", e.g if the nodes rules caused Node A to be invisible, as a result it's edges A1 and A2 are also invisible, then the edges rules will be applied, but they will have no effects on the visible of A1, A2"),x.createElement(Z,null," ",x.createElement("strong",null,"Rules will be stored in your browser"),", so you will see them every time when opening this dashboard.")))))))},ft="press Esc to exit fisheye mode",wa=U.memo(({graph:l,dashboardId:e,panelId:t,data:r,onFilterRulesChange:i})=>{const[a,n]=U.useState(null),[o,s]=U.useState({text:"",display:"none",opacity:0}),f=()=>{if(!(!l||l.destroyed))if(l.get("canvas").setCursor("default"),a)l.removePlugin(a),l.setMode("default"),s({text:ft,display:"none",opacity:0}),n(null);else{s({text:ft,display:"block",opacity:1});const p=new Me.Fisheye({r:249,minR:100,maxR:500,d:3,delegateStyle:{fill:"#0f0",lineWidth:0,stroke:"#666"}});n(p),l.addPlugin(p)}},u=p=>{!l||l.destroyed||p.key==="Escape"&&(l.removePlugin(a),l.get("canvas").setCursor("default"),s({text:ft,display:"none",opacity:0}),n(null))};U.useEffect(()=>{if(l&&typeof window<"u")return window.addEventListener("keydown",u.bind(void 0)),window.removeEventListener("keydown",u.bind(void 0))},[l,a]);const h=()=>{if(!l||l.destroyed)return;const p=l.getZoom(),v=l.get("canvas"),g=v.getPointByClient(v.get("width")/2,v.get("height")/2),y=v.get("pixelRatio")||1,m=1+.05*5;m*p>5||l.zoom(m,{x:g.x/y,y:g.y/y})},c=()=>{if(!l||l.destroyed)return;const p=l.getZoom(),v=l.get("canvas"),g=v.getPointByClient(v.get("width")/2,v.get("height")/2),y=v.get("pixelRatio")||1,m=1-.05*5;m*p<.3||l.zoom(m,{x:g.x/y,y:g.y/y})},d=()=>{!l||l.destroyed||l.fitView(16)};return console.timeEnd("init node graph, time used: "),x.createElement(x.Fragment,null,x.createElement(Oe,{spacing:"3",className:"nodegraph-toolbar",position:"absolute",left:"10px",top:"7px",zIndex:"1000",opacity:"0.7",fontSize:"0.8rem"},x.createElement(ve,{label:"Zoom in"},x.createElement(Q,{cursor:"pointer",onClick:c},x.createElement(Yi,null))),x.createElement(ve,{label:"Fit to canvas"},x.createElement(Z,{cursor:"pointer",fontWeight:"600",onClick:d},"FIT")),x.createElement(ve,{label:"Zoom out"},x.createElement(Q,{cursor:"pointer",onClick:h},x.createElement(Lr,null))),x.createElement(ve,{label:"Fisheye magnifying,most useful when nodes squeezed together"},x.createElement(Q,{color:"currentcolor",cursor:"pointer",onClick:f},x.createElement(Ri,null))),x.createElement(Ca,{graph:l,dashboardId:e,panelId:t,onFilterRulesChange:i})),x.createElement(Q,{className:"nodegraph-menutip bordered",opacity:o.opacity,position:"absolute",right:"25px",width:"fit-content",top:"2px",borderRadius:"8px",transition:"all 0.2s linear",px:"2",py:"1",fontSize:"0.9rem"},o.text))}),Ea=U.memo(({data:l,size:e="sm",iconSize:t="0.9rem"})=>{const{isOpen:r,onOpen:i,onClose:a}=Tr();return x.createElement(x.Fragment,null,x.createElement(ve,{label:"click to view the help doc"},x.createElement(Q,{opacity:"0.7",position:"absolute",right:"10px",top:"8px",zIndex:"1000",cursor:"pointer",onClick:i,fontSize:t},x.createElement(Di,null))),x.createElement(Gi,{isOpen:r,onClose:a},x.createElement(Nr,null),x.createElement(Vi,{minWidth:"600px"},x.createElement(Or,null,l.map(n=>x.createElement(Q,{key:n.title},x.createElement(_e,null,x.createElement(Z,{textStyle:"title"},n.title)),x.createElement(Wi,{variant:"simple",size:e,mt:"2"},x.createElement(Hi,null,x.createElement(Zt,null,n.headers.map(o=>x.createElement(ji,{key:o},o)))),x.createElement(Ui,null,n.contents.map((o,s)=>x.createElement(Zt,{key:s},o.map((f,u)=>x.createElement($i,{key:u,fontWeight:u==0?600:450},f))))))))))))}),Ma=[{title:"Target selection",headers:["Action","Effect"],contents:[["Click on a node","Select the node"],["Double click on a node","Select the node and it's relational edges"],["Press and hold down Shift, then click on some nodes","Select several nodes"],["Press and hold down Shift, then press your mouse to swipe selecting a area","Select all nodes and edges in a area"]]}],Ia=l=>{const e=Rt();return Zi(),new Me.Menu({getContent(r){let i;if(r.target&&r.target.isCanvas&&r.target.isCanvas())return i="Canvas ContextMenu",`
                <div id="node-graph-canvas-context">
          <h3>${i}</h3>
          <ul>
          
            <li title='1'>Hide selected nodes and edges</li>
            <li title='2'>li 2</li>
            <li>li 3</li>
            <li>li 4</li>
            <li>li 5</li>
          </ul>
          </div>`;if(r.item){const a=r.item.getModel(),n=document.createElement("div");n.style.width="fit-content",n.style.padding="0px 4px 0px 10px",n.style.fontSize="14px";let o="";return l.node.menu.forEach(s=>{s.enable&&(o+=`<li id=${s.id} style="cursor:pointer;">${s.name}</li>`)}),n.innerHTML=`
                <strong><h3>${a.label} menu</h3></strong>
                <ul>
                ${o}
                </ul>`,n}},handleMenuClick:(r,i)=>{let a=l.node.menu.find(o=>o.id.toString()===r.id);const n=zr(a.event);ye.isFunction(n)?qi(n,i.getModel()):e({title:"Click node menu error",description:"The click function you defined is not valid",status:"error",duration:3e3,isClosable:!0})},offsetX:16+10,offsetY:0,itemTypes:["node"]})},Pa=U.memo(({selected:l,graph:e,panelId:t,dashboardId:r,onSelectChange:i,data:a})=>{const[n,o]=U.useState(!1),[s,f]=xt(null);U.useEffect(()=>{e&&c()},[a]);const u=()=>{const g=e.findAllByState("node","selected");g.forEach(m=>{e.hideItem(m),e.setItemState(m,"selected",!1)}),e.findAllByState("edge","selected").forEach(m=>{e.hideItem(m),e.setItemState(m,"selected",!1)}),i(!1),g.length>0&&o(!0)},h=g=>{const y=[],m=e.findAllByState("node","selected");m.forEach(b=>{y.push(b),g&&b.getNeighbors().forEach(S=>{y.push(S)})}),e.getNodes().forEach(b=>{y.includes(b)||(e.hideItem(b),e.setItemState(b,"selected",!1))}),i(!1),m.length>0&&o(!0)},c=()=>{e.getNodes().forEach(y=>{y.isVisible()||e.showItem(y)}),o(!1)},d=()=>{f(p)},p=()=>{const g=[];return e.getNodes().forEach(m=>{m.isVisible()||g.push(m)}),g},v=g=>{const y=[];s.forEach((m,b)=>{b!==g?y.push(m):e.showItem(m)}),y.length==0?(f(null),o(!1)):f(y)};return x.createElement(x.Fragment,null,x.createElement(Ce,{position:"absolute",top:"9px",left:"140px",opacity:"0.7",fontSize:"1rem",className:"bordered-left",pl:"2",zIndex:"2000"},l&&x.createElement(qt,{trigger:"hover",onOpen:d},x.createElement(Kt,null,x.createElement(Q,{cursor:"pointer",color:"brand.500"},x.createElement(Ki,null))),x.createElement(Qt,{width:"240px"},x.createElement(Jt,null),x.createElement(_t,null,x.createElement(Ce,{alignItems:"left",spacing:1},x.createElement(Z,{cursor:"pointer",className:"hover-bg",p:"1",onClick:()=>h(!0)},"只显示选择的目标及关联节点"),x.createElement(Ae,null),x.createElement(Z,{cursor:"pointer",className:"hover-bg",p:"1",onClick:()=>h(!1)},"只显示选择的目标节点"),x.createElement(Ae,null),x.createElement(Z,{cursor:"pointer",className:"hover-bg",p:"1",onClick:()=>u()},"隐藏所选择的目标"))))),!l&&n&&x.createElement(ve,{label:"显示被隐藏的目标"},x.createElement(qt,{trigger:"hover",onOpen:d},x.createElement(Kt,null,x.createElement(Q,{cursor:"pointer",color:"brand.500"},x.createElement(Fr,{color:"brand.500"}))),x.createElement(Qt,{width:"240px"},x.createElement(Jt,null),x.createElement(_t,null,x.createElement(Ar,{justifyContent:"space-between"},x.createElement(Z,null,"被隐藏的目标"),x.createElement(Ne,{size:"xs",onClick:c},"显示全部")),x.createElement(Ae,{pt:"2"}),x.createElement(Z,{fontSize:"0.8rem",my:"2",fontWeight:"600"},"点击所在的行, 可移除隐藏"),x.createElement(Ce,{alignItems:"left",mt:"3",p:"0",spacing:"1"},s&&s.map((g,y)=>x.createElement(Oe,{key:g.getID(),spacing:"3",className:"hover-bg",px:"2",py:"1",cursor:"pointer",onClick:()=>v(y)},x.createElement(Z,{fontSize:"0.8rem",fontWeight:"600"},g.getModel().label))))))))))}),et=(l,e,t,r)=>{const{nodes:i,edges:a}=l,n=r??se.get(me+e+"-"+t);if(ye.isEmpty(n))return l;console.time("filter data in node graph, time used:");const o=Ba(i,n),s=ka(a,n);if(o.length!=i.length&&se.get(Ct+e+"-"+t)){const u=new Map;a.forEach(c=>{const d=u[c.source];d?d.push(c.target):u[c.source]=[c.target];const p=u[c.target];p?p.push(c.source):u[c.target]=[c.source]});const h=[];for(const c of o){const d=u[c.id];d==null||d.forEach(p=>{h.includes(p)||h.push(p)})}for(const c of h){const d=i.find(p=>p.id==c);o.push(d)}}return console.timeEnd("filter data in node graph, time used:"),{nodes:o,edges:s}},ka=(l,e)=>l.filter(t=>{let r=!0,i=!0;for(let a=0;a<e.length;a++){const n=e[a];if(n.disabled||n.type!="edge")continue;let o=!0;const s=t.data[n.key];switch(n.operator){case pe.GreaterThan:o=s>n.value;break;case pe.LowerThan:o=s<n.value;break;case pe.Equal:o=s==n.value;break;case pe.Regex:o=s.match(n.value)!=null;break}i||n.combination==Dt.And?r=r&&o:r=r||o,i&&(i=!1)}return r}),Ba=(l,e)=>l.filter(t=>{let r=!0,i=!0;for(let a=0;a<e.length;a++){const n=e[a];if(n.disabled||n.type!="node")continue;let o=!0;if(n.key=="label")t.label.match(n.value)==null&&(o=!1);else{const s=t.data[n.key];switch(n.operator){case pe.GreaterThan:o=s>n.value;break;case pe.LowerThan:o=s<n.value;break;case pe.Equal:o=s==n.value;break;case pe.Regex:o=s.match(n.value)!=null;break}}i||n.combination==Dt.And?r=r&&o:r=r||o,i&&(i=!1)}return r});var Ta={}.toString,Ie=function(l,e){return Ta.call(l)==="[object "+e+"]"};const ze=function(l){return Ie(l,"Function")};var ne=function(l){return l==null};const W=function(l){return Array.isArray?Array.isArray(l):Ie(l,"Array")},Fe=function(l){var e=typeof l;return l!==null&&e==="object"||e==="function"};function F(l,e){if(l){var t;if(W(l))for(var r=0,i=l.length;r<i&&(t=e(l[r],r),t!==!1);r++);else if(Fe(l)){for(var a in l)if(l.hasOwnProperty(a)&&(t=e(l[a],a),t===!1))break}}}var Na=function(l){return typeof l=="object"&&l!==null},re=function(l){if(!Na(l)||!Ie(l,"Object"))return!1;if(Object.getPrototypeOf(l)===null)return!0;for(var e=l;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(l)===e};const A=function(l){return Ie(l,"String")};var Aa=Object.prototype.hasOwnProperty;function nr(l,e){if(!e||!W(l))return{};for(var t={},r=ze(e)?e:function(o){return o[e]},i,a=0;a<l.length;a++){var n=l[a];i=r(n),Aa.call(t,i)?t[i].push(n):t[i]=[n]}return t}function Oa(l,e){if(l["_wrap_"+e])return l["_wrap_"+e];var t=function(r){l[e](r)};return l["_wrap_"+e]=t,t}var R=function(l){return Ie(l,"Number")},La=Object.values?function(l){return Object.values(l)}:function(l){var e=[];return F(l,function(t,r){ze(l)&&r==="prototype"||e.push(t)}),e};const Fa=function(l){return ne(l)?"":l.toString()};var wt=function(l){var e=Fa(l);return e.charAt(0).toUpperCase()+e.substring(1)},Hr=function(l){return Ie(l,"Boolean")};function ht(l,e){for(var t in e)e.hasOwnProperty(t)&&t!=="constructor"&&e[t]!==void 0&&(l[t]=e[t])}function $(l,e,t,r){return e&&ht(l,e),t&&ht(l,t),r&&ht(l,r),l}var V=function(l){if(typeof l!="object"||l===null)return l;var e;if(W(l)){e=[];for(var t=0,r=l.length;t<r;t++)typeof l[t]=="object"&&l[t]!=null?e[t]=V(l[t]):e[t]=l[t]}else{e={};for(var i in l)typeof l[i]=="object"&&l[i]!=null?e[i]=V(l[i]):e[i]=l[i]}return e};function za(l,e,t){var r;return function(){var i=this,a=arguments,n=function(){r=null,t||l.apply(i,a)},o=t&&!r;clearTimeout(r),r=setTimeout(n,e),o&&l.apply(i,a)}}const Xa=function(l,e){if(!ze(l))throw new TypeError("Expected a function");var t=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var a=e?e.apply(this,r):r[0],n=t.cache;if(n.has(a))return n.get(a);var o=l.apply(this,r);return n.set(a,o),o};return t.cache=new Map,t};var Ya=5;function jr(l,e,t,r){t=t||0,r=r||Ya;for(var i in e)if(e.hasOwnProperty(i)){var a=e[i];a!==null&&re(a)?(re(l[i])||(l[i]={}),t<r?jr(l[i],a,t+1,r):l[i]=e[i]):W(a)?(l[i]=[],l[i]=l[i].concat(a)):a!==void 0&&(l[i]=a)}}var _=function(l){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];for(var r=0;r<e.length;r+=1)jr(l,e[r]);return l};const Ra=function(l,e,t){for(var r=0,i=A(e)?e.split("."):e;l&&r<i.length;)l=l[i[r++]];return l===void 0||r<i.length?t:l},Da=function(l,e,t){var r,i,a,n,o=0;t||(t={});var s=function(){o=t.leading===!1?0:Date.now(),r=null,n=l.apply(i,a),r||(i=a=null)},f=function(){var u=Date.now();!o&&t.leading===!1&&(o=u);var h=e-(u-o);return i=this,a=arguments,h<=0||h>e?(r&&(clearTimeout(r),r=null),o=u,n=l.apply(i,a),r||(i=a=null)):!r&&t.trailing!==!1&&(r=setTimeout(s,h)),n};return f.cancel=function(){clearTimeout(r),o=0,r=i=a=null},f};var Ge;Xa(function(l,e){e===void 0&&(e={});var t=e.fontSize,r=e.fontFamily,i=e.fontWeight,a=e.fontStyle,n=e.fontVariant;return Ge||(Ge=document.createElement("canvas").getContext("2d")),Ge.font=[a,n,i,t+"px",r].join(" "),Ge.measureText(A(l)?l:"").width},function(l,e){return e===void 0&&(e={}),Qi([l],La(e)).join("")});const Ga={getDefaultCfg:function(){return{}},getEvents:function(){return{}},updateCfg:function(e){return Object.assign(this,e),!0},shouldBegin:function(){return!0},shouldUpdate:function(){return!0},shouldEnd:function(){return!0},bind:function(e){var t=this,r=this.events;this.graph=e,(this.type==="drag-canvas"||this.type==="brush-select"||this.type==="lasso-select")&&e.get("canvas").set("draggable",!0),F(r,function(i,a){e.on(a,i)}),document.addEventListener("visibilitychange",function(){t.keydown=!1})},unbind:function(e){var t=this.events,r=e.get("canvas").get("draggable");(this.type==="drag-canvas"||this.type==="brush-select"||this.type==="lasso-select")&&e.get("canvas").set("draggable",!1),F(t,function(i,a){e.off(a,i)}),e.get("canvas").set("draggable",r)},get:function(e){return this[e]},set:function(e,t){return this[e]=t,this}};var Ur=function(){function l(){}return l.registerBehavior=function(e,t){if(!t)throw new Error("please specify handler for this behavior: ".concat(e));var r=V(Ga);Object.assign(r,t);var i=function(n){var o=this;Object.assign(this,this.getDefaultCfg(),n);var s=this.getEvents();this.events=null;var f={};s&&(F(s,function(u,h){f[h]=Oa(o,u)}),this.events=f)};i.prototype=r,l.types[e]=i},l.hasBehavior=function(e){return!!l.types[e]},l.getBehavior=function(e){return l.types[e]},l.types={},l}(),tt=ot,Va=function(e){return function(t,r){return t[e]-r[e]}},or=function(e,t,r){return e>=t&&e<=r},st=function(e,t,r,i){var a=1e-4,n={x:r.x-e.x,y:r.y-e.y},o={x:t.x-e.x,y:t.y-e.y},s={x:i.x-r.x,y:i.y-r.y},f=o.x*s.y-o.y*s.x,u=f*f,h=1/f,c=o.x*o.x+o.y*o.y,d=s.x*s.x+s.y*s.y;if(u>a*c*d){var p=(n.x*s.y-n.y*s.x)*h,v=(n.x*o.y-n.y*o.x)*h;return!or(p,0,1)||!or(v,0,1)?null:{x:e.x+p*o.x,y:e.y+p*o.y}}return null},$r=function(e,t){var r=e.x,i=e.y,a=e.width,n=e.height,o=r+a/2,s=i+n/2,f=[],u={x:o,y:s};f.push({x:r,y:i}),f.push({x:r+a,y:i}),f.push({x:r+a,y:i+n}),f.push({x:r,y:i+n}),f.push({x:r,y:i});for(var h=null,c=1;c<f.length&&(h=st(f[c-1],f[c],u,t),!h);c++);return h},Zr=function(e,t){var r=e.x,i=e.y,a=e.r,n=t.x,o=t.y,s=n-r,f=o-i;if(s*s+f*f<a*a)return null;var u=Math.atan(f/s);return{x:r+Math.abs(a*Math.cos(u))*Math.sign(s),y:i+Math.abs(a*Math.sin(u))*Math.sign(f)}},qr=function(e,t){var r=e.rx,i=e.ry,a=e.x,n=e.y,o=t.x-a,s=t.y-n,f=Math.atan2(s/i,o/r);return f<0&&(f+=2*Math.PI),{x:a+r*Math.cos(f),y:n+i*Math.sin(f)}},Ee=function(e,t,r){r===void 0&&(r=1);var i=[e.x,e.y,r];return(!t||isNaN(t[0]))&&(t=[1,0,0,0,1,0,0,0,1]),Xr(i,i,t),{x:i[0],y:i[1]}},Kr=function(e,t,r){r===void 0&&(r=1),(!t||isNaN(t[0]))&&(t=[1,0,0,0,1,0,0,0,1]);var i=Ji([1,0,0,0,1,0,0,0,1],t);i||(i=[1,0,0,0,1,0,0,0,1]);var a=[e.x,e.y,r];return Xr(a,a,i),{x:a[0],y:a[1]}},Et=function(e,t,r){var i=e.x-t.x,a=e.y-t.y,n=e.x-r.x,o=e.y-r.y,s=(e.x*e.x-t.x*t.x-t.y*t.y+e.y*e.y)/2,f=(e.x*e.x-r.x*r.x-r.y*r.y+e.y*e.y)/2,u=a*n-i*o;return{x:-(o*s-a*f)/u,y:-(i*f-n*s)/u}},rt=function(e,t){var r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)},Wa=function(e,t){var r=[];return e.forEach(function(i){var a=[];i.forEach(function(n){a.push(n*t)}),r.push(a)}),r},Ha=function(e){for(var t=[],r=e.length,i=0;i<r;i+=1){t[i]=[];for(var a=0;a<r;a+=1)i===a?t[i][a]=0:e[i][a]===0||!e[i][a]?t[i][a]=1/0:t[i][a]=e[i][a]}for(var n=0;n<r;n+=1)for(var i=0;i<r;i+=1)for(var a=0;a<r;a+=1)t[i][a]>t[i][n]+t[n][a]&&(t[i][a]=t[i][n]+t[n][a]);return t},ja=function(e,t){var r=e.nodes,i=e.edges,a=[],n={};if(!r)throw new Error("invalid nodes data!");return r&&r.forEach(function(o,s){n[o.id]=s;var f=[];a.push(f)}),i&&i.forEach(function(o){var s=o.source,f=o.target,u=n[s],h=n[f];a[u][h]=1,t||(a[h][u]=1)}),a},Qr=function(e,t){e.translate(t.x,t.y)},Mt=function(e,t,r,i){i===void 0&&(i={duration:500});var a=e.getMatrix();a||(a=[1,0,0,0,1,0,0,0,1]);var n=e.getCanvasBBox(),o=t.x-n.minX,s=t.y-n.minY;if(r){var f=o*a[0],u=s*a[4],h=0,c=0,d=0,p=0;e.animate(function(g){return d=f*g,p=u*g,a=tt(a,[["t",d-h,p-c]]),h=d,c=p,{matrix:a}},i)}else{var v=tt(a,[["t",o,s]]);e.setMatrix(v)}},Ua=function(e,t){var r=e.getMatrix();r||(r=[1,0,0,0,1,0,0,0,1]);var i=t;W(t)||(i=[t,t]),W(t)&&t.length===1&&(i=[t[0],t[0]]),r=tt(r,[["s",i[0],i[1]]]),e.setMatrix(r)},$a=function(e,t){var r=e.getMatrix();r||(r=[1,0,0,0,1,0,0,0,1]),r=tt(r,[["r",t]]),e.setMatrix(r)},Za=function(e,t,r){for(var i=[],a=0;a<e;a++)i[a]=0;return r.forEach(function(n){n.source&&(i[t[n.source]]+=1),n.target&&(i[t[n.target]]+=1)}),i};function qa(l,e,t){return(t[0]-l[0])*(e[1]-l[1])===(e[0]-l[0])*(t[1]-l[1])&&Math.min(l[0],e[0])<=t[0]&&t[0]<=Math.max(l[0],e[0])&&Math.min(l[1],e[1])<=t[1]&&t[1]<=Math.max(l[1],e[1])}var Xe=function(e,t,r){var i=!1,a=e.length,n=1e-6;function o(h){return Math.abs(h)<n?0:h<0?-1:1}if(a<=2)return!1;for(var s=0;s<a;s++){var f=e[s],u=e[(s+1)%a];if(qa(f,u,[t,r]))return!0;o(f[1]-r)>0!=o(u[1]-r)>0&&o(t-(r-f[1])*(f[0]-u[0])/(f[1]-u[1])-f[0])<0&&(i=!i)}return i},Jr=function(e,t){return!(t.minX>e.maxX||t.maxX<e.minX||t.minY>e.maxY||t.maxY<e.minY)},Ka=function(e,t){var r=!1;return F(e,function(i){if(st(i.from,i.to,t.from,t.to))return r=!0,!1}),r},_r=function(e,t){var r=function(c){var d=c.map(function(v){return v[0]}),p=c.map(function(v){return v[1]});return{minX:Math.min.apply(null,d),maxX:Math.max.apply(null,d),minY:Math.min.apply(null,p),maxY:Math.max.apply(null,p)}},i=function(c){for(var d=[],p=c.length,v=0;v<p-1;v++){var g=c[v],y=c[v+1];d.push({from:{x:g[0],y:g[1]},to:{x:y[0],y:y[1]}})}if(d.length>1){var m=c[0],b=c[p-1];d.push({from:{x:b[0],y:b[1]},to:{x:m[0],y:m[1]}})}return d};if(e.length<2||t.length<2)return!1;var a=r(e),n=r(t);if(!Jr(a,n))return!1;var o=!1;if(F(t,function(h){if(Xe(e,h[0],h[1]))return o=!0,!1}),o||(F(e,function(h){if(Xe(t,h[0],h[1]))return o=!0,!1}),o))return!0;var s=i(e),f=i(t),u=!1;return F(f,function(h){if(Ka(s,h))return u=!0,!1}),u},be=function(){function l(e,t,r,i){this.x1=e,this.y1=t,this.x2=r,this.y2=i}return l.prototype.getBBox=function(){var e=Math.min(this.x1,this.x2),t=Math.min(this.y1,this.y2),r=Math.max(this.x1,this.x2),i=Math.max(this.y1,this.y2),a={x:e,y:t,minX:e,minY:t,maxX:r,maxY:i,width:r-e,height:i-t};return a},l}(),Gt=function(e,t){var r={top:[e.minX,e.minY,e.maxX,e.minY],left:[e.minX,e.minY,e.minX,e.maxY],bottom:[e.minX,e.maxY,e.maxX,e.maxY],right:[e.maxX,e.minY,e.maxX,e.maxY]};return r[t]},Qa=function(e,t){var r=(t.x2-t.x1)*(e.y1-t.y1)-(t.y2-t.y1)*(e.x1-t.x1),i=(e.x2-e.x1)*(e.y1-t.y1)-(e.y2-e.y1)*(e.x1-t.x1),a=(t.y2-t.y1)*(e.x2-e.x1)-(t.x2-t.x1)*(e.y2-e.y1);if(a){var n=r/a,o=i/a;if(n>=0&&n<=1&&o>=0&&o<=1)return n}return Number.POSITIVE_INFINITY},ei=function(e,t){for(var r=["top","left","bottom","right"],i=e.getBBox(),a=0,n=[],o=0;o<4;o++){var s=Gt(i,r[o]),f=s[0],u=s[1],h=s[2],c=s[3];n[o]=st({x:t.x1,y:t.y1},{x:t.x2,y:t.y2},{x:f,y:u},{x:h,y:c}),n[o]&&(a+=1)}return[n,a]},Vt=function(e,t){for(var r=["top","left","bottom","right"],i=e.getBBox(),a=Number.POSITIVE_INFINITY,n=0,o=0;o<4;o++){var s=Gt(i,r[o]),f=s[0],u=s[1],h=s[2],c=s[3],d=Qa(t,new be(f,u,h,c));d=Math.abs(d-.5),d>=0&&d<=1&&(n+=1,a=d<a?d:a)}return n===0?-1:a},ti=function(e){var t=0,r=0;if(e.length>0){for(var i=0,a=e;i<a.length;i++){var n=a[i];t+=n.x,r+=n.y}t/=e.length,r/=e.length}return{x:t,y:r}},it=function(e,t){return Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)},ri=function(e,t){var r=t.x1,i=t.y1,a=t.x2-r,n=t.y2-i,o=e.x-r,s=e.y-i,f=o*a+s*n,u;f<=0?u=0:(o=a-o,s=n-s,f=o*a+s*n,f<=0?u=0:u=f*f/(a*a+n*n));var h=o*o+s*s-u;return h<0&&(h=0),h},It=function(e,t,r){return r===void 0&&(r=.001),Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)<Math.pow(r,2)},ii=function(e,t){var r=e.x<t.x,i=e.x>t.x+t.width,a=e.y>t.y+t.height,n=e.y<t.y,o=r||i||a||n;if(!o)return 0;if(a&&!r&&!i)return Math.pow(t.y+t.height-e.y,2);if(n&&!r&&!i)return Math.pow(e.y-t.y,2);if(r&&!a&&!n)return Math.pow(t.x-e.x,2);if(i&&!a&&!n)return Math.pow(t.x+t.width-e.x,2);var s=Math.min(Math.abs(t.x-e.x),Math.abs(t.x+t.width-e.x)),f=Math.min(Math.abs(t.y-e.y),Math.abs(t.y+t.height-e.y));return s*s+f*f},Ja=function(e,t){var r=e[0],i=e[1],a=e[2],n=e[3],o=t.x,s=t.y,f=[a-r,n-i];if(_i(f,[0,0]))return NaN;var u=[-f[1],f[0]];we(u,u);var h=[o-r,s-i];return Math.abs(ea(h,u))},Wt=function(e,t,r){return e+(t-e)*r},Pt=function(e,t,r){for(var i=Math.min(e.length,t.length),a=new Array(i),n=0;n<i;n++)a[n]=Wt(e[n],t[n],r);return a};const _a=Object.freeze(Object.defineProperty({__proto__:null,Line:be,applyMatrix:Ee,compare:Va,distance:rt,floydWarshall:Ha,fractionToLine:Vt,getAdjMatrix:ja,getBBoxBoundLine:Gt,getCircleCenterByPoints:Et,getCircleIntersectByPoint:Zr,getDegree:Za,getEllipseIntersectByPoint:qr,getLineIntersect:st,getPointsCenter:ti,getRectIntersectByPoint:$r,intersectBBox:Jr,invertMatrix:Kr,isPointInPolygon:Xe,isPointsOverlap:It,isPolygonsIntersect:_r,itemIntersectByLine:ei,lerp:Wt,lerpArray:Pt,move:Mt,pointLineDistance:Ja,pointLineSquareDist:ri,pointRectSquareDist:ii,rotate:$a,scale:Ua,scaleMatrix:Wa,squareDist:it,translate:Qr},Symbol.toStringTag,{value:"Module"}));var ge="rgb(95, 149, 255)",en="rgb(255, 255, 255)",sr="rgb(0, 0, 0)",ct="rgb(247, 250, 255)",ai="rgb(239, 244, 255)",Ve="rgb(253, 253, 253)",lr="rgb(250, 250, 250)",We="rgb(224, 224, 224)",ur="rgb(234, 234, 234)",tn="rgb(245, 245, 245)",rn="rgb(191, 213, 255)",fr="#4572d9",an="rgb(223, 234, 255)",X={mainStroke:ge,mainFill:ai,activeStroke:ge,activeFill:ct,inactiveStroke:rn,inactiveFill:ct,selectedStroke:ge,selectedFill:en,highlightStroke:fr,highlightFill:an,disableStroke:We,disableFill:lr,edgeMainStroke:We,edgeActiveStroke:ge,edgeInactiveStroke:ur,edgeSelectedStroke:ge,edgeHighlightStroke:ge,edgeDisableStroke:tn,comboMainStroke:We,comboMainFill:Ve,comboActiveStroke:ge,comboActiveFill:ct,comboInactiveStroke:We,comboInactiveFill:Ve,comboSelectedStroke:ge,comboSelectedFill:Ve,comboHighlightStroke:fr,comboHighlightFill:Ve,comboDisableStroke:ur,comboDisableFill:lr};const N={version:"0.8.21",rootContainerClassName:"root-container",nodeContainerClassName:"node-container",edgeContainerClassName:"edge-container",comboContainerClassName:"combo-container",delegateContainerClassName:"delegate-container",defaultLoopPosition:"top",nodeLabel:{style:{fill:"#000",fontSize:12,textAlign:"center",textBaseline:"middle"},offset:4},defaultNode:{type:"circle",style:{lineWidth:1,stroke:X.mainStroke,fill:ai},size:20,color:X.mainStroke,linkPoints:{size:8,lineWidth:1,fill:X.activeFill,stroke:X.activeStroke}},nodeStateStyles:{active:{fill:X.activeFill,stroke:X.activeStroke,lineWidth:2,shadowColor:X.mainStroke,shadowBlur:10},selected:{fill:X.selectedFill,stroke:X.selectedStroke,lineWidth:4,shadowColor:X.selectedStroke,shadowBlur:10,"text-shape":{fontWeight:500}},highlight:{fill:X.highlightFill,stroke:X.highlightStroke,lineWidth:2,"text-shape":{fontWeight:500}},inactive:{fill:X.inactiveFill,stroke:X.inactiveStroke,lineWidth:1},disable:{fill:X.disableFill,stroke:X.disableStroke,lineWidth:1}},edgeLabel:{style:{fill:sr,textAlign:"center",textBaseline:"middle",fontSize:12}},defaultEdge:{type:"line",size:1,style:{stroke:X.edgeMainStroke,lineAppendWidth:2},color:X.edgeMainStroke},edgeStateStyles:{active:{stroke:X.edgeActiveStroke,lineWidth:1},selected:{stroke:X.edgeSelectedStroke,lineWidth:2,shadowColor:X.edgeSelectedStroke,shadowBlur:10,"text-shape":{fontWeight:500}},highlight:{stroke:X.edgeHighlightStroke,lineWidth:2,"text-shape":{fontWeight:500}},inactive:{stroke:X.edgeInactiveStroke,lineWidth:1},disable:{stroke:X.edgeDisableStroke,lineWidth:1}},comboLabel:{style:{fill:sr,textBaseline:"middle",fontSize:12},refY:10,refX:10},defaultCombo:{type:"circle",style:{fill:X.comboMainFill,lineWidth:1,stroke:X.comboMainStroke,r:5,width:20,height:10},size:[20,5],color:X.comboMainStroke,padding:[25,20,15,20]},comboStateStyles:{active:{stroke:X.comboActiveStroke,lineWidth:1,fill:X.comboActiveFill},selected:{stroke:X.comboSelectedStroke,lineWidth:2,fill:X.comboSelectedFill,shadowColor:X.comboSelectedStroke,shadowBlur:10,"text-shape":{fontWeight:500}},highlight:{stroke:X.comboHighlightStroke,lineWidth:2,fill:X.comboHighlightFill,"text-shape":{fontWeight:500}},inactive:{stroke:X.comboInactiveStroke,fill:X.comboInactiveFill,lineWidth:1},disable:{stroke:X.comboDisableStroke,fill:X.comboDisableFill,lineWidth:1}},delegateStyle:{fill:"#F3F9FF",fillOpacity:.5,stroke:"#1890FF",strokeOpacity:.9,lineDash:[5,5]},windowFontFamily:typeof window<"u"&&window.getComputedStyle&&document.body&&window.getComputedStyle(document.body,null).getPropertyValue("font-family")||"Arial, sans-serif"},nn={" ":.3329986572265625,a:.5589996337890625,A:.6569992065429687,b:.58599853515625,B:.6769989013671875,c:.5469985961914062,C:.7279998779296875,d:.58599853515625,D:.705999755859375,e:.554998779296875,E:.63699951171875,f:.37299957275390627,F:.5769989013671875,g:.5909988403320312,G:.7479995727539063,h:.555999755859375,H:.7199996948242188,i:.255999755859375,I:.23699951171875,j:.26699981689453123,J:.5169998168945312,k:.5289993286132812,K:.6899993896484375,l:.23499908447265624,L:.5879989624023437,m:.854998779296875,M:.8819992065429687,n:.5589996337890625,N:.7189987182617188,o:.58599853515625,O:.7669998168945312,p:.58599853515625,P:.6419998168945312,q:.58599853515625,Q:.7669998168945312,r:.3649993896484375,R:.6759994506835938,s:.504998779296875,S:.6319992065429687,t:.354998779296875,T:.6189987182617187,u:.5599990844726562,U:.7139999389648437,v:.48199920654296874,V:.6389999389648438,w:.754998779296875,W:.929998779296875,x:.5089996337890625,X:.63699951171875,y:.4959991455078125,Y:.66199951171875,z:.48699951171875,Z:.6239990234375,0:.6,1:.40099945068359377,2:.6,3:.6,4:.6,5:.6,6:.6,7:.5469985961914062,8:.6,9:.6,"[":.3329986572265625,"]":.3329986572265625,",":.26399993896484375,".":.26399993896484375,";":.26399993896484375,":":.26399993896484375,"{":.3329986572265625,"}":.3329986572265625,"\\":.5,"|":.19499969482421875,"=":.604998779296875,"+":.604998779296875,"-":.604998779296875,_:.5,"`":.3329986572265625," ~":.8329986572265625,"!":.3329986572265625,"@":.8579986572265625,"#":.6,$:.6,"%":.9699996948242188,"^":.517999267578125,"&":.7259994506835937,"*":.505999755859375,"(":.3329986572265625,")":.3329986572265625,"<":.604998779296875,">":.604998779296875,"/":.5,"?":.53699951171875};var le=Math.PI,kt=Math.sin,Bt=Math.cos,q=kt(le/8),K=Bt(le/8),at=function(e,t){var r=e.getBBox(),i={x:r.minX,y:r.minY},a={x:r.maxX,y:r.maxY};if(t){var n=t.getMatrix();n||(n=[1,0,0,0,1,0,0,0,1]),i=Ee(i,n),a=Ee(a,n)}var o=i.x,s=i.y,f=a.x,u=a.y;return{x:o,y:s,minX:o,minY:s,maxX:f,maxY:u,width:f-o,height:u-s}},ni=function(e){var t=e.sourceNode||e.targetNode,r=t.get("group"),i=r.getMatrix();i||(i=[1,0,0,0,1,0,0,0,1]);var a=t.getKeyShape(),n=a.getBBox(),o=e.loopCfg||{},s=o.dist||Math.max(n.width,n.height)*2,f=o.position||N.defaultLoopPosition,u=[(n.minX+n.maxX)/2+i[6],(n.minY+n.maxY)/2+i[7]],h=[e.startPoint.x,e.startPoint.y],c=[e.endPoint.x,e.endPoint.y],d=n.height/2,p=n.width/2,v=d,g=d,y=v*q,m=v*K,b=g*q,S=g*K,I=a.get("type"),M=Math.min(d/2,p/2),C=Math.min(d,p),E=o!=null&&o.pointPadding?Math.min(C,o==null?void 0:o.pointPadding):M;if(h[0]===c[0]&&h[1]===c[1]){switch(f){case"top":I==="circle"?(h=[u[0]-y,u[1]-m],c=[u[0]+b,u[1]-S]):(h=[u[0]-E,u[1]-d],c=[u[0]+E,u[1]-d]);break;case"top-right":v=d,g=p,I==="circle"?(y=v*q,m=v*K,b=g*q,S=g*K,h=[u[0]+y,u[1]-m],c=[u[0]+S,u[1]-b]):(h=[u[0]+p-E,u[1]-d],c=[u[0]+p,u[1]-d+E]);break;case"right":v=p,g=p,I==="circle"?(y=v*q,m=v*K,b=g*q,S=g*K,h=[u[0]+m,u[1]-y],c=[u[0]+S,u[1]+b]):(h=[u[0]+p,u[1]-E],c=[u[0]+p,u[1]+E]);break;case"bottom-right":v=p,g=d,I==="circle"?(y=v*q,m=v*K,b=g*q,S=g*K,h=[u[0]+m,u[1]+y],c=[u[0]+b,u[1]+S]):(h=[u[0]+p,u[1]+d-E],c=[u[0]+p-E,u[1]+d]);break;case"bottom":v=d,g=d,I==="circle"?(y=v*q,m=v*K,b=g*q,S=g*K,h=[u[0]+y,u[1]+m],c=[u[0]-b,u[1]+S]):(h=[u[0]-E,u[1]+d],c=[u[0]+E,u[1]+d]);break;case"bottom-left":v=d,g=p,I==="circle"?(y=v*q,m=v*K,b=g*q,S=g*K,h=[u[0]-y,u[1]+m],c=[u[0]-S,u[1]+b]):(h=[u[0]-p,u[1]+d-E],c=[u[0]-p+E,u[1]+d]);break;case"left":v=p,g=p,I==="circle"?(y=v*q,m=v*K,b=g*q,S=g*K,h=[u[0]-m,u[1]+y],c=[u[0]-S,u[1]-b]):(h=[u[0]-p,u[1]-E],c=[u[0]-p,u[1]+E]);break;case"top-left":v=p,g=d,I==="circle"?(y=v*q,m=v*K,b=g*q,S=g*K,h=[u[0]-m,u[1]-y],c=[u[0]-b,u[1]-S]):(h=[u[0]-p+E,u[1]-d],c=[u[0]-p,u[1]-d+E]);break;default:v=p,g=p,y=v*q,m=v*K,b=g*q,S=g*K,h=[u[0]-y,u[1]-m],c=[u[0]+b,u[1]-S]}if(o.clockwise===!1){var B=[h[0],h[1]];h=[c[0],c[1]],c=[B[0],B[1]]}}var P=[h[0]-u[0],h[1]-u[1]],O=(v+s)/v,Y=(g+s)/g;o.clockwise===!1&&(O=(g+s)/g,Y=(v+s)/v);var j=he([0,0],P,O),T=[u[0]+j[0],u[1]+j[1]],L=[c[0]-u[0],c[1]-u[1]],k=he([0,0],L,Y),z=[u[0]+k[0],u[1]+k[1]];return e.startPoint={x:h[0],y:h[1]},e.endPoint={x:c[0],y:c[1]},e.controlPoints=[{x:T[0],y:T[1]},{x:z[0],y:z[1]}],e},oi=function(e,t,r,i,a){var n=1e-4,o=[],s=e==null?void 0:e.getPoint(t);if(!s)return{x:0,y:0,angle:0};if(t<n)o=e.getStartTangent().reverse();else if(t>1-n)o=e.getEndTangent();else{var f=e==null?void 0:e.getPoint(t+n);o.push([s.x,s.y]),o.push([f.x,f.y])}var u=Math.atan2(o[1][1]-o[0][1],o[1][0]-o[0][0]);if(u<0&&(u+=le*2),r&&(s.x+=Bt(u)*r,s.y+=kt(u)*r),i){var h=u-le/2;u>1/2*le&&u<3*1/2*le&&(h-=le),s.x+=Bt(h)*i,s.y+=kt(h)*i}var c={x:s.x,y:s.y,angle:u};return a?(u>.5*le&&u<1.5*le&&(u-=le),w({rotate:u},c)):c},on=function l(e,t,r,i){if(i(e,t,r)===!1)return!1;if(e&&e.children){for(var a=e.children.length-1;a>=0;a--)if(!l(e.children[a],e,a,i))return!1}return!0},sn=function l(e,t,r,i){if(e&&e.children){for(var a=e.children.length-1;a>=0;a--)if(!l(e.children[a],e,a,i))return}return i(e,t,r)!==!1},J=function(e,t){typeof t=="function"&&on(e,null,-1,t)},ue=function(e,t){typeof t=="function"&&sn(e,null,-1,t)},si=function(e,t){return t*(nn[e]||1)},li=function(e,t){var r=0,i=new RegExp("[一-龥]+");return e.split("").forEach(function(a){i.test(a)?r+=t:r+=si(a,t)}),[r,t]},ui=function(e,t){return typeof t!="number"||t<=0||t>=e.length?e:e.substring(0,t)+"..."},Tt=function(e,t){var r=[],i={},a={};e.forEach(function(s){a[s.id]=s}),e.forEach(function(s,f){var u=V(s);u.itemType="combo",u.children=void 0,u.parentId===u.id?(console.warn("The parentId for combo ".concat(u.id," can not be the same as the combo's id")),delete u.parentId):u.parentId&&!a[u.parentId]&&(console.warn("The parent combo for combo ".concat(u.id," does not exist!")),delete u.parentId);var h=i[u.id];if(h){if(u.children=h.children,i[u.id]=u,h=u,!h.parentId){r.push(h);return}var c=i[h.parentId];if(c)c.children?c.children.push(u):c.children=[u];else{var d={id:h.parentId,children:[h]};i[h.parentId]=d,i[u.id]=u}return}if(A(s.parentId)){var p=i[s.parentId];if(p)p.children?p.children.push(u):p.children=[u],i[u.id]=u;else{var v={id:s.parentId,children:[u]};i[v.id]=v,i[u.id]=u}}else r.push(u),i[u.id]=u});var n={};(t||[]).forEach(function(s){n[s.id]=s;var f=i[s.comboId];if(f){var u={id:s.id,comboId:s.comboId};f.children?f.children.push(u):f.children=[u],u.itemType="node",i[s.id]=u}});var o=0;return r.forEach(function(s){s.depth=o+10,J(s,function(f){var u,h=i[f.id].itemType;h==="node"?u=i[f.comboId]:u=i[f.parentId],u&&h==="node"?f.depth=o+1:f.depth=o+10,o<f.depth&&(o=f.depth);var c=n[f.id];return c&&(c.depth=f.depth),!0})}),r},Nt=function(e,t,r){var i,a=e,n,o={root:{children:e}},s=!1,f="root";(e||[]).forEach(function(p){if(!s){if(p.id===t){n=p,p.itemType==="combo"?n.parentId=r:n.comboId=r,s=!0;return}J(p,function(v){var g;return o[v.id]={children:(v==null?void 0:v.children)||[]},a=(g=o[v.parentId||v.comboId||"root"])===null||g===void 0?void 0:g.children,v&&(v.removed||t===v.id)&&a?(f=v.parentId||v.comboId||"root",n=v,v.itemType==="combo"?n.parentId=r:n.comboId=r,s=!0,!1):!0})}}),a=(i=o[f])===null||i===void 0?void 0:i.children;var u=a?a.indexOf(n):-1;if(u>-1&&a.splice(u,1),s||(n={id:t,itemType:"node",comboId:r},o[t]={children:void 0}),t){var h=!1;if(r){var c=0;(e||[]).forEach(function(p){h||J(p,function(v){return r===v.id?(h=!0,v.children?v.children.push(n):v.children=[n],c=v.depth,n.itemType==="node"?n.depth=c+2:n.depth=c+1,!1):!0})})}else(!r||!h)&&n.itemType!=="node"&&e.push(n);var d=n.depth;J(n,function(p){return p.itemType==="node"?d+=2:d+=1,p.depth=d,!0})}return e},Qe=function(e,t,r){var i={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0,x:void 0,y:void 0,width:void 0,height:void 0,centerX:void 0,centerY:void 0};if(!e||e.length===0){var a=r==null?void 0:r.getModel(),n=a||{},o=n.x,s=n.y,f=n.fixSize,u=n.collapsed,h=n.fixCollapseSize,c=u?h:f,d=W(c)?c:[c,c],p=d[0],v=d[1],g=[p/2,v/2];return{minX:o-g[0],minY:s-g[1],maxX:o+g[0],maxY:s+g[1],x:o,y:s,width:p,height:v}}return e.forEach(function(y){var m=t.findById(y.id);if(!(!m||!m.isVisible())){m.set("bboxCanvasCache",void 0);var b=m.getCanvasBBox();b.x&&i.minX>b.minX&&(i.minX=b.minX),b.y&&i.minY>b.minY&&(i.minY=b.minY),b.x&&i.maxX<b.maxX&&(i.maxX=b.maxX),b.y&&i.maxY<b.maxY&&(i.maxY=b.maxY)}}),i.x=(i.minX+i.maxX)/2,i.y=(i.minY+i.maxY)/2,i.width=i.maxX-i.minX,i.height=i.maxY-i.minY,i.centerX=(i.minX+i.maxX)/2,i.centerY=(i.minY+i.maxY)/2,(r==null?void 0:r.getKeyShape().get("type"))==="circle"&&(i.width=Math.hypot(i.height,i.width),i.height=i.width),Object.keys(i).forEach(function(y){(i[y]===1/0||i[y]===-1/0)&&(i[y]=void 0)}),i},ln=function(e){var t=R(e.x)||R(e.y)||e.type||e.anchorPoints||e.size;return e.style&&(t=t||R(e.style.r)||R(e.style.width)||R(e.style.height)||R(e.style.rx)||R(e.style.ry)),t},Je=function(e){var t={};return Object.keys(e).forEach(function(r){var i=e[r];if(!(r==="img"&&!A(i)))if(Fe(i)&&!W(i)){var a={};Object.keys(i).forEach(function(n){var o=i[n];n==="img"&&!A(o)||(a[n]=V(o))}),t[r]=a}else t[r]=V(i)}),t},Ye=function(e){var t=e.animateCfg,r=e.callback,i;if(!t)i={duration:500,callback:r};else if(i=V(t),t.callback){var a=t.callback;i.callback=function(){r(),a()}}else i.callback=r;return i};const un=Object.freeze(Object.defineProperty({__proto__:null,cloneBesidesImg:Je,getAnimateCfgWithCallback:Ye,getBBox:at,getComboBBox:Qe,getLabelPosition:oi,getLetterWidth:si,getLoopCfgs:ni,getTextSize:li,plainCombosToTrees:Tt,reconstructTree:Nt,shouldRefreshEdge:ln,traverseTree:J,traverseTreeUp:ue,truncateLabelByLength:ui},Symbol.toStringTag,{value:"Module"}));var hr=function(e){if(!e)return console.error("G6 Error Tips: the data must be defined"),!1;var t=e.nodes,r=e.edges,i=e.combos,a=i===void 0?[]:i;if(!t&&!r){var n=!0;return J(e,function(c){return A(c.id)?!0:(n=!1,!1)}),n}var o=(t||[]).find(function(c){return!A(c.id)});if(o)return console.warn("G6 Warning Tips: missing 'id' property, or %c".concat(o.id,"%c is not a string."),"font-size: 20px; color: red;",""),!1;var s=(t||[]).map(function(c){return c.id}),f=a==null?void 0:a.map(function(c){return c.id}),u=Le(Le([],s,!0),f,!0),h=(r||[]).find(function(c){return!u.includes(c.source)||!u.includes(c.target)});return h?(console.warn("G6 Warning Tips: The source %c".concat(h.source,"%c or the target %c").concat(h.target,"%c of the edge do not exist in the nodes or combos."),"font-size: 20px; color: red;","","font-size: 20px; color: red;",""),!1):!0},fn=function(e,t){if(e==="node"||e==="combo"){if(t.id&&!A(t.id))return console.warn("G6 Warning Tips: missing 'id' property, or the 'id' %c".concat(t.id,"%c is not a string."),"font-size: 20px; color: red;",""),!1}else if(e==="edge"&&(!t.source||!t.target))return console.warn("G6 Warning Tips: missing 'source' or 'target' for the edge."),!1;return!0},hn=function(){function l(e){this.graph=e,this.destroyed=!1,this.modes=e.get("modes")||{default:[]},this.formatModes(),this.mode=e.get("defaultMode")||"default",this.currentBehaves=[],this.setMode(this.mode)}return l.prototype.formatModes=function(){var e=this.modes;F(e,function(t){F(t,function(r,i){A(r)&&(t[i]={type:r})})})},l.prototype.setBehaviors=function(e){var t=this.graph,r=this.modes[e],i=[],a;F(r||[],function(n){var o=Ur.getBehavior(n.type||n);o&&(a=new o(n),a&&(a.bind(t),i.push(a)))}),this.currentBehaves=i},l.mergeBehaviors=function(e,t){return F(t,function(r){e.indexOf(r)<0&&(A(r)&&(r={type:r}),e.push(r))}),e},l.filterBehaviors=function(e,t){var r=[];return e.forEach(function(i){var a="";A(i)?a=i:a=i.type,t.indexOf(a)<0&&r.push(i)}),r},l.prototype.setMode=function(e){var t=this,r=t.modes,i=t.graph,a=e,n=r[a];n&&(i.emit("beforemodechange",{mode:e}),F(this.currentBehaves,function(o){o.delegate&&o.delegate.remove(),o.unbind(i)}),this.setBehaviors(a),i.emit("aftermodechange",{mode:e}),this.mode=e)},l.prototype.getMode=function(){return this.mode},l.prototype.manipulateBehaviors=function(e,t,r){var i=this,a;if(W(e)?a=e:a=[e],W(t))return F(t,function(o){i.modes[o]?r?i.modes[o]=l.mergeBehaviors(i.modes[o]||[],a):i.modes[o]=l.filterBehaviors(i.modes[o]||[],a):r&&(i.modes[o]=a)}),this;var n=t;return t||(n=this.mode),this.modes[n]||r&&(this.modes[n]=a),r?this.modes[n]=l.mergeBehaviors(this.modes[n]||[],a):this.modes[n]=l.filterBehaviors(this.modes[n]||[],a),this.formatModes(),this.setMode(this.mode),this},l.prototype.updateBehavior=function(e,t,r){A(e)&&(e={type:e});var i=[];if(!r||r===this.mode||r==="default"){if(i=this.currentBehaves,!i||!i.length)return console.warn("Update behavior failed! There is no behaviors in this mode on the graph."),this;for(var a=i.length,n=0;n<a;n++){var o=i[n];if(o.type===e.type)return o.updateCfg(t),this;n===a-1&&console.warn("Update behavior failed! There is no such behavior in the mode")}}else{if(i=this.modes[r],!i||!i.length)return console.warn("Update behavior failed! There is no behaviors in this mode on the graph."),this;for(var s=i.length,n=0;n<s;n++){var o=i[n];if(o.type===e.type||o===e.type)return o===e.type&&(o={type:o}),Object.assign(o,t),i[n]=o,this;n===s-1&&console.warn("Update behavior failed! There is no such behavior in the mode")}}return this},l.prototype.destroy=function(){this.graph=null,this.modes=null,this.currentBehaves=null,this.destroyed=!0},l}(),cn=function(l){Re(e,l);function e(t,r){var i=l.call(this,t,r)||this;return i.item=r.item,i.canvasX=r.canvasX,i.canvasY=r.canvasY,i.wheelDelta=r.wheelDelta,i.detail=r.detail,i}return e}(ta),At=function(e){return"".concat(e,"-").concat(Math.random()).concat(Date.now())},Ht=function(e){if(W(e))switch(e.length){case 4:return e;case 3:return e.push(e[1]),e;case 2:return e.concat(e);case 1:return[e[0],e[0],e[0],e[0]];default:return[0,0,0,0]}if(R(e))return[e,e,e,e];if(A(e)){var t=parseInt(e,10);return[t,t,t,t]}return[0,0,0,0]},dn=function(e){var t=new cn(e.type,e);return t.clientX=e.clientX,t.clientY=e.clientY,t.x=e.x,t.y=e.y,t.target=e.target,t.currentTarget=e.currentTarget,t.bubbles=!0,t.item=e.item,t},vn=function(e){if(!e)return!1;for(var t=9,r=[1,0,0,0,1,0,0,0,1],i=0;i<t;i++)if(e[i]!==r[i])return!0;return!1},fe=function(e){return Number.isNaN(Number(e))},fi=function(e){for(var t=1/0,r=-1/0,i=1/0,a=-1/0,n=0;n<e.length;n++){var o=e[n],s=o.getBBox(),f=s.minX,u=s.minY,h=s.maxX,c=s.maxY;f<t&&(t=f),u<i&&(i=u),h>r&&(r=h),c>a&&(a=c)}var d=Math.floor(t),p=Math.floor(i),v=Math.ceil(r)-Math.floor(t),g=Math.ceil(a)-Math.floor(i);return{x:d,y:p,width:v,height:g,minX:t,minY:i,maxX:r,maxY:a}},pn=function(e,t,r,i,a){t===void 0&&(t=15),r===void 0&&(r="quadratic"),i===void 0&&(i=void 0),a===void 0&&(a=void 0);for(var n=e.length,o=t*2,s=["top","top-right","right","bottom-right","bottom","bottom-left","left","top-left"],f={},u=[],h={},c=0;c<n;c++){var d=e[c],p=d.source,v=d.target,g="".concat(p,"-").concat(v);if(!u[c]){f[g]||(f[g]=[]),u[c]=!0,f[g].push(d);for(var y=0;y<n;y++)if(c!==y){var m=e[y],b=m.source,S=m.target;u[y]||(p===S&&v===b?(f[g].push(m),u[y]=!0,h["".concat(b,"|").concat(S,"|").concat(f[g].length-1)]=!0):p===b&&v===S&&(f[g].push(m),u[y]=!0))}}}for(var I in f)for(var M=f[I],C=M.length,E=0;E<C;E++){var B=M[E];if(B.source===B.target){a&&(B.type=a),B.loopCfg={position:s[E%8],dist:Math.floor(E/8)*20+50};continue}if(C===1&&i&&B.source!==B.target){B.type=i;continue}B.type=r;var P=(E%2===0?1:-1)*(h["".concat(B.source,"|").concat(B.target,"|").concat(E)]?-1:1);C%2===1?B.curveOffset=P*Math.ceil(E/2)*o:B.curveOffset=P*(Math.floor(E/2)*o+t)}return e};const gn=Object.freeze(Object.defineProperty({__proto__:null,calculationItemsBBox:fi,cloneEvent:dn,formatPadding:Ht,isNaN:fe,isViewportChanged:vn,processParallelEdges:pn,uniqueId:At},Symbol.toStringTag,{value:"Module"}));var yn=function(){function l(e){this.destroyed=!1,this.graph=e,this.destroyed=!1}return l.prototype.getViewCenter=function(){var e=this.getFormatPadding(),t=this.graph,r=this.graph.get("width"),i=t.get("height");return{x:(r-e[1]-e[3])/2+e[3],y:(i-e[0]-e[2])/2+e[0]}},l.prototype.fitCenter=function(e,t){var r=this.graph,i=r.get("group"),a,n=r.getNodes();if(n.length>r.get("optimizeThreshold")){var o=1/0,s=1/0,f=-1/0,u=-1/0;n.forEach(function(S){var I=S.getModel(),M=I.x,C=I.y;o>M&&(o=M),s>C&&(s=C),f<M&&(f=M),u<C&&(u=C)});var h=i.getMatrix()||[1,0,0,0,1,0,0,0,1],c=Ee({x:o,y:s},h),d=c.x,p=c.y,v=Ee({x:f,y:u},h),g=v.x,y=v.y;a={minX:d,maxX:g,minY:p,maxY:y,width:g-d,height:y-p,x:d,y:p}}else a=i.getCanvasBBox();if(!(a.width===0||a.height===0)){var m=this.getViewCenter(),b={x:a.x+a.width/2,y:a.y+a.height/2};r.translate(m.x-b.x,m.y-b.y,e,t)}},l.prototype.animatedFitView=function(e,t,r,i,a,n,o,s){var f=this.graph;r=r||{duration:500,easing:"easeCubic"};var u=[1,0,0,0,1,0,0,0,1],h=i.x+a.x-n.x-i.minX,c=i.y+a.y-n.y-i.minY;if(!(fe(h)||fe(c))){var d=er(u,[["t",h,c]]);if(!s){var p=Ye({animateCfg:r,callback:function(){f.emit("viewportchange",{action:"translate",matrix:d})}});e.animate(function(S){return{matrix:Pt(t,d,S)}},p);return}var v=f.get("minZoom"),g=f.get("maxZoom"),y=o;v&&o<v?(y=v,console.warn("fitview failed, ratio out of range, ratio: %f",o,"graph minzoom has been used instead")):g&&o>g&&(y=g,console.warn("fitview failed, ratio out of range, ratio: %f",o,"graph maxzoom has been used instead"));var m=er(d,[["t",-a.x,-a.y],["s",y,y],["t",a.x,a.y]]),b=Ye({animateCfg:r,callback:function(){e.setMatrix(m),f.emit("viewportchange",{action:"translate",matrix:d}),f.emit("viewportchange",{action:"zoom",matrix:m})}});e.stopAnimate(),e.setMatrix(t),e.animate(function(S){return{matrix:Pt(t,m,S)}},b)}},l.prototype.fitView=function(e,t){var r=this.graph,i=this.getFormatPadding(),a=r.get("width"),n=r.get("height"),o=r.get("group"),s=o.getMatrix()||[1,0,0,0,1,0,0,0,1];o.resetMatrix();var f,u=r.getNodes();if(u.length>r.get("optimizeThreshold")){var h=1/0,c=1/0,d=-1/0,p=-1/0;u.forEach(function(M){var C=M.getModel(),E=C.x,B=C.y;h>E&&(h=E),c>B&&(c=B),d<E&&(d=E),p<B&&(p=B)}),f={minX:h,maxX:d,minY:c,maxY:p,width:d-h,height:p-c,x:h,y:c}}else f=o.getCanvasBBox();if(!(f.width===0||f.height===0)){var v=this.getViewCenter(),g={x:f.x+f.width/2,y:f.y+f.height/2},y=(a-i[1]-i[3])/f.width,m=(n-i[0]-i[2])/f.height,b=y;if(y>m&&(b=m),e)this.animatedFitView(o,s,t,f,v,g,b,!0);else{var S=v.x-g.x,I=v.y-g.y;if(fe(S)||fe(I))return;r.translate(S,I),r.zoom(b,v)||console.warn("zoom failed, ratio out of range, ratio: %f",b)}}},l.prototype.fitViewByRules=function(e,t,r){var i=e.onlyOutOfViewPort,a=i===void 0?!1:i,n=e.direction,o=n===void 0?"both":n,s=e.ratioRule,f=s===void 0?"min":s,u=this.graph,h=this.getFormatPadding(),c=u.get("width"),d=u.get("height"),p=u.get("group"),v=p.getMatrix()||[1,0,0,0,1,0,0,0,1];p.resetMatrix();var g,y=u.getNodes();if(y.length>u.get("optimizeThreshold")){var m=1/0,b=1/0,S=-1/0,I=-1/0;y.forEach(function(T){var L=T.getModel(),k=L.x,z=L.y;m>k&&(m=k),b>z&&(b=z),S<k&&(S=k),I<z&&(I=z)}),g={minX:m,maxX:S,minY:b,maxY:I,width:S-m,height:I-b,x:m,y:b}}else g=p.getCanvasBBox();if(!(g.width===0||g.height===0)){var M=this.getViewCenter(),C={x:g.x+g.width/2,y:g.y+g.height/2},E=(c-h[1]-h[3])/g.width,B=(d-h[0]-h[2])/g.height,P;if(o==="x"?P=E:o==="y"?P=B:P=f==="max"?Math.max(E,B):Math.min(E,B),a&&(P=P<1?P:1),t)this.animatedFitView(p,v,r,g,M,C,P,!0);else{var O=u.getZoom(),Y=O*P,j=u.get("minZoom");Y<j&&(Y=j,console.warn("fitview failed, ratio out of range, ratio: %f",P,"graph minzoom has been used instead")),u.translate(M.x-C.x,M.y-C.y),u.zoomTo(Y,M)}}},l.prototype.getFormatPadding=function(){var e=this.graph.get("fitViewPadding");return Ht(e)},l.prototype.focusPoint=function(e,t,r){var i=this,a=this.getViewCenter(),n=this.getPointByCanvas(a.x,a.y),o=this.graph.get("group").getMatrix();if(o||(o=[1,0,0,0,1,0,0,0,1]),t){var s=(n.x-e.x)*o[0],f=(n.y-e.y)*o[4],u=0,h=0,c=0,d=0;this.graph.get("canvas").animate(function(p){c=s*p,d=f*p,i.graph.translate(c-u,d-h),u=c,h=d},w({},r))}else this.graph.translate((n.x-e.x)*o[0],(n.y-e.y)*o[4])},l.prototype.getPointByCanvas=function(e,t){var r=this.graph.get("group").getMatrix();r||(r=[1,0,0,0,1,0,0,0,1]);var i=Kr({x:e,y:t},r);return i},l.prototype.getPointByClient=function(e,t){var r=this.graph.get("canvas"),i=r.getPointByClient(e,t);return this.getPointByCanvas(i.x,i.y)},l.prototype.getClientByPoint=function(e,t){var r=this.graph.get("canvas"),i=this.getCanvasByPoint(e,t),a=r.getClientByPoint(i.x,i.y);return{x:a.x,y:a.y}},l.prototype.getCanvasByPoint=function(e,t){var r=this.graph.get("group").getMatrix();return r||(r=[1,0,0,0,1,0,0,0,1]),Ee({x:e,y:t},r)},l.prototype.focus=function(e,t,r){if(A(e)&&(e=this.graph.findById(e)),e){var i=0,a=0;if(e.getType&&e.getType()==="edge"){var n=e.getSource().get("group").getMatrix(),o=e.getTarget().get("group").getMatrix();n&&o?(i=(n[6]+o[6])/2,a=(n[7]+o[7])/2):(n||o)&&(i=n?n[6]:o[6],a=n?n[7]:o[7])}else{var s=e.get("group"),f=s.getMatrix();f||(f=[1,0,0,0,1,0,0,0,1]),i=f[6],a=f[7]}this.focusPoint({x:i,y:a},t,r)}},l.prototype.focusItems=function(e,t,r,i){if(e.length){var a=this.graph,n=this.getFormatPadding(),o=a.get("width"),s=a.get("height"),f=a.get("group"),u=f.getMatrix()||[1,0,0,0,1,0,0,0,1];f.resetMatrix();for(var h={x:0,y:0,minX:Number.MAX_SAFE_INTEGER,minY:Number.MAX_SAFE_INTEGER,maxX:Number.MIN_SAFE_INTEGER,maxY:Number.MIN_SAFE_INTEGER,width:0,height:0},c=0,d=e;c<d.length;c++){var p=d[c],v=p.getBBox();v.minX<h.minX&&(h.minX=v.minX),v.minY<h.minY&&(h.minY=v.minY),v.maxX>h.maxX&&(h.maxX=v.maxX),v.maxY>h.maxY&&(h.maxY=v.maxY)}if(h.x=h.minX,h.y=h.minY,h.width=h.maxX-h.minX,h.height=h.maxY-h.minY,!(h.width===0||h.height===0)){var g=this.getViewCenter(),y={x:h.x+h.width/2,y:h.y+h.height/2},m=(o-n[1]-n[3])/h.width,b=(s-n[0]-n[2])/h.height,S=m;m>b&&(S=b),r?this.animatedFitView(f,u,i,h,g,y,S,t):(a.translate(g.x-y.x,g.y-y.y),t&&!a.zoom(S,g)&&console.warn("zoom failed, ratio out of range, ratio: %f",S))}}},l.prototype.changeSize=function(e,t){var r=this.graph;if(!R(e)||!R(t))throw Error("invalid canvas width & height, please make sure width & height type is number");r.set({width:e,height:t});var i=r.get("canvas");i.changeSize(e,t);var a=r.get("plugins");a.forEach(function(n){n.get("gridContainer")&&n.positionInit()})},l.prototype.destroy=function(){this.graph=null,this.destroyed=!1},l}();function Ot(l){"@babel/helpers - typeof";return Ot=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ot(l)}function cr(l){if(typeof l!="string")return l;var e=function(C){if(typeof C!="string")return C;try{return JSON.parse(C.trim())}catch{return C.trim()}},t=e(l);if(typeof t!="string")return t;for(var r=function(C){return C[C.length-1]},i=l.trim(),a=[],n=[],o=function(){for(var C=[],E=0;E<arguments.length;E++)C[E]=arguments[E];return C.some(function(B){return r(n)===B})},s=function(){return r(a)},f=null,u=0,h="";u<i.length;){var c=i[u],d=o('"',"'");if(!d&&!c.trim()){u+=1;continue}var p=i[u-1]==="\\",v=o("}"),g=o("]"),y=o(","),m=s();if(d)if(r(n)===c&&!p){n.pop();var b=e(h);m.push(b),f=b,h=""}else h+=c;else if(g&&c===",")h&&(m.push(e(h)),h="");else if(v&&c===":")n.push(","),h&&(m.push(h),h="");else if(y&&c===",")h&&(m.push(e(h)),h=""),n.pop();else if(c==="}"&&(v||y)){h&&(m.push(e(h)),h=""),y&&n.pop();for(var S={},I=1;I<m.length;I+=2)S[m[I-1]]=m[I];a.pop(),a.length&&r(a).push(S),n.pop(),f=S}else c==="]"&&g?(h&&(m.push(e(h)),h=""),a.pop(),a.length&&r(a).push(m),n.pop(),f=m):c==="{"?(a.push([]),n.push("}")):c==="["?(a.push([]),n.push("]")):c==='"'?n.push('"'):c==="'"?n.push("'"):h+=c;u+=1}return f||h}var mn=function(e){return e.split("-").reduce(function(t,r){return t+r.charAt(0).toUpperCase()+r.slice(1)})},bn=function(e){return function(t){for(var r=e.length,i=[],a=0,n="";a<r;)if(e[a]==="{"&&e[a+1]==="{")i.push(n),n="",a+=2;else if(e[a]==="}"&&e[a+1]==="}"){if(i.length){var o=i.pop();n=Ra(t,n,o.endsWith("=")?'"{'.concat(n,'}"'):n),i.push(o+n)}a+=2,n=""}else n+=e[a],a+=1;return i.push(n),i.map(function(s,f){return i[f-1]&&i[f-1].endsWith("=")?'"{'.concat(s,'}"'):s}).join("")}};function hi(l,e){var t={},r=l.getAttributeNames&&l.getAttributeNames()||[],i=l.children&&Array.from(l.children).map(function(o){return hi(o,e)}),a={},n=l.tagName?l.tagName.toLowerCase():"group";return n==="text"&&(t.text=l.innerText),a.type=n,n==="img"&&(a.type="image"),Array.from(r).forEach(function(o){var s=mn(o),f=l.getAttribute(o);try{if(s==="style"||s==="attrs"){var u=cr(f);t=w(w({},t),u)}else a[s]=cr(f)}catch(h){if(s==="style")throw h;a[s]=f}}),a.attrs=t,e&&e.style&&a.name&&Ot(e.style[a.name])==="object"&&(a.attrs=w(w({},a.attrs),e.style[a.name])),e&&e.style&&a.keyshape&&(a.attrs=w(w({},a.attrs),e.style)),i.length&&(a.children=i),a}function xn(l,e,t){var r=l.attrs,i=r===void 0?{}:r,a={x:e.x||0,y:e.y||0,width:t.width||0,height:t.height||0},n,o;switch(l.type){case"maker":case"circle":i.r&&(o=2*i.r,n=2*i.r);break;case"text":i.text&&(o=li(i.text,i.fontSize||12)[0],n=16,a.y+=n,a.height=n,a.width=o,l.attrs=w({fontSize:12,fill:"#000"},i));break;default:i.width&&(o=i.width),i.height&&(n=i.height)}return n>=0&&(a.height=n),o>=0&&(a.width=o),i.marginTop&&(a.y+=i.marginTop),i.marginLeft&&(a.x+=i.marginLeft),a}function ci(l,e){var t;e===void 0&&(e={x:0,y:0});var r=w({x:0,y:0,width:0,height:0},e);if(!((t=l.children)===null||t===void 0)&&t.length){var i=l.attrs,a=i===void 0?{}:i,n=a.marginTop,o=w({},e);n&&(o.y+=n);for(var s=0;s<l.children.length;s++){l.children[s].attrs.key="".concat(a.key||"root"," -").concat(s," ");var f=ci(l.children[s],o);if(f.bbox){var u=f.bbox;f.attrs.next==="inline"?o.x+=f.bbox.width:o.y+=f.bbox.height,u.width+u.x>r.width&&(r.width=u.width+u.x),u.height+u.y>r.height&&(r.height=u.height+u.y)}}}return l.bbox=xn(l,e,r),l.attrs=w(w({},l.attrs),l.bbox),l}function di(l,e){var t,r,i,a,n=(l||{}).type,o=((e==null?void 0:e.attrs)||{}).key;if(o&&l&&(l.attrs.key=o),!l&&e)return{action:"delete",val:e,type:n,key:o};if(l&&!e)return{action:"add",val:l,type:n};if(!l&&!e)return{action:"same",type:n};var s=[];if(((t=l.children)===null||t===void 0?void 0:t.length)>0||((r=e.children)===null||r===void 0?void 0:r.length)>0)for(var f=Math.max((i=l.children)===null||i===void 0?void 0:i.length,(a=e.children)===null||a===void 0?void 0:a.length),u=e.children||[],h=l.children||[],c=0;c<f;c+=1)s.push(di(h[c],u[c]));var d=Object.keys(e.attrs),p=Object.keys(l.attrs);return e.type!==l.type?{action:"restructure",nowTarget:l,formerTarget:e,key:o,children:s}:d.filter(function(v){return v!=="children"}).some(function(v){return l.attrs[v]!==e.attrs[v]||!p.includes(v)})?{action:"change",val:l,children:s,type:n,key:o}:{action:"same",children:s,type:n,key:o}}function dr(l){var e={},t=function(i){var a=typeof l=="function"?l(i):l,n=bn(a)(i),o=document.createElement("div");o.innerHTML=n;var s=o.children[0],f=ci(hi(s,i));return o.remove(),f};return{draw:function(i,a){var n=t(i),o=a,s=function f(u){var h=u.attrs,c=h===void 0?{}:h,d=u.bbox,p=u.type,v=u.children,g=St(u,["attrs","bbox","type","children"]);if(u.type!=="group"){var y=a.addShape(u.type,w({attrs:c,origin:{bbox:d,type:p,children:v}},g));u.keyshape&&(o=y)}u.children&&u.children.forEach(function(m){return f(m)})};return s(n),e[i.id]=[n],o},update:function(i,a){e[i.id]||(e[i.id]=[]);var n=a.getContainer(),o=n.get("children"),s=t(i),f=e[i.id].pop(),u=di(s,f),h=function p(v){var g;v.type!=="group"&&n.addShape(v.type,{attrs:v.attrs}),!((g=v.children)===null||g===void 0)&&g.length&&v.children.map(function(y){return p(y)})},c=function p(v){var g,y=o.find(function(m){return m.attrs.key===v.attrs.key});y&&n.removeChild(y),!((g=v.children)===null||g===void 0)&&g.length&&v.children.map(function(m){return p(m)})},d=function p(v){var g=v.key;if(v.type!=="group"){var y=o.find(function(b){return b.attrs.key===g});switch(v.action){case"change":if(y){var m=v.val.keyshape?a.getOriginStyle():{};y.attr(w(w({},m),v.val.attrs))}break;case"add":h(v.val);break;case"delete":c(v.val);break;case"restructure":c(v.formerTarget),h(v.nowTarget);break}}v.children&&v.children.forEach(function(b){return p(b)})};d(u),e[i.id].push(s)},getAnchorPoints:function(){return[[0,.5],[1,.5],[.5,1],[.5,0]]}}}var dt={};function vr(l){return dt[l]||(dt[l]=wt(l)),dt[l]}var Sn={defaultShapeType:"defaultType",className:null,getShape:function(e){var t=this,r=t[e]||t[t.defaultShapeType]||t["simple-circle"];return r},draw:function(e,t,r){var i=this.getShape(e);r.shapeMap={};var a=i.draw(t,r);return i.afterDraw&&i.afterDraw(t,r,a),a},baseUpdate:function(e,t,r,i){var a,n,o=this.getShape(e);o.update&&(o.mergeStyle=(a=o.getOptions)===null||a===void 0?void 0:a.call(o,t,i),(n=o.update)===null||n===void 0||n.call(o,t,r,i)),o.afterUpdate&&o.afterUpdate(t,r)},setState:function(e,t,r,i){var a=this.getShape(e);a.setState(t,r,i)},shouldUpdate:function(e){var t=this.getShape(e);return!!t.update},getControlPoints:function(e,t){var r=this.getShape(e);return r.getControlPoints(t)},getAnchorPoints:function(e,t){var r=this.getShape(e);return r.getAnchorPoints(t)}},vt={options:{},draw:function(e,t){return this.drawShape(e,t)},drawShape:function(){},afterDraw:function(){},afterUpdate:function(){},setState:function(){},getControlPoints:function(e){return e.controlPoints},getAnchorPoints:function(e){var t=this.options.anchorPoints,r=e.anchorPoints||t;return r}},G=function(){function l(){}return l.registerFactory=function(e,t){var r=vr(e),i=Sn,a=w(w({},i),t);return l[r]=a,a.className=r,a},l.getFactory=function(e){var t=vr(e);return l[t]},l.registerNode=function(e,t,r){var i=l.Node,a;if(typeof t=="string"||typeof t=="function"){var n=dr(t);a=w(w({},i.getShape("single-node")),n)}else if(t.jsx){var o=t.jsx,n=dr(o);a=w(w(w({},i.getShape("single-node")),n),t)}else{i.getShape(r);var s=r?i.getShape(r):vt;a=w(w({},s),t)}return a.type=e,a.itemType="node",i[e]=a,a},l.registerEdge=function(e,t,r){var i=l.Edge,a=r?i.getShape(r):vt,n=w(w({},a),t);return n.type=e,n.itemType="edge",i[e]=n,n},l.registerCombo=function(e,t,r){var i=l.Combo,a=r?i.getShape(r):vt,n=w(w({},a),t);return n.type=e,n.itemType="combo",i[e]=n,n},l}();G.registerFactory("node",{defaultShapeType:"circle"});G.registerFactory("edge",{defaultShapeType:"line"});G.registerFactory("combo",{defaultShapeType:"circle"});var pt="bboxCache",gt="bboxCanvasCache",vi=function(){function l(e){this._cfg={},this.destroyed=!1,this.optimize=!1;var t={id:void 0,type:"item",model:{},group:void 0,animate:!1,visible:!0,locked:!1,event:!0,keyShape:void 0,states:[]};this._cfg=Object.assign(t,this.getDefaultCfg(),e);var r=this.get("model"),i=r.id,a=this.get("type");typeof i>"u"?i=At(a):typeof i!="string"&&(i=String(i)),this.get("model").id=i,this.set("id",i);var n=e.group;n&&(n.set("item",this),n.set("id",i)),this.init(),this.draw();var o=r.shape||r.type||(a==="edge"?"line":"circle"),s=this.get("shapeFactory");if(s&&s[o]){var f=s[o].options;if(f&&f.stateStyles){var u=this.get("styles")||r.stateStyles;u=_({},f.stateStyles,u),this.set("styles",u)}}}return l.prototype.calculateBBox=function(){var e=this.get("keyShape"),t=this.get("group"),r=at(e,t);return r.x=r.minX,r.y=r.minY,r.width=r.maxX-r.minX,r.height=r.maxY-r.minY,r.centerX=(r.minX+r.maxX)/2,r.centerY=(r.minY+r.maxY)/2,r},l.prototype.calculateCanvasBBox=function(){var e=this.get("keyShape"),t=this.get("group"),r=at(e,t);return r.x=r.minX,r.y=r.minY,r.width=r.maxX-r.minX,r.height=r.maxY-r.minY,r.centerX=(r.minX+r.maxX)/2,r.centerY=(r.minY+r.maxY)/2,r},l.prototype.drawInner=function(){var e=this,t=e.get("shapeFactory"),r=e.get("group"),i=e.get("model");r.clear();var a=i.visible;if(a!==void 0&&!a&&e.changeVisibility(a),!!t){e.updatePosition(i);var n=e.getShapeCfg(i),o=n.type,s=t.draw(o,n,r);s&&(e.set("keyShape",s),s.set("isKeyShape",!0),s.set("draggable",!0)),this.setOriginStyle(),this.set("currentShape",o),this.restoreStates(t,o)}},l.prototype.setOriginStyle=function(){var e=this.get("group"),t=e.get("children"),r=this.getKeyShape(),i=this,a=r.get("name");if(this.get("originStyle")){var d=this.get("originStyle");a&&!d[a]&&(d[a]={});for(var p=this.getCurrentStatesStyle(),v=function(y){var m=t[y],b=m.get("name"),S=m.attr();if(b&&b!==a){var I=p[b];d[b]||(d[b]={}),I?Object.keys(S).forEach(function(E){var B=S[E];B!==I[E]&&(d[b][E]=B)}):d[b]=m.get("type")!=="image"?V(S):i.getShapeStyleByName(b)}else{var M=m.attr(),C={};Object.keys(p).forEach(function(E){var B=p[E];(E===a||!re(B))&&(C[E]=B)}),Object.keys(M).forEach(function(E){var B=M[E];C[E]!==B&&(a?d[a][E]=B:d[E]=B)})}},o=0;o<t.length;o++)v(o);delete d.path,delete d.matrix,delete d.x,delete d.y,d[a]&&(delete d[a].x,delete d[a].y,delete d[a].matrix,delete d[a].path),i.set("originStyle",d)}else{for(var n={},o=0;o<t.length;o++){var s=t[o],f=s.get("type"),u=s.get("name");if(u&&u!==a)n[u]=f!=="image"?V(s.attr()):i.getShapeStyleByName(u),f==="text"&&n[u]&&(delete n[u].x,delete n[u].y,delete n[u].matrix);else{var h=i.getShapeStyleByName();if(delete h.path,delete h.matrix,!a)Object.assign(n,h);else if(u)n[a]=h;else{var c=At("shape");s.set("name",c),e.shapeMap[c]=s,n[c]=f!=="image"?V(s.attr()):i.getShapeStyleByName(u)}}}i.set("originStyle",n)}},l.prototype.restoreStates=function(e,t){var r=this,i=r.get("states");F(i,function(a){e.setState(t,a,!0,r)})},l.prototype.init=function(){var e=G.getFactory(this.get("type"));this.set("shapeFactory",e)},l.prototype.get=function(e){return this._cfg[e]},l.prototype.set=function(e,t){re(e)?this._cfg=w(w({},this._cfg),e):this._cfg[e]=t},l.prototype.getDefaultCfg=function(){return{}},l.prototype.clearCache=function(){this.set(pt,null),this.set(gt,null)},l.prototype.beforeDraw=function(){},l.prototype.afterDraw=function(){},l.prototype.afterUpdate=function(){},l.prototype.draw=function(){this.beforeDraw(),this.drawInner(),this.afterDraw()},l.prototype.getShapeStyleByName=function(e){var t=this.get("group"),r;if(e?r=t.shapeMap[e]||t.find(function(a){return a.get("name")===e}):r=this.getKeyShape(),r){var i={};return F(r.attr(),function(a,n){(n!=="img"||A(a))&&(i[n]=a)}),i}return{}},l.prototype.getShapeCfg=function(e,t){var r=this.get("styles");if(r){var i=e;return i.style=w(w({},r),e.style),i}return e},l.prototype.getStateStyle=function(e){var t=this.get("styles"),r=t&&t[e];return r},l.prototype.getOriginStyle=function(){return this.get("originStyle")},l.prototype.getCurrentStatesStyle=function(){var e=this,t={},r=e.getStates();return!r||!r.length?this.get("originStyle"):(F(e.getStates(),function(i){t=Object.assign(t,e.getStateStyle(i))}),t)},l.prototype.setState=function(e,t){var r=this.get("states"),i=this.get("shapeFactory"),a=e,n=e;A(t)&&(a="".concat(e,":").concat(t),n="".concat(e,":"));var o=r;if(Hr(t)){var s=r.indexOf(n);if(t){if(s>-1)return;r.push(a)}else s>-1&&r.splice(s,1)}else if(A(t)){var f=r.filter(function(c){return c.includes(n)});f.length>0&&this.clearStates(f),o=o.filter(function(c){return!c.includes(n)}),o.push(a),this.set("states",o)}if(i){var u=this.get("model"),h=u.type;i.setState(h,e,t,this)}},l.prototype.clearStates=function(e){var t=this,r=t.getStates(),i=t.get("shapeFactory"),a=t.get("model"),n=a.type;e||(e=r),A(e)&&(e=[e]);var o=r.filter(function(s){return e.indexOf(s)===-1});t.set("states",o),e.forEach(function(s){i.setState(n,s,!1,t)})},l.prototype.setOptimize=function(e){this.optimize=e},l.prototype.getContainer=function(){return this.get("group")},l.prototype.getKeyShape=function(){return this.get("keyShape")},l.prototype.getModel=function(){return this.get("model")},l.prototype.getType=function(){return this.get("type")},l.prototype.getID=function(){return this.get("id")},l.prototype.isItem=function(){return!0},l.prototype.getStates=function(){return this.get("states")},l.prototype.hasState=function(e){var t=this.getStates();return t.indexOf(e)>=0},l.prototype.refresh=function(e){var t=this.get("model");this.updatePosition(t),this.updateShape(e),this.afterUpdate(),this.clearCache()},l.prototype.getUpdateType=function(e){},l.prototype.update=function(e,t){t===void 0&&(t=void 0);var r=this.get("model");if(t==="move")this.updatePosition(e);else{var i=r.visible,a=e.visible;i!==a&&a!==void 0&&this.changeVisibility(a);var n={x:r.x,y:r.y};e.x=isNaN(+e.x)?r.x:+e.x,e.y=isNaN(+e.y)?r.y:+e.y;var o=this.get("styles");if(e.stateStyles){var s=e.stateStyles;$(o,s),delete e.stateStyles}Object.assign(r,e),(n.x!==e.x||n.y!==e.y)&&this.updatePosition(e),this.updateShape(t)}this.afterUpdate(),this.clearCache()},l.prototype.updateShape=function(e){var t=this.get("shapeFactory"),r=this.get("model"),i=r.type;if(t.shouldUpdate(i)&&i===this.get("currentShape")){var a=this.getShapeCfg(r,e);t.baseUpdate(i,a,this,e),e!=="move"&&this.setOriginStyle()}else this.draw();this.restoreStates(t,i)},l.prototype.updatePosition=function(e){var t=this.get("model"),r=isNaN(+e.x)?+t.x:+e.x,i=isNaN(+e.y)?+t.y:+e.y,a=this.get("group");if(isNaN(r)||isNaN(i))return!1;t.x=r,t.y=i;var n=a.getMatrix();return n&&n[6]===r&&n[7]===i?!1:(a.resetMatrix(),Qr(a,{x:r,y:i}),this.clearCache(),!0)},l.prototype.getBBox=function(){var e=this.get(pt);return e||(e=this.calculateBBox(),this.set(pt,e)),e},l.prototype.getCanvasBBox=function(){var e=this.get(gt);return e||(e=this.calculateCanvasBBox(),this.set(gt,e)),e},l.prototype.toFront=function(){var e=this.get("group");e.toFront()},l.prototype.toBack=function(){var e=this.get("group");e.toBack()},l.prototype.show=function(){this.changeVisibility(!0)},l.prototype.hide=function(){this.changeVisibility(!1)},l.prototype.changeVisibility=function(e){var t=this.get("group");e?t.show():t.hide(),this.set("visible",e)},l.prototype.isVisible=function(){return this.get("visible")},l.prototype.enableCapture=function(e){var t=this.get("group");t&&t.set("capture",e)},l.prototype.destroy=function(){if(!this.destroyed){var e=this.get("animate"),t=this.get("group");e&&t.stopAnimate(),t.shapeMap={},this.clearCache(),t.remove(),this._cfg=null,this.destroyed=!0}},l}(),He={source:"start",target:"end"},oe="Node",xe="Point",Cn="Anchor",pi=function(l){Re(e,l);function e(){return l!==null&&l.apply(this,arguments)||this}return e.prototype.getDefaultCfg=function(){return{type:"edge",sourceNode:null,targetNode:null,startPoint:null,endPoint:null,linkCenter:!1}},e.prototype.setEnd=function(t,r){var i=He[t]+xe,a=t+oe,n=this.get(a);n&&!n.destroyed&&n.removeEdge(this),re(r)?(this.set(i,r),this.set(a,null)):r&&(r.addEdge(this),this.set(a,r),this.set(i,null))},e.prototype.getLinkPoint=function(t,r,i){var a=He[t]+xe,n=t+oe,o=this.get(a);if(!o){var s=this.get(n),f=t+Cn,u=this.getPrePoint(t,i),h=r[f];ne(h)||(o=s.getLinkPointByAnchor(h)),o=o||s.getLinkPoint(u),ne(o.index)||this.set("".concat(t,"AnchorIndex"),o.index)}return o},e.prototype.getPrePoint=function(t,r){if(r&&r.length){var i=t==="source"?0:r.length-1;return r[i]}var a=t==="source"?"target":"source";return this.getEndPoint(a)},e.prototype.getEndPoint=function(t){var r=t+oe,i=He[t]+xe,a=this.get(r);return a&&!a.destroyed?a.get("model"):this.get(i)},e.prototype.getControlPointsByCenter=function(t){var r=this.getEndPoint("source"),i=this.getEndPoint("target"),a=this.get("shapeFactory"),n=t.type;return a.getControlPoints(n,{startPoint:r,endPoint:i})},e.prototype.getEndCenter=function(t){var r=t+oe,i=He[t]+xe,a=this.get(r);if(a){var n=a.getBBox();return{x:n.centerX,y:n.centerY}}return this.get(i)},e.prototype.init=function(){l.prototype.init.call(this),this.setSource(this.get("source")),this.setTarget(this.get("target"))},e.prototype.getShapeCfg=function(t,r){var i=this,a=i.get("linkCenter"),n=r!=null&&r.includes("move")?t:l.prototype.getShapeCfg.call(this,t);if(a)n.startPoint=i.getEndCenter("source"),n.endPoint=i.getEndCenter("target");else{var o=n.controlPoints||i.getControlPointsByCenter(n);n.startPoint=i.getLinkPoint("source",t,o),n.endPoint=i.getLinkPoint("target",t,o)}return n.sourceNode=i.get("sourceNode"),n.targetNode=i.get("targetNode"),n},e.prototype.getModel=function(){var t=this.get("model"),r=this.get("source".concat(oe)),i=this.get("target".concat(oe));return r?delete t["source".concat(oe)]:t.source=this.get("start".concat(xe)),i?delete t["target".concat(oe)]:t.target=this.get("end".concat(xe)),!A(t.source)&&!re(t.source)&&(t.source=t.source.getID()),!A(t.target)&&!re(t.target)&&(t.target=t.target.getID()),t},e.prototype.setSource=function(t){this.setEnd("source",t),this.set("source",t)},e.prototype.setTarget=function(t){this.setEnd("target",t),this.set("target",t)},e.prototype.getSource=function(){return this.get("source")},e.prototype.getTarget=function(){return this.get("target")},e.prototype.updatePosition=function(){return!1},e.prototype.update=function(t,r){r===void 0&&(r=void 0);var i=this.get("model"),a=i.visible,n=t.visible;a!==n&&n!==void 0&&this.changeVisibility(n);var o=this.get("source"),s=this.get("target");if(!(!o||o.destroyed||!s||s.destroyed)){var f=this.get("styles");if(t.stateStyles){var u=t.stateStyles;$(f,u),delete t.stateStyles}Object.assign(i,t),this.updateShape(r),this.afterUpdate(),this.clearCache()}},e.prototype.destroy=function(){var t=this.get("source".concat(oe)),r=this.get("target".concat(oe));t&&!t.destroyed&&t.removeEdge(this),r&&!r.destroyed&&r.removeEdge(this),l.prototype.destroy.call(this)},e}(vi),yt="anchorPointsCache",wn="bboxCache",jt=function(l){Re(e,l);function e(){return l!==null&&l.apply(this,arguments)||this}return e.prototype.getNearestPoint=function(t,r){for(var i=0,a=t[0],n=rt(t[0],r),o=0;o<t.length;o++){var s=t[o],f=rt(s,r);f<n&&(a=s,n=f,i=o)}return a.anchorIndex=i,a},e.prototype.getDefaultCfg=function(){return{type:"node",edges:[]}},e.prototype.getEdges=function(){return this.get("edges")},e.prototype.getInEdges=function(){var t=this;return this.get("edges").filter(function(r){return r.get("target")===t})},e.prototype.getOutEdges=function(){var t=this;return this.get("edges").filter(function(r){return r.get("source")===t})},e.prototype.getNeighbors=function(t){var r=this,i=this.get("edges");if(t==="target"){var a=function(f){return f.getSource()===r};return i.filter(a).map(function(s){return s.getTarget()})}if(t==="source"){var n=function(f){return f.getTarget()===r};return i.filter(n).map(function(s){return s.getSource()})}var o=function(f){return f.getSource()===r?f.getTarget():f.getSource()};return i.map(o)},e.prototype.getLinkPointByAnchor=function(t){var r=this.getAnchorPoints();return r[t]},e.prototype.getLinkPoint=function(t){var r=this.get("keyShape"),i=r.get("type"),a=this.get("type"),n,o,s=this.getBBox();a==="combo"?(n=s.centerX||(s.maxX+s.minX)/2,o=s.centerY||(s.maxY+s.minY)/2):(n=s.centerX,o=s.centerY);var f=this.getAnchorPoints(),u;switch(i){case"circle":u=Zr({x:n,y:o,r:s.width/2},t);break;case"ellipse":u=qr({x:n,y:o,rx:s.width/2,ry:s.height/2},t);break;default:u=$r(s,t)}var h=u;return f.length&&(h||(h=t),h=this.getNearestPoint(f,h)),h||(h={x:n,y:o}),h},e.prototype.getAnchorPoints=function(){var t=this.get(yt);if(!t){t=[];var r=this.get("shapeFactory"),i=this.getBBox(),a=this.get("model"),n=this.getShapeCfg(a),o=a.type,s=r.getAnchorPoints(o,n)||[];F(s,function(f,u){var h={x:i.minX+f[0]*i.width,y:i.minY+f[1]*i.height,anchorIndex:u};t.push(h)}),this.set(yt,t)}return t},e.prototype.addEdge=function(t){this.get("edges").push(t)},e.prototype.lock=function(){this.set("locked",!0)},e.prototype.unlock=function(){this.set("locked",!1)},e.prototype.hasLocked=function(){return this.get("locked")},e.prototype.removeEdge=function(t){var r=this.getEdges(),i=r.indexOf(t);i>-1&&r.splice(i,1)},e.prototype.clearCache=function(){this.set(wn,null),this.set(yt,null)},e.prototype.getUpdateType=function(t){var r,i,a,n,o;if(t){var s=!ne(t.x),f=!ne(t.y),u=Object.keys(t);if(u.length===1&&(s||f)||u.length===2&&s&&f)return"move";if(R(t.x)||R(t.y)||t.type||t.anchorPoints||t.size||t!=null&&t.style&&(!((r=t==null?void 0:t.style)===null||r===void 0)&&r.r||!((i=t==null?void 0:t.style)===null||i===void 0)&&i.width||!((a=t==null?void 0:t.style)===null||a===void 0)&&a.height||!((n=t==null?void 0:t.style)===null||n===void 0)&&n.rx||!((o=t==null?void 0:t.style)===null||o===void 0)&&o.ry))return"bbox|label";var h=u.includes("label")||u.includes("labelCfg");return h?"style|label":"style"}},e.prototype.setState=function(t,r){var i=this;if(this.optimize){l.prototype.setState.call(this,t,r);return}this.runWithBBoxAffected(function(){return l.prototype.setState.call(i,t,r)})},e.prototype.clearStates=function(t){var r=this;if(this.optimize){l.prototype.clearStates.call(this,t);return}this.runWithBBoxAffected(function(){return l.prototype.clearStates.call(r,t)})},e.prototype.runWithBBoxAffected=function(t){var r=["r","width","height","rx","ry","lineWidth"],i=this.getKeyShape().attr(),a={};Object.keys(this.getKeyShape().attr()).forEach(function(f){r.includes(f)&&(a[f]=i[f])}),t();for(var n=this.getKeyShape().attr(),o=0;o<r.length;o++){var s=r[o];if(n[s]!==a[s]){this.clearCache(),this.getEdges().forEach(function(f){return f.refresh()});break}}},e}(vi),pr="bboxCache",gr="bboxCanvasCache",je="sizeCache",yr="anchorPointsCache",gi=function(l){Re(e,l);function e(){return l!==null&&l.apply(this,arguments)||this}return e.prototype.getDefaultCfg=function(){return{type:"combo",nodes:[],edges:[],combos:[]}},e.prototype.getShapeCfg=function(t){var r=this.get("styles"),i=this.get("bbox");if(r&&i){var a=t,n=R(t.size)?[t.size,t.size]:t.size,o=R(t.fixSize)?[t.fixSize,t.fixSize]:t.fixSize,s=n||o||N.defaultCombo.size,f={r:(Math.max(i.width,i.height)||Math.max(s[0],s[1]))/2,width:i.width||s[0],height:i.height||s[1]};a.style=w(w(w({},r),t.style),f);var u=t.padding||N.defaultCombo.padding;return R(u)?(f.r+=u,f.width+=u*2,f.height+=u*2):(f.r=f.r+Math.max.apply(Math,u),f.width+=u[1]+u[3]||u[1]*2,f.height+=u[0]+u[2]||u[0]*2),this.set(je,f),a}return t},e.prototype.calculateCanvasBBox=function(){if(!this.destroyed){var t=this.get("keyShape"),r=this.get("group"),i=this.get(pr)||{},a=i.x,n=i.x,o=this.get(je),s=at(t,r);if(s.centerX=(s.minX+s.maxX)/2,s.centerY=(s.minY+s.maxY)/2,o){o.width=Math.max(o.width,s.width),o.height=Math.max(o.height,s.height),this.set(je,o);var f=t.get("type");f==="circle"?(s.width=o.r*2,s.height=o.r*2):(s.width=o.width,s.height=o.height),s.minX=s.centerX-s.width/2,s.minY=s.centerY-s.height/2,s.maxX=s.centerX+s.width/2,s.maxY=s.centerY+s.height/2}else s.width=s.maxX-s.minX,s.height=s.maxY-s.minY,s.centerX=(s.minX+s.maxX)/2,s.centerY=(s.minY+s.maxY)/2;return s.x=s.minX,s.y=s.minY,(s.x!==a||s.y!==n)&&this.set(yr,null),s}},e.prototype.getChildren=function(){var t=this;return{nodes:t.getNodes(),combos:t.getCombos()}},e.prototype.getNodes=function(){var t=this;return t.get("nodes")},e.prototype.getCombos=function(){var t=this;return t.get("combos")},e.prototype.addChild=function(t){var r=this,i=t.getType();switch(i){case"node":r.addNode(t);break;case"combo":r.addCombo(t);break;default:return console.warn("Only node or combo items are allowed to be added into a combo"),!1}return!0},e.prototype.addCombo=function(t){var r=this;return r.get("combos").push(t),!0},e.prototype.addNode=function(t){var r=this;return r.get("nodes").push(t),!0},e.prototype.removeChild=function(t){var r=this,i=t.getType();switch(i){case"node":r.removeNode(t);break;case"combo":r.removeCombo(t);break;default:return console.warn("Only node or combo items are allowed to be added into a combo"),!1}return!0},e.prototype.removeCombo=function(t){if(t){var r=this.getCombos(),i=r.indexOf(t);return i>-1?(r.splice(i,1),!0):!1}},e.prototype.removeNode=function(t){if(t){var r=this.getNodes(),i=r.indexOf(t);return i>-1?(r.splice(i,1),!0):!1}},e.prototype.getUpdateType=function(t){},e.prototype.getBBox=function(){this.set(gr,null);var t=this.calculateCanvasBBox();return t},e.prototype.clearCache=function(){this.set(pr,null),this.set(gr,null),this.set(yr,null)},e.prototype.destroy=function(){if(!this.destroyed){var t=this.get("animate"),r=this.get("group");t&&r.stopAnimate(),r.shapeMap={},this.clearCache(),this.set(je,null),this.set("bbox",null),r.remove(),this._cfg=null,this.destroyed=!0}},e}(jt),Ue="node",$e="edge",mr="vedge",ke="combo",En="default",br="Mapper",ce="stateStyles",Mn=function(){function l(e){var t=this;this.edgeToBeUpdateMap={},this.throttleRefresh=Da(function(r){var i=t.graph;if(!(!i||i.get("destroyed"))){var a=t.edgeToBeUpdateMap;if(a){var n=Object.values(a);n.length&&(n.forEach(function(o){var s=o.edge;if(!(!s||s.destroyed)){var f=s.getSource(),u=s.getTarget();!f||f.destroyed||!u||u.destroyed||s.refresh(o.updateType)}}),t.edgeToBeUpdateMap={})}}},16,{trailing:!0,leading:!0}),this.graph=e,this.destroyed=!1}return l.prototype.addItem=function(e,t){var r=this.graph,i=e===mr?$e:e,a=r.get("".concat(i,"Group"))||r.get("group"),n=wt(i),o=null,s=r.get(i+wt(ce))||{},f=r.get(En+n);t[ce]&&(s=t[ce]),f&&F(f,function(M,C){Fe(M)&&!W(M)?t[C]=_({},M,t[C]):W(M)?t[C]=t[C]||V(f[C]):t[C]=t[C]||f[C]});var u=r.get(i+br);if(u){var h=u(t);h[ce]&&(s=h[ce],delete h[ce]),F(h,function(M,C){Fe(M)&&!W(M)?t[C]=_({},t[C],M):t[C]=h[C]||t[C]})}if(r.emit("beforeadditem",{type:e,model:t}),e===$e||e===mr){var c=void 0,d=void 0;if(c=t.source,d=t.target,c&&A(c)&&(c=r.findById(c)),d&&A(d)&&(d=r.findById(d)),!c||!d){console.warn("The source or target node of edge ".concat(t.id," does not exist!"));return}c.getType&&c.getType()==="combo"&&(t.isComboEdge=!0),d.getType&&d.getType()==="combo"&&(t.isComboEdge=!0),o=new pi({model:t,source:c,target:d,styles:s,linkCenter:r.get("linkCenter"),group:a.addGroup()})}else if(e===Ue)o=new jt({model:t,styles:s,group:a.addGroup()});else if(e===ke){var p=t.children,v=Qe(p,r),g=void 0,y=void 0;if(isNaN(v.x)?isNaN(t.x)&&(g=Math.random()*100):g=v.x,isNaN(v.y)?isNaN(t.y)&&(y=Math.random()*100):y=v.y,isNaN(t.x)||isNaN(t.y))t.x=g,t.y=y;else{var m=t.x-g,b=t.y-y;this.updateComboSucceeds(t.id,m,b,p)}var S=a.addGroup();S.setZIndex(t.depth),o=new gi({model:t,styles:s,animate:r.get("animate"),bbox:t.collapsed?Qe([],r):v,group:S}),!t.collapsed&&o.getKeyShape().get("type")==="circle"&&(v.width=Math.hypot(v.height,v.width),v.height=v.width,o.set("bbox",v),o.refresh());var I=o.getModel();(p||[]).forEach(function(M){var C=r.findById(M.id);o.addChild(C),M.depth=I.depth+2})}if(o)return o.setOptimize(r.getNodes().length>r.get("optimizeThreshold")),r.get("".concat(e,"s")).push(o),r.get("itemMap")[o.get("id")]=o,r.emit("afteradditem",{item:o,model:t}),o},l.prototype.updateItem=function(e,t){var r=this,i,a,n=this.graph;if(A(e)&&(e=n.findById(e)),!(!e||e.destroyed)){var o="";e.getType&&(o=e.getType());var s=n.get(o+br),f=e.getModel(),u=f.x,h=f.y,c=e.getUpdateType(t);if(s){var d=_({},f,t),p=s(d),v=_({},f,p,t);p[ce]&&(e.set("styles",v[ce]),delete v[ce]),F(v,function(P,O){t[O]=P})}else F(t,function(P,O){f[O]&&Fe(P)&&!W(P)&&(t[O]=w(w({},f[O]),t[O]))});if(n.emit("beforeupdateitem",{item:e,cfg:t}),o===$e){if(t.source){var g=t.source;A(g)&&(g=n.findById(g)),e.setSource(g)}if(t.target){var y=t.target;A(y)&&(y=n.findById(y)),e.setTarget(y)}e.update(t)}else if(o===Ue){e.update(t,c);var m=e.getEdges();c==="move"?F(m,function(P){r.edgeToBeUpdateMap[P.getID()]={edge:P,updateType:c},r.throttleRefresh()}):c!=null&&c.includes("bbox")&&F(m,function(P){P.refresh(c)})}else if(o===ke){if(e.update(t,c),!isNaN(t.x)||!isNaN(t.y)){var b=t.x-u||0,S=t.y-h||0;this.updateComboSucceeds(f.id,b,S)}var I=e.getEdges(),M=(c==null?void 0:c.includes("bbox"))||c==="move";if(M&&o===ke){var C=e.get("shapeFactory"),E=f.type||"circle",B=f.animate===void 0||t.animate===void 0?(a=(i=C[E])===null||i===void 0?void 0:i.options)===null||a===void 0?void 0:a.animate:f.animate||t.animate;B?setTimeout(function(){if(!(!e||e.destroyed)){var P=e.getKeyShape();!P||P.destroyed||F(I,function(O){O&&!O.destroyed&&O.refresh()})}},201):F(I,function(P){P.refresh()})}}e.setOptimize(n.getNodes().length>n.get("optimizeThreshold")),n.emit("afterupdateitem",{item:e,cfg:t})}},l.prototype.updateCombo=function(e,t,r){var i=this,a,n,o=this.graph;if(A(e)&&(e=o.findById(e)),!(!e||e.destroyed)){var s=e.getModel(),f=Qe(t,o,e),u=f.x,h=f.y;e.set("bbox",f);var c=u,d=h;r?(c=isNaN(s.x)?u:s.x,d=isNaN(s.y)?h:s.y):(c=isNaN(u)?s.x:u,d=isNaN(h)?s.y:h),e.update({x:c,y:d});var p=e.get("shapeFactory"),v=s.type||"circle",g=s.animate===void 0?(n=(a=p[v])===null||a===void 0?void 0:a.options)===null||n===void 0?void 0:n.animate:s.animate;g?setTimeout(function(){if(!(!e||e.destroyed)){var y=e.getKeyShape();!y||y.destroyed||(e.getShapeCfg(s),i.updateComboEdges(e))}},201):this.updateComboEdges(e)}},l.prototype.updateComboEdges=function(e){for(var t,r,i=e.getEdges()||[],a=0;a<i.length;a++){var n=i[a];!(n!=null&&n.destroyed)&&!(!((t=n==null?void 0:n.getSource())===null||t===void 0)&&t.destroyed)&&!(!((r=n==null?void 0:n.getTarget())===null||r===void 0)&&r.destroyed)&&n.refresh()}},l.prototype.collapseCombo=function(e,t){t===void 0&&(t=!0);var r=this.graph;A(e)&&(e=r.findById(e));var i=e.getChildren();i.nodes.forEach(function(a){r.hideItem(a,t)}),i.combos.forEach(function(a){r.hideItem(a,t)})},l.prototype.updateComboSucceeds=function(e,t,r,i){var a=this;i===void 0&&(i=[]);var n=this.graph;if(!(!t&&!r)){var o=i;if(!(o!=null&&o.length)){var s=n.get("comboTrees");s==null||s.forEach(function(f){J(f,function(u){return u.id===e?(o=u.children,!1):!0})})}o==null||o.forEach(function(f){var u=n.findById(f.id);if(u){var h=u.getModel();a.updateItem(f.id,{x:(h.x||0)+t,y:(h.y||0)+r})}})}},l.prototype.expandCombo=function(e,t){t===void 0&&(t=!0);var r=this.graph;A(e)&&(e=r.findById(e));var i=e.getChildren(),a=new Set;i.nodes.forEach(function(n){r.showItem(n,t),n.getEdges().forEach(function(o){return a.add(o)})}),i.combos.forEach(function(n){n.getModel().collapsed?n.show():r.showItem(n,t),n.getEdges().forEach(function(o){return a.add(o)})}),a.forEach(function(n){return n.refresh()})},l.prototype.removeItem=function(e){var t=this,r=this.graph;if(A(e)&&(e=r.findById(e)),!(!e||e.destroyed)){var i=V(e.getModel()),a="";e.getType&&(a=e.getType()),r.emit("beforeremoveitem",{item:i,type:a});var n=r.get("".concat(a,"s")),o=n.indexOf(e);if(o>-1&&n.splice(o,1),a===$e){var s=r.get("v".concat(a,"s")),f=s.indexOf(e);f>-1&&s.splice(f,1)}var u=e.get("id"),h=r.get("itemMap");delete h[u];var c=r.get("comboTrees"),d=e.get("id");if(a===Ue){var p=e.getModel().comboId;if(c&&p){var v=c,g=!1;c.forEach(function(M){g||J(M,function(C){if(C.id===d&&v){var E=v.indexOf(C);return v.splice(E,1),g=!0,!1}return v=C.children,!0})})}for(var y=e.getEdges(),m=y.length-1;m>=0;m--)r.removeItem(y[m],!1);p&&r.updateCombo(p)}else if(a===ke){var b=e.getModel().parentId,S,I=!1;(c||[]).forEach(function(C){I||J(C,function(E){return E.id===d?(S=E,I=!0,!1):!0})}),S.removed=!0,S&&S.children&&S.children.forEach(function(C){t.removeItem(C.id)});for(var y=e.getEdges(),m=y.length;m>=0;m--)r.removeItem(y[m],!1);b&&r.updateCombo(b)}e.destroy(),r.emit("afterremoveitem",{item:i,type:a})}},l.prototype.setItemState=function(e,t,r){var i=this.graph,a=t;A(r)&&(a="".concat(t,":").concat(r)),!(e.hasState(a)===r&&r||A(r)&&e.hasState(a))&&(i.emit("beforeitemstatechange",{item:e,state:a,enabled:r}),e.setState(t,r),i.autoPaint(),i.emit("afteritemstatechange",{item:e,state:a,enabled:r}))},l.prototype.priorityState=function(e,t){var r=this.graph,i=e;A(e)&&(i=r.findById(e)),this.setItemState(i,t,!1),this.setItemState(i,t,!0)},l.prototype.clearItemStates=function(e,t){var r=this.graph;A(e)&&(e=r.findById(e)),r.emit("beforeitemstatesclear",{item:e,states:t}),e.clearStates(t),r.emit("afteritemstatesclear",{item:e,states:t})},l.prototype.refreshItem=function(e){var t=this.graph;A(e)&&(e=t.findById(e)),t.emit("beforeitemrefresh",{item:e}),e.refresh(),t.emit("afteritemrefresh",{item:e})},l.prototype.addCombos=function(e,t){var r=this,i=this.graph;(e||[]).forEach(function(n){ue(n,function(o){var s;return t.forEach(function(f){f.id===o.id&&(f.children=o.children,f.depth=o.depth,s=f)}),s&&r.addItem("combo",s),!0})});var a=i.get("comboGroup");a&&a.sort()},l.prototype.changeItemVisibility=function(e,t){var r=this,i=this.graph;if(A(e)&&(e=i.findById(e)),!e){console.warn("The item to be shown or hidden does not exist!");return}if(i.emit("beforeitemvisibilitychange",{item:e,visible:t}),e.changeVisibility(t),e.getType&&e.getType()===Ue){var a=e.getEdges();F(a,function(u){t&&!(u.get("source").isVisible()&&u.get("target").isVisible())||r.changeItemVisibility(u,t)})}else if(e.getType&&e.getType()===ke){var n=i.get("comboTrees"),o=e.get("id"),s=[],f=!1;(n||[]).forEach(function(h){f||!h.children||h.children.length===0||J(h,function(c){return c.id===o?(s=c.children,f=!0,!1):!0})}),s&&(!t||t&&!e.getModel().collapsed)&&s.forEach(function(h){var c=i.findById(h.id);r.changeItemVisibility(c,t)});var a=e.getEdges();F(a,function(h){t&&!(h.get("source").isVisible()&&h.get("target").isVisible())||r.changeItemVisibility(h,t)})}return i.emit("afteritemvisibilitychange",{item:e,visible:t}),e},l.prototype.destroy=function(){this.graph=null,this.destroyed=!0},l}(),In=function(){function l(e){this.graph=e,this.destroyed=!1}return l.prototype.updateState=function(e,t,r){var i=this.graph.get("states"),a=t;A(r)&&(a="".concat(t,":").concat(r)),i[a]||(i[a]=[]),r?i[a].push(e):i[a]=i[a].filter(function(n){return n!==e}),this.graph.set("states",i),this.graph.emit("graphstatechange",{states:i})},l.prototype.updateStates=function(e,t,r){var i=this.graph.get("states"),a=A(t)?[t]:t;a.forEach(function(n){var o=n;i[o]||(i[o]=[]),A(r)&&(o="".concat(n,":").concat(r)),r?i[o].push(e):i[o]=i[o].filter(function(s){return s!==e})}),this.graph.set("states",i),this.graph.emit("graphstatechange",{states:t})},l.prototype.destroy=function(){this.graph=null,this.destroyed=!0},l}(),Pn=function(e,t){return!e||!t?e:e.replace(/\\?\{([^{}]+)\}/g,function(r,i){if(r.charAt(0)==="\\")return r.slice(1);var a=t[i];return a===0&&(a="0"),a||""})},yi=function(e){var t=[];if(e.length<2)throw new Error("point length must largn than 2, now it's ".concat(e.length));for(var r=0,i=e;r<i.length;r++){var a=i[r],n=a.x,o=a.y;t.push(n),t.push(o)}var s=ra(t);return s.unshift(["M",e[0].x,e[0].y]),s},nt=function(e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=0);var a={x:(1-r)*e.x+r*t.x,y:(1-r)*e.y+r*t.y},n=[0,0];we(n,[t.x-e.x,t.y-e.y]),(!n||!n[0]&&!n[1])&&(n=[0,0]);var o=[-n[1]*i,n[0]*i];return a.x+=o[0],a.y+=o[1],a},kn=function(e,t){var r=e.length;if(!r)return"";for(var i="",a="",n=0;n<r;n++){var o=e[n];n===0?a="M{x} {y}":a="L{x} {y}",i+=Pn(a,o)}return t&&(i+="Z"),i},Lt=function(e){var t=[];return e.forEach(function(r){var i=r[0];if(i!=="A")for(var a=1;a<r.length;a=a+2)t.push([r[a],r[a+1]]);else{var n=r.length;t.push([r[n-2],r[n-1]])}}),t},Ft=function(e){if(e.length<2)throw new Error("point length must largn than 2, now it's ".concat(e.length));var t=e[0],r=e[1],i=e[e.length-1],a=e[e.length-2];e.unshift(i),e.unshift(a),e.push(t),e.push(r);for(var n=[],o=1;o<e.length-2;o+=1){var s=e[o-1].x,f=e[o-1].y,u=e[o].x,h=e[o].y,c=e[o+1].x,d=e[o+1].y,p=o!==e.length-2?e[o+2].x:c,v=o!==e.length-2?e[o+2].y:d,g=u+(c-s)/6,y=h+(d-f)/6,m=c-(p-u)/6,b=d-(v-h)/6;n.push(["C",g,y,m,b,c,d])}return n.unshift(["M",i.x,i.y]),n},xr=function(e,t){return he([0,0],we([0,0],e),t)},Sr=function(e,t){var r=[e[1]-t[1],t[0]-e[0]],i=Math.sqrt(r[0]*r[0]+r[1]*r[1]);if(i===0)throw new Error("p0 should not be equal to p1");return[r[0]/i,r[1]/i]},Cr=function(e,t){return[t[0]-e[0],t[1]-e[1]]};function zt(l,e){var t=function(h){var c=[h[0][0],h[0][1]-e],d=[h[0][0],h[0][1]+e];return"M ".concat(c," A ").concat(e,",").concat(e,",0,0,0,").concat(d," A ").concat(e,",").concat(e,",0,0,0,").concat(c)},r=function(h){var c=he([0,0],Sr(h[0],h[1]),e),d=he([0,0],c,-1),p=ie([0,0],h[0],c),v=ie([0,0],h[1],c),g=ie([0,0],h[1],d),y=ie([0,0],h[0],d);return"M ".concat(p," L ").concat(v," A ").concat([e,e,"0,0,0",g].join(",")," L ").concat(y," A ").concat([e,e,"0,0,0",p].join(","))};if(!l||l.length<1)return"";if(l.length===1)return t(l);if(l.length===2)return r(l);for(var i=new Array(l.length),a=0;a<i.length;++a){var n=a===0?l[l.length-1]:l[a-1],o=l[a],s=he([0,0],Sr(n,o),e);i[a]=[ie([0,0],n,s),ie([0,0],o,s)]}var f="A ".concat([e,e,"0,0,0,"].join(","));return i=i.map(function(u,h){var c="";return h===0&&(c="M ".concat(i[i.length-1][1]," ")),c+="".concat(f+u[0]," L ").concat(u[1]),c}),i.join(" ")}function mi(l,e){var t=l.length,r=function(u){var h=[u[0][0],u[0][1]-e],c=[u[0][0],u[0][1]+e];return"M ".concat(h," A ").concat([e,e,"0,0,0",c].join(",")," A ").concat([e,e,"0,0,0",h].join(","))},i=function(u){var h=Cr(u[0],u[1]),c=xr(h,e),d=ie([0,0],u[0],he([0,0],c,-1)),p=ie([0,0],u[1],c),v=1.2*e,g=xr(we([0,0],h),v),y=he([0,0],g,-1),m=ie([0,0],d,y),b=ie([0,0],p,y),S=ie([0,0],d,g);return"M ".concat(d," C ").concat([m,b,p].join(",")," S ").concat([S,d].join(",")," Z")};if(!l||t<1)return"";if(t===1)return r(l);if(t===2)return i(l);for(var a=l.map(function(f,u){var h=l[(u+1)%t];return{p:f,v:we([0,0],Cr(f,h))}}),n=0;n<a.length;++n){var o=n>0?n-1:t-1,s=we([0,0],ie([0,0],a[o].v,he([0,0],a[n].v,-1)));a[n].p=ie([0,0],a[n].p,he([0,0],s,e))}return a.map(function(f){var u=f.p;return{x:u[0],y:u[1]}})}var Bn=function(e,t){for(var r=[],i=0;i<5;i++){var a=Math.cos((18+72*i)/180*Math.PI)*e,n=Math.sin((18+72*i)/180*Math.PI)*e,o=Math.cos((54+72*i)/180*Math.PI)*t,s=Math.sin((54+72*i)/180*Math.PI)*t;i===0?r.push(["M",a,-n]):r.push(["L",a,-n]),r.push(["L",o,-s])}return r.push(["Z"]),r};const Tn=Object.freeze(Object.defineProperty({__proto__:null,getClosedSpline:Ft,getControlPoint:nt,getSpline:yi,getStarPath:Bn,paddedHull:mi,pathToPoints:Lt,pointsToPolygon:kn,roundedHull:zt},Symbol.toStringTag,{value:"Module"}));var wr=function(e,t,r){return(e.y-r.y)*(t.x-r.x)-(e.x-r.x)*(t.y-r.y)},Er=function(e){var t=e.map(function(h){return{x:h.getModel().x,y:h.getModel().y}});t.sort(function(h,c){return h.x===c.x?h.y-c.y:h.x-c.x});for(var r={},i=t.length-1;i>=0;i--){var a=t[i],n=a.x,o=a.y;r["".concat(n,"-").concat(o)]&&t.splice(i,1),r["".concat(n,"-").concat(o)]=!0}if(t.length===1)return t;for(var s=[],i=0;i<t.length;i++){for(;s.length>=2&&wr(s[s.length-2],s[s.length-1],t[i])<=0;)s.pop();s.push(t[i])}for(var f=[],i=t.length-1;i>=0;i--){for(;f.length>=2&&wr(f[f.length-2],f[f.length-1],t[i])<=0;)f.pop();f.push(t[i])}f.pop(),s.pop();var u=s.concat(f);return u},Nn={maxRoutingIterations:100,maxMarchingIterations:100,pixelGroupSize:2,edgeR0:10,edgeR1:10,nodeR0:5,nodeR1:10,morphBuffer:5,threshold:.001,skip:16,nodeInfluenceFactor:1,edgeInfluenceFactor:1,negativeNodeInfluenceFactor:-.5};function An(l,e,t){var r=!1,i=function(s,f){return e.cells[s+f*e.width]},a=function(s,f){var u=0;return i(s-1,f-1)>=t&&(u+=1),i(s,f-1)>t&&(u+=2),i(s-1,f)>t&&(u+=4),i(s,f)>t&&(u+=8),u},n=function(s,f){for(var u=s,h=f,c,d,p=0;p<e.width*e.height;p++){if(c=u,d=h,l.findIndex(function(g){return g.x===u&&g.y===h})>-1){if(!(l[0].x!==u||l[0].y!==h))return!0}else l.push({x:u,y:h});var v=a(u,h);switch(v){case-1:return console.warn("Marched out of bounds"),!0;case 0:case 3:case 2:case 7:u++;break;case 12:case 14:case 4:u--;break;case 6:c===0&&(d===-1?u-=1:u+=1);break;case 1:case 13:case 5:h--;break;case 9:c===1&&(d===0?h-=1:h+=1);break;case 10:case 8:case 11:h++;break;default:return console.warn("Marching squares invalid state: ".concat(v)),!0}}};this.march=function(){for(var o=0;o<e.width&&!r;o+=1)for(var s=0;s<e.height&&!r;s+=1)i(o,s)>t&&a(o,s)!==15&&(r=n(o,s));return r}}var On=function(e,t,r){var i=Math.ceil(e/r),a=Math.ceil(t/r),n=new Float32Array(Math.max(0,i*a)).fill(0);return{cells:n,width:i,height:a}},Ln=function(e,t,r){var i=null,a=Number.POSITIVE_INFINITY;return t.forEach(function(n){var o={x:e.getModel().x,y:e.getModel().y},s={x:n.getModel().x,y:n.getModel().y},f=it(o,s),u=new be(o.x,o.y,s.x,s.y),h=r.reduce(function(c,d){return Vt(d,u)>0?c+1:c},0);f*Math.pow(h+1,2)<a&&(i=n,a=f*Math.pow(h+1,2))}),i},bi=function(e,t){var r=Number.POSITIVE_INFINITY,i=null;return e.forEach(function(a){var n=Vt(a,t);n>=0&&n<r&&(i=a,r=n)}),i},Fn=function(e,t,r,i){var a=[],n=[];n.push(e);for(var o=!0,s=0,f=function(d,p){var v=!1;return p.forEach(function(g){v||(It(d,{x:g.x1,y:g.y1})||It(d,{x:g.x2,y:g.y2}))&&(v=!0)}),v},u=function(d,p){for(var v=0,g=p;v<g.length;v++){var y=g[v],m=y.getBBox(),b=[[m.x,m.y],[m.x+m.width,m.y],[m.x,m.y+m.height],[m.x+m.width,m.y+m.height]];if(Xe(b,d.x,d.y))return!0}return!1};o&&s<r;){o=!1;for(var h=function(){var d=n.pop(),p=bi(t,d);if(p){var v=ei(p,d),g=v[0],y=v[1];if(y===2){var m=function(S){for(var I=i,M=Mr(p,I,g,S),C=f(M,n)||f(M,a),E=u(M,t);!C&&E&&I>=1;)I/=1.5,M=Mr(p,I,g,S),C=f(M,n)||f(M,a),E=u(M,t);M&&!C&&(!S||!E)&&(n.push(new be(d.x1,d.y1,M.x,M.y)),n.push(new be(M.x,M.y,d.x2,d.y2)),o=!0)};m(!0),o||m(!1)}}o||a.push(d),s+=1};!o&&n.length;)h()}for(;n.length;)a.push(n.pop());return a};function zn(l,e,t,r,i){var a=Ln(l,t,e);if(a===null)return[];var n=function(h){for(var c=[];h.length>0;){var d=h.pop();if(h.length===0){c.push(d);break}var p=h.pop(),v=new be(d.x1,d.y1,p.x2,p.y2),g=bi(e,v);g?(c.push(d),h.push(p)):h.push(v)}return c},o=new be(l.getModel().x,l.getModel().y,a.getModel().x,a.getModel().y),s=Fn(o,e,r,i),f=n(s);return f}var Xn=function(e,t,r){var i=Object.assign(Nn,r),a=ti(e.map(function(m){return{x:m.getModel().x,y:m.getModel().y}}));e=e.sort(function(m,b){return it({x:m.getModel().x,y:m.getModel().y},a)-it({x:b.getModel().x,y:b.getModel().y},a)});var n=[],o=[];e.forEach(function(m){var b=zn(m,t,n,i.maxRoutingIterations,i.morphBuffer);b.forEach(function(S){o.push(S)}),n.push(m)});for(var s=Yn(e,o,i.nodeR0),f=On(s.width,s.height,i.pixelGroupSize),u=[],h=[],c=0;c<i.maxMarchingIterations;c++)if(Rn(e,t,o,s,f,i),u=[],h=[],!!new An(u,f,i.threshold).march()){var d=u.map(function(m){return{x:Math.round(m.x*i.pixelGroupSize+s.minX),y:Math.round(m.y*i.pixelGroupSize+s.minY)}});if(d){var p=d.length;if(i.skip>1)for(p=Math.floor(d.length/i.skip);p<3&&i.skip>1;)i.skip-=1,p=Math.floor(d.length/i.skip);for(var v=0,g=0;g<p;g+=1,v+=i.skip)h.push({x:d[v].x,y:d[v].y})}var y=function(){for(var b=0,S=e;b<S.length;b++){var I=S[b],M=h.map(function(C){return[C.x,C.y]});if(!Xe(M,I.getBBox().centerX,I.getBBox().centerY))return!1}return!0};if(h&&y())return h;if(i.threshold*=.9,c<=i.maxMarchingIterations*.5)i.memberInfluenceFactor*=1.2,i.edgeInfluenceFactor*=1.2;else if(i.nonMemberInfluenceFactor!==0&&t.length>0)i.nonMemberInfluenceFactor*=.8;else break}return h};function Yn(l,e,t){var r={minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY,width:0,height:0,x:0,y:0},i=[];l.forEach(function(s){i.push(s.getBBox())}),e.forEach(function(s){i.push(s.getBBox())});for(var a=0,n=i;a<n.length;a++){var o=n[a];r.minX=(o.minX<r.minX?o.minX:r.minX)-t,r.minY=(o.minY<r.minY?o.minY:r.minY)-t,r.maxX=(o.maxX>r.maxX?o.maxX:r.maxX)+t,r.maxY=(o.maxY>r.maxY?o.maxY:r.maxY)+t}return r.width=r.maxX-r.minX,r.height=r.maxY-r.minY,r.x=r.minX,r.y=r.minY,r}function Rn(l,e,t,r,i,a){function n(d,p){var v=Math.floor((d-p)/a.pixelGroupSize);return v<0?0:v}function o(d,p){return d*a.pixelGroupSize+p}var s=(a.nodeR0-a.nodeR1)*(a.nodeR0-a.nodeR1),f=(a.edgeR0-a.edgeR1)*(a.edgeR0-a.edgeR1),u=function(p,v){var g=Math.min(n(p.minX,v+r.minX),i.width),y=Math.min(n(p.minY,v+r.minY),i.height),m=Math.min(n(p.maxX,-v+r.minX),i.width),b=Math.min(n(p.maxY,-v+r.minY),i.height);return[g,y,m,b]},h=function(p,v){for(var g=p.getBBox(),y=u(g,a.nodeR1),m=y[0],b=y[1],S=y[2],I=y[3],M=b;M<I;M+=1)for(var C=m;C<S;C+=1)if(!(v<0&&i[C+M*i.width]<=0)){var E=o(C,r.minX),B=o(M,r.minY),P=ii({x:E,y:B},{x:g.minX,y:g.minY,width:g.width,height:g.height});if(P<Math.pow(a.nodeR1,2)){var O=Math.sqrt(P)-a.nodeR1;i.cells[C+M*i.width]+=v*O*O}}},c=function(p,v){for(var g=p.getBBox(),y=u(g,a.edgeR1),m=y[0],b=y[1],S=y[2],I=y[3],M=b;M<I;M+=1)for(var C=m;C<S;C+=1)if(!(v<0&&i.cells[C+M*i.width]<=0)){var E=o(C,r.minX),B=o(M,r.minY),P=ri({x:E,y:B},p);if(P<Math.pow(a.edgeR1,2)){var O=Math.sqrt(P)-a.edgeR1;i.cells[C+M*i.width]+=v*O*O}}};a.nodeInfluenceFactor&&l.forEach(function(d){h(d,a.nodeInfluenceFactor/s)}),a.edgeInfluenceFactor&&t.forEach(function(d){c(d,a.edgeInfluenceFactor/f)}),a.negativeNodeInfluenceFactor&&e.forEach(function(d){h(d,a.negativeNodeInfluenceFactor/s)})}function Mr(l,e,t,r){var i=l.getBBox(),a=t[0],n=t[1],o=t[2],s=t[3],f={topLeft:{x:i.minX-e,y:i.minY-e},topRight:{x:i.maxX+e,y:i.minY-e},bottomLeft:{x:i.minX-e,y:i.maxY+e},bottomRight:{x:i.maxX+e,y:i.maxY+e}},u=i.height*i.width;function h(p,v){return i.width*((p.y-i.minY+(v.y-i.minY))*.5)}if(n){if(a)return r?f.topLeft:f.bottomRight;if(o)return r?f.bottomLeft:f.topRight;var c=h(n,s);return c<u*.5?n.y>s.y?r?f.topLeft:f.bottomRight:r?f.topRight:f.bottomLeft:n.y<s.y?r?f.bottomLeft:f.topRight:r?f.bottomRight:f.topLeft}if(s){if(a)return r?f.topRight:f.bottomLeft;if(o)return r?f.bottomRight:f.topLeft}var d=h(a,o);return d<u*.5?a.x>o.x?r?f.topLeft:f.bottomRight:r?f.bottomLeft:f.topRight:a.x<o.x?r?f.topRight:f.bottomLeft:r?f.bottomRight:f.topLeft}var xi=function(){function l(e,t){this.cfg=_(this.getDefaultCfg(),t),this.graph=e,this.id=this.cfg.id,this.group=this.cfg.group,this.members=this.cfg.members.map(function(r){return A(r)?e.findById(r):r}),this.nonMembers=this.cfg.nonMembers.map(function(r){return A(r)?e.findById(r):r}),this.setPadding(),this.setType(),this.path=this.calcPath(this.members,this.nonMembers),this.render()}return l.prototype.getDefaultCfg=function(){return{id:"g6-hull",type:"round-convex",members:[],nonMembers:[],style:{fill:"lightblue",stroke:"blue",opacity:.2},padding:10}},l.prototype.setPadding=function(){var e=this.members.length&&this.members[0].getKeyShape().getCanvasBBox().width/2;this.padding=this.cfg.padding>0?this.cfg.padding+e:10+e,this.cfg.bubbleCfg={nodeR0:this.padding-e,nodeR1:this.padding-e,morphBuffer:this.padding-e}},l.prototype.setType=function(){this.type=this.cfg.type,this.members.length<3&&(this.type="round-convex"),this.type!=="round-convex"&&this.type!=="smooth-convex"&&this.type!=="bubble"&&(console.warn("The hull type should be either round-convex, smooth-convex or bubble, round-convex is used by default."),this.type="round-convex")},l.prototype.calcPath=function(e,t){var r,i,a;switch(this.type){case"round-convex":r=Er(e),a=zt(r.map(function(n){return[n.x,n.y]}),this.padding),i=tr(a);break;case"smooth-convex":r=Er(e),r.length===2?(a=zt(r.map(function(n){return[n.x,n.y]}),this.padding),i=tr(a)):r.length>2&&(a=mi(r.map(function(n){return[n.x,n.y]}),this.padding),i=Ft(a));break;case"bubble":r=Xn(e,t,this.cfg.bubbleCfg),i=r.length>=2&&Ft(r);break}return i},l.prototype.render=function(){this.group.addShape("path",{attrs:w({path:this.path},this.cfg.style),id:this.id,name:this.cfg.id,capture:!1}),this.group.toBack()},l.prototype.addMember=function(e){if(e){A(e)&&(e=this.graph.findById(e)),this.members.push(e);var t=this.nonMembers.indexOf(e);return t>-1&&this.nonMembers.splice(t,1),this.updateData(this.members,this.nonMembers),!0}},l.prototype.addNonMember=function(e){if(e){A(e)&&(e=this.graph.findById(e)),this.nonMembers.push(e);var t=this.members.indexOf(e);return t>-1&&this.members.splice(t,1),this.updateData(this.members,this.nonMembers),!0}},l.prototype.removeMember=function(e){if(e){A(e)&&(e=this.graph.findById(e));var t=this.members.indexOf(e);return t>-1?(this.members.splice(t,1),this.updateData(this.members,this.nonMembers),!0):!1}},l.prototype.removeNonMember=function(e){if(e){A(e)&&(e=this.graph.findById(e));var t=this.nonMembers.indexOf(e);return t>-1?(this.nonMembers.splice(t,1),this.updateData(this.members,this.nonMembers),!0):!1}},l.prototype.updateData=function(e,t){var r=this;this.group.findById(this.id).remove(),e&&(this.members=e.map(function(i){return A(i)?r.graph.findById(i):i})),t&&(this.nonMembers=t.map(function(i){return A(i)?r.graph.findById(i):i})),this.path=this.calcPath(this.members,this.nonMembers),this.render()},l.prototype.updateStyle=function(e){var t=this.group.findById(this.id);t.attr(w({},e))},l.prototype.updateCfg=function(e){var t=this;this.cfg=_(this.cfg,e),this.id=this.cfg.id,this.group=this.cfg.group,e.members&&(this.members=this.cfg.members.map(function(r){return A(r)?t.graph.findById(r):r})),e.nonMembers&&(this.nonMembers=this.cfg.nonMembers.map(function(r){return A(r)?t.graph.findById(r):r})),this.setPadding(),this.setType(),this.path=this.calcPath(this.members,this.nonMembers),this.render()},l.prototype.contain=function(e){var t=this,r;A(e)?r=this.graph.findById(e):r=e;var i,a=r.getKeyShape();if(r.get("type")==="path")i=Lt(a.attr("path"));else{var n=a.getCanvasBBox();i=[[n.minX,n.minY],[n.maxX,n.minY],[n.maxX,n.maxY],[n.minX,n.maxY]]}return i=i.map(function(o){var s=t.graph.getPointByCanvas(o[0],o[1]);return[s.x,s.y]}),_r(i,Lt(this.path))},l.prototype.destroy=function(){this.group.remove(),this.cfg=null},l}(),Be=ot,Dn="node",Gn=function(l){Re(e,l);function e(t){var r=l.call(this)||this;return r.sortCombos=za(function(){var i=r.get("comboSorted");if(!(!r||r.destroyed||i)){r.set("comboSorted",!0);var a=[],n={},o=r.get("comboTrees");(o||[]).forEach(function(f){J(f,function(u){return a[u.depth]?a[u.depth].push(u.id):a[u.depth]=[u.id],n[u.id]=u.depth,!0})});var s=r.getEdges().concat(r.get("vedges"));(s||[]).forEach(function(f){var u=f.getModel(),h=n[u.source]||0,c=n[u.target]||0,d=Math.max(h,c);a[d]?a[d].push(u.id):a[d]=[u.id]}),a.forEach(function(f){if(!(!f||!f.length))for(var u=f.length-1;u>=0;u--){var h=r.findById(f[u]);h&&h.toFront()}})}},500,!1),r.cfg=_(r.getDefaultCfg(),t),r.init(),r.animating=!1,r.destroyed=!1,r.cfg.enabledStack&&(r.undoStack=new De(r.cfg.maxStep),r.redoStack=new De(r.cfg.maxStep)),r}return e.prototype.init=function(){this.initCanvas();var t=new yn(this),r=new hn(this),i=new Mn(this),a=new In(this);this.set({viewController:t,modeController:r,itemController:i,stateController:a}),this.initLayoutController(),this.initEventController(),this.initGroups(),this.initPlugins()},e.prototype.initGroups=function(){var t=this.get("canvas");if(t){var r=t.get("el"),i=(r||{}).id,a=i===void 0?"g6":i,n=t.addGroup({id:"".concat(a,"-root"),className:N.rootContainerClassName});if(this.get("groupByTypes")){var o=n.addGroup({id:"".concat(a,"-edge"),className:N.edgeContainerClassName}),s=n.addGroup({id:"".concat(a,"-node"),className:N.nodeContainerClassName}),f=n.addGroup({id:"".concat(a,"-combo"),className:N.comboContainerClassName});f.toBack(),this.set({nodeGroup:s,edgeGroup:o,comboGroup:f})}var u=n.addGroup({id:"".concat(a,"-delegate"),className:N.delegateContainerClassName});this.set({delegateGroup:u}),this.set("group",n)}},e.prototype.getDefaultCfg=function(){return{container:void 0,width:void 0,height:void 0,renderer:"canvas",modes:{},plugins:[],data:{},fitViewPadding:10,minZoom:.02,maxZoom:10,event:!0,groupByTypes:!0,directed:!1,autoPaint:!0,nodes:[],edges:[],combos:[],vedges:[],itemMap:{},linkCenter:!1,defaultNode:{},defaultEdge:{},nodeStateStyles:{},edgeStateStyles:{},states:{},animate:!1,animateCfg:{onFrame:void 0,duration:500,easing:"easeLinear"},callback:void 0,enabledStack:!1,maxStep:10,tooltips:[],optimizeThreshold:1e3}},e.prototype.set=function(t,r){return re(t)?this.cfg=w(w({},this.cfg),t):this.cfg[t]=r,t==="enabledStack"&&r&&!this.undoStack&&!this.redoStack&&(this.undoStack=new De(this.cfg.maxStep),this.redoStack=new De(this.cfg.maxStep)),this},e.prototype.get=function(t){var r;return(r=this.cfg)===null||r===void 0?void 0:r[t]},e.prototype.getGroup=function(){return this.get("group")},e.prototype.getContainer=function(){return this.get("container")},e.prototype.getMinZoom=function(){return this.get("minZoom")},e.prototype.setMinZoom=function(t){return this.set("minZoom",t)},e.prototype.getMaxZoom=function(){return this.get("maxZoom")},e.prototype.setMaxZoom=function(t){return this.set("maxZoom",t)},e.prototype.getWidth=function(){return this.get("width")},e.prototype.getHeight=function(){return this.get("height")},e.prototype.clearItemStates=function(t,r){A(t)&&(t=this.findById(t));var i=this.get("itemController");r||(r=t.get("states")),i.clearItemStates(t,r);var a=this.get("stateController");a.updateStates(t,r,!1)},e.prototype.node=function(t){typeof t=="function"&&this.set("nodeMapper",t)},e.prototype.edge=function(t){typeof t=="function"&&this.set("edgeMapper",t)},e.prototype.combo=function(t){typeof t=="function"&&this.set("comboMapper",t)},e.prototype.findById=function(t){return this.get("itemMap")[t]},e.prototype.find=function(t,r){var i,a=this.get("".concat(t,"s"));return F(a,function(n,o){if(r(n,o))return i=n,i}),i},e.prototype.findAll=function(t,r){var i=[];return F(this.get("".concat(t,"s")),function(a,n){r(a,n)&&i.push(a)}),i},e.prototype.findAllByState=function(t,r,i){return i?this.findAll(t,function(a){return a.hasState(r)&&i(a)}):this.findAll(t,function(a){return a.hasState(r)})},e.prototype.translate=function(t,r,i,a){var n=this,o=this.get("group"),s=V(o.getMatrix());if(s||(s=[1,0,0,0,1,0,0,0,1]),i){var f=Ye({animateCfg:a,callback:function(){return n.emit("viewportchange",{action:"translate",matrix:o.getMatrix()})}});Mt(o,{x:o.getCanvasBBox().x+t,y:o.getCanvasBBox().y+r},i,f||{duration:500,easing:"easeCubic"})}else s=Be(s,[["t",t,r]]),o.setMatrix(s),this.emit("viewportchange",{action:"translate",matrix:s}),this.autoPaint()},e.prototype.moveTo=function(t,r,i,a){var n=this.get("group");Mt(n,{x:t,y:r},i,a||{duration:500,easing:"easeCubic"}),this.emit("viewportchange",{action:"move",matrix:n.getMatrix()})},e.prototype.fitView=function(t,r,i,a){t&&this.set("fitViewPadding",t);var n=this.get("viewController");r?n.fitViewByRules(r,i,a):n.fitView(i,a),this.autoPaint()},e.prototype.fitCenter=function(t,r){var i=this.get("viewController");i.fitCenter(t,r),this.autoPaint()},e.prototype.addBehaviors=function(t,r){var i=this.get("modeController");return i.manipulateBehaviors(t,r,!0),this},e.prototype.removeBehaviors=function(t,r){var i=this.get("modeController");return i.manipulateBehaviors(t,r,!1),this},e.prototype.updateBehavior=function(t,r,i){var a=this.get("modeController");return a.updateBehavior(t,r,i),this},e.prototype.zoom=function(t,r,i,a){var n=this,o=this.get("group"),s=V(o.getMatrix())||[1,0,0,0,1,0,0,0,1],f=this.get("minZoom"),u=this.get("maxZoom"),h=this.getZoom()||1,c=h*t,d=t,p=!1;if(f&&c<f?(d=f/h,p=!0):u&&c>u&&(d=u/h,p=!0),r?s=Be(s,[["t",-r.x,-r.y],["s",d,d],["t",r.x,r.y]]):s=Be(s,[["s",d,d]]),i){var v=V(o.getMatrix());v||(v=[1,0,0,0,1,0,0,0,1]);var g=v[0],y=g*d,m=Ye({animateCfg:a,callback:function(){return n.emit("viewportchange",{action:"zoom",matrix:o.getMatrix()})}});o.animate(function(b){if(b===1)v=s;else{var S=Wt(g,y,b)/v[0];r?v=Be(v,[["t",-r.x,-r.y],["s",S,S],["t",r.x,r.y]]):v=Be(v,[["s",S,S]])}return{matrix:v}},m)}else o.setMatrix(s),this.emit("viewportchange",{action:"zoom",matrix:s}),this.autoPaint();return!p},e.prototype.zoomTo=function(t,r,i,a){var n=t/this.getZoom();return this.zoom(n,r,i,a)},e.prototype.focusItem=function(t,r,i){var a=this.get("viewController"),n=!1;r?n=!0:r===void 0&&(n=this.get("animate"));var o={};i?o=i:i===void 0&&(o=this.get("animateCfg")),a.focus(t,n,o),this.autoPaint()},e.prototype.focusItems=function(t,r,i,a){var n=this.get("viewController");n.focusItems(t,r,i,a)},e.prototype.autoPaint=function(){this.get("autoPaint")&&this.paint()},e.prototype.paint=function(){this.emit("beforepaint"),this.get("canvas").draw(),this.emit("afterpaint")},e.prototype.getPointByClient=function(t,r){var i=this.get("viewController");return i.getPointByClient(t,r)},e.prototype.getClientByPoint=function(t,r){var i=this.get("viewController");return i.getClientByPoint(t,r)},e.prototype.getPointByCanvas=function(t,r){var i=this.get("viewController");return i.getPointByCanvas(t,r)},e.prototype.getCanvasByPoint=function(t,r){var i=this.get("viewController");return i.getCanvasByPoint(t,r)},e.prototype.getGraphCenterPoint=function(){var t=this.get("group").getCanvasBBox();return{x:(t.minX+t.maxX)/2,y:(t.minY+t.maxY)/2}},e.prototype.getViewPortCenterPoint=function(){return this.getPointByCanvas(this.get("width")/2,this.get("height")/2)},e.prototype.showItem=function(t,r){r===void 0&&(r=!0);var i=this.get("itemController"),a=i.changeItemVisibility(t,!0);if(r&&this.get("enabledStack")){var n=a.getID(),o=a.getType(),s={},f={};switch(o){case"node":s.nodes=[{id:n,visible:!1}],f.nodes=[{id:n,visible:!0}];break;case"edge":s.nodes=[{id:n,visible:!1}],f.edges=[{id:n,visible:!0}];break;case"combo":s.nodes=[{id:n,visible:!1}],f.combos=[{id:n,visible:!0}];break}this.pushStack("visible",{before:s,after:f})}},e.prototype.hideItem=function(t,r){r===void 0&&(r=!0);var i=this.get("itemController"),a=i.changeItemVisibility(t,!1);if(r&&this.get("enabledStack")){var n=a.getID(),o=a.getType(),s={},f={};switch(o){case"node":s.nodes=[{id:n,visible:!0}],f.nodes=[{id:n,visible:!1}];break;case"edge":s.nodes=[{id:n,visible:!0}],f.edges=[{id:n,visible:!1}];break;case"combo":s.nodes=[{id:n,visible:!0}],f.combos=[{id:n,visible:!1}];break}this.pushStack("visible",{before:s,after:f})}},e.prototype.refreshItem=function(t){var r=this.get("itemController");r.refreshItem(t)},e.prototype.setAutoPaint=function(t){var r=this;r.set("autoPaint",t);var i=r.get("canvas");i.set("autoDraw",t)},e.prototype.remove=function(t,r){r===void 0&&(r=!0),this.removeItem(t,r)},e.prototype.removeItem=function(t,r){r===void 0&&(r=!0);var i=t;if(A(t)&&(i=this.findById(t)),!i&&A(t))console.warn("The item ".concat(t," to be removed does not exist!"));else if(i){var a="";if(i.getType&&(a=i.getType()),r&&this.get("enabledStack")){var n=w(w({},i.getModel()),{itemType:a}),o={};switch(a){case"node":{o.nodes=[n],o.edges=[];for(var s=i.getEdges(),f=s.length-1;f>=0;f--)o.edges.push(w(w({},s[f].getModel()),{itemType:"edge"}));break}case"edge":o.edges=[n];break;case"combo":o.combos=[n];break}this.pushStack("delete",{before:o,after:{}})}if(a==="node"){var u=i.getModel();u.comboId&&this.updateComboTree(i,void 0,!1)}var h=this.get("itemController");if(h.removeItem(i),a==="combo"){var c=Nt(this.get("comboTrees"));this.set("comboTrees",c)}}},e.prototype.innerAddItem=function(t,r,i){if(!fn(t,r))return!1;if(r.id&&this.findById(r.id)){console.warn("This item exists already. Be sure the id %c".concat(r.id,"%c is unique."),"font-size: 20px; color: red;","");return}var a,n=this.get("comboTrees")||[];if(t==="combo"){var o=this.get("itemMap"),s=!1;if(n.forEach(function(p){s||ue(p,function(v){if(r.parentId===v.id){s=!0;var g=w({id:r.id,depth:v.depth+2},r);v.children?v.children.push(g):v.children=[g],r.depth=g.depth,a=i.addItem(t,r)}var y=o[v.id];return s&&y&&y.getType&&y.getType()==="combo"&&i.updateCombo(y,v.children),!0})}),!s){var f=w({id:r.id,depth:0},r);r.depth=f.depth,n.push(f),a=i.addItem(t,r)}this.set("comboTrees",n),r.collapsed&&(this.collapseCombo(a,!1),this.updateCombo(a))}else if(t==="node"&&A(r.comboId)&&n){var u=this.findById(r.comboId);u&&u.getType&&u.getType()!=="combo"&&console.warn("'".concat(r.comboId,"' is not a id of a combo in the graph, the node will be added without combo.")),a=i.addItem(t,r);var h=this.get("itemMap"),c=!1,d=!1;n.forEach(function(p){d||c||ue(p,function(v){if(v.id===r.id)return d=!0,!1;if(r.comboId===v.id&&!d){c=!0;var g=V(r);g.itemType="node",v.children?v.children.push(g):v.children=[g],g.depth=v.depth+1}return c&&h[v.id].getType&&h[v.id].getType()==="combo"&&i.updateCombo(h[v.id],v.children),!0})})}else a=i.addItem(t,r);if(t==="node"&&r.comboId||t==="combo"&&r.parentId){var u=this.findById(r.comboId||r.parentId);u&&u.getType&&u.getType()==="combo"&&u.addChild(a)}return a},e.prototype.addItem=function(t,r,i,a){i===void 0&&(i=!0),a===void 0&&(a=!0);var n=this.get("comboSorted");this.set("comboSorted",n&&!a);var o=this.get("itemController"),s=this.innerAddItem(t,r,o);if(s===!1||s===!0)return s;var f=this.get("combos");if(f&&f.length>0&&this.sortCombos(),this.autoPaint(),i&&this.get("enabledStack")){var u=w(w({},s.getModel()),{itemType:t}),h={};switch(t){case"node":h.nodes=[u];break;case"edge":h.edges=[u];break;case"combo":h.combos=[u];break}this.pushStack("add",{before:{},after:h})}return s},e.prototype.addItems=function(t,r,i){t===void 0&&(t=[]),r===void 0&&(r=!0),i===void 0&&(i=!0);var a=this.get("comboSorted");this.set("comboSorted",a&&!i);for(var n=this.get("itemController"),o=[],s=0;s<t.length;s++){var f=t[s];f.type!=="edge"&&f.type!=="vedge"?o.push(this.innerAddItem(f.type,f.model,n)):o.push(void 0)}for(var s=0;s<t.length;s++){var f=t[s];(f.type==="edge"||f.type==="vedge")&&(o[s]=this.innerAddItem(f.type,f.model,n))}if(i){var u=this.get("combos");u&&u.length>0&&this.sortCombos()}if(this.autoPaint(),r&&this.get("enabledStack")){for(var h={nodes:[],edges:[],combos:[]},s=0;s<t.length;s++){var c=t[s].type,d=o[s];if(d&&d!==!0){var p=w(w({},d.getModel()),{itemType:c});switch(c){case"node":h.nodes.push(p);break;case"edge":h.edges.push(p);break;case"combo":h.combos.push(p);break}}}this.pushStack("addItems",{before:{},after:h})}return o},e.prototype.add=function(t,r,i,a){return i===void 0&&(i=!0),a===void 0&&(a=!0),this.addItem(t,r,i,a)},e.prototype.updateItem=function(t,r,i){var a=this;i===void 0&&(i=!0);var n=this.get("itemController"),o;A(t)?o=this.findById(t):o=t;var s=i&&this.get("enabledStack"),f;s&&(f=V(o.getModel()));var u="";o.getType&&(u=o.getType());var h=Le([],o.getStates(),!0);if(u==="combo"&&F(h,function(v){return a.setItemState(o,v,!1)}),n.updateItem(o,r),u==="combo"&&F(h,function(v){return a.setItemState(o,v,!0)}),s){var c={nodes:[],edges:[],combos:[]},d={nodes:[],edges:[],combos:[]},p=w({id:f.id},r);switch(u){case"node":c.nodes.push(f),d.nodes.push(p);break;case"edge":c.edges.push(f),d.edges.push(p);break;case"combo":c.combos.push(f),d.combos.push(p);break}this.pushStack("update",{before:c,after:d})}},e.prototype.update=function(t,r,i){i===void 0&&(i=!0),this.updateItem(t,r,i)},e.prototype.setItemState=function(t,r,i){A(t)&&(t=this.findById(t));var a=this.get("itemController");a.setItemState(t,r,i);var n=this.get("stateController");n.updateState(t,r,i)},e.prototype.priorityState=function(t,r){var i=this.get("itemController");i.priorityState(t,r)},e.prototype.data=function(t){hr(t),this.set("data",t)},e.prototype.render=function(){var t=this;this.set("comboSorted",!1);var r=this.get("data");if(this.get("enabledStack")&&this.clearStack(),!r)throw new Error("data must be defined first");var i=r.nodes,a=i===void 0?[]:i,n=r.edges,o=n===void 0?[]:n,s=r.combos,f=s===void 0?[]:s;if(this.clear(!0),this.emit("beforerender"),t.addItems(a.map(function(g){return{type:"node",model:g}}),!1,!1),(f==null?void 0:f.length)!==0){var u=Tt(f,a);this.set("comboTrees",u),t.addCombos(f)}t.addItems(o.map(function(g){return{type:"edge",model:g}}),!1,!1);var h=t.get("animate");(t.get("fitView")||t.get("fitCenter"))&&t.set("animate",!1);var c=t.get("layoutController");if(c){if(c.layout(d),this.destroyed)return}else d();function d(){(t.get("comboTrees")||[]).forEach(function(g){ue(g,function(y){var m=t.findById(y.id);return m.getType()==="combo"&&y.collapsed&&(t.collapseCombo(y.id,!1),t.updateCombo(m)),!0})}),t.get("fitView")?t.fitView():t.get("fitCenter")&&t.fitCenter(),t.autoPaint(),t.emit("afterrender"),(t.get("fitView")||t.get("fitCenter"))&&t.set("animate",h),setTimeout(function(){var g;(g=t.getCombos())===null||g===void 0||g.forEach(function(y){y.set("animate",!0)})},0)}if(!this.get("groupByTypes"))if(f&&f.length!==0)this.sortCombos();else if(r.nodes&&r.edges&&r.nodes.length<r.edges.length){var p=this.getNodes();p.forEach(function(g){g.toFront()})}else{var v=this.getEdges();v.forEach(function(g){g.toBack()})}},e.prototype.read=function(t){this.data(t),this.render()},e.prototype.diffItems=function(t,r,i){var a=this,n,o=this.get("itemMap");F(i,function(s){if(n=o[s.id],n){if(a.get("animate")&&t===Dn){var f=n.getContainer().getMatrix();f||(f=[1,0,0,0,1,0,0,0,1]),n.set("originAttrs",{x:f[6],y:f[7]})}a.updateItem(n,s,!1)}else n=a.addItem(t,s,!1);n&&r["".concat(t,"s")].push(n)})},e.prototype.changeData=function(t,r){var i=this,a;r===void 0&&(r=!0);var n=this,o=t||n.get("data");if(!hr(o))return this;this.emit("beforechangedata"),r&&this.get("enabledStack")&&this.pushStack("changedata",{before:n.save(),after:o}),this.set("comboSorted",!1),this.removeHulls(),this.getNodes().map(function(S){return n.clearItemStates(S)}),this.getEdges().map(function(S){return n.clearItemStates(S)});var s=this.get("canvas"),f=s.get("localRefresh");s.set("localRefresh",!1),n.get("data")||(n.data(o),n.render());var u=this.get("itemMap"),h={nodes:[],edges:[]},c=o.combos;if(c){var d=Tt(c,o.nodes);this.set("comboTrees",d)}else this.set("comboTrees",[]);this.diffItems("node",h,o.nodes),F(u,function(S,I){u[I].getModel().depth=0,!(S.getType&&S.getType()==="edge")&&(S.getType&&S.getType()==="combo"?(delete u[I],S.destroy()):h.nodes.indexOf(S)<0&&(delete u[I],n.remove(S,!1)))});for(var p=this.getCombos(),v=p.length,g=v-1;g>=0;g--)p[g].destroyed&&p.splice(g,1);c&&(n.addCombos(c),this.get("groupByTypes")||this.sortCombos()),this.diffItems("edge",h,o.edges),F(u,function(S,I){S.getType&&(S.getType()==="node"||S.getType()==="combo")||h.edges.indexOf(S)<0&&(delete u[I],n.remove(S,!1))}),(this.get("comboTrees")||[]).forEach(function(S){ue(S,function(I){var M=i.findById(I.id);return M.getType()==="combo"&&I.collapsed&&i.collapseCombo(I.id,!1),!0})}),this.set({nodes:h.nodes,edges:h.edges});var y=(this.get("layout")||{}).relayoutAtChangeData,m=y===void 0?!0:y,b=this.get("layoutController");return m&&b&&(b.changeData(function(){setTimeout(function(){var S;(S=n.getCombos())===null||S===void 0||S.forEach(function(I){I.set("animate",!0)})},0)}),n.get("animate")&&!b.getLayoutType()?(n.positionsAnimate(),(a=n.getCombos())===null||a===void 0||a.forEach(function(S){return S.set("animate",!0)})):n.autoPaint()),setTimeout(function(){s.set("localRefresh",f)},16),this.set("data",o),this.emit("afterchangedata"),this},e.prototype.addCombos=function(t){var r=this,i=r.get("comboTrees"),a=this.get("itemController");a.addCombos(i,t)},e.prototype.createCombo=function(t,r,i){var a=this;i===void 0&&(i=!0);var n=this.get("itemController");this.set("comboSorted",!1);var o="",s;if(t){if(A(t))o=t,s={id:t};else{if(o=t.id,!o){console.warn("Create combo failed. Please assign a unique string id for the adding combo.");return}s=t}var f=i&&this.get("enabledStack"),u={nodes:[],combos:[]};f&&r.forEach(function(y){var m=a.findById(y),b=m.getType();if(!(b!=="node"&&b!=="combo")){var S=m.getModel();u["".concat(b,"s")].push({id:y,parentId:b==="node"?S.comboId:S.parentId})}});var h=this.get("comboTrees"),c=new Set(r),d=new Map;h&&(h.forEach(function(y){ue(y,function(m,b,S){if(c.has(m.id)){if(b){var I=a.findById(b.id),M=a.findById(m.id);b.children.splice(S,1),I.removeChild(M),n.updateCombo(I,b.children)}m.itemType==="combo"&&d.set(m.id,m)}return!0})}),h=h.filter(function(y){return!c.has(y.id)}),this.set("comboTrees",h));var p={nodes:[],combos:[]},v=r.map(function(y){var m=a.findById(y),b=m.getModel(),S="";m.getType&&(S=m.getType());var I=d.get(y)||{id:m.getID(),itemType:S};return S==="combo"?(I.parentId=o,b.parentId=o):S==="node"&&(I.comboId=o,b.comboId=o),f&&p["".concat(S,"s")].push({id:b.id,parentId:o}),I});s.children=v,this.addItem("combo",s,!1),this.set("comboSorted",!1),h&&(h.forEach(function(y){J(y,function(m){return m.id===o?(m.itemType="combo",m.children=v,!1):!0})}),this.sortCombos()),f&&(p.combos.push(s),this.pushStack("createCombo",{before:u,after:p}));var g=this.findById(o);!g.getModel().parentId&&g.getChildren().combos.length&&this.updateComboTree(g,void 0,!1),setTimeout(function(){g.set("animate",!0)},0)}},e.prototype.uncombo=function(t,r){var i=this,a,n;r===void 0&&(r=!0);var o=this,s=t;if(A(t)&&(s=this.findById(t)),!s||s.getType&&s.getType()!=="combo"){console.warn("The item is not a combo!");return}var f=s.getModel(),u=s.getModel().parentId,h=o.get("comboTrees");h||(h=[]);var c=this.get("itemMap"),d=s.get("id"),p,v=[],g=this.get("combos"),y=this.findById(u),m=r&&this.get("enabledStack"),b={};if(m&&(b=V(f),b.children=[]),h.forEach(function(C){p||ue(C,function(E){var B;if(E.id===d){p=E;var P=s.getEdges().map(function(j){return j.getID()});P.forEach(function(j){i.removeItem(j,!1)});var O=g.indexOf(s);g.splice(O,1),delete c[d];var Y=V(s.getModel());s.destroy(),i.emit("afterremoveitem",{item:Y,type:"combo"})}if(u&&p&&E.id===u){y.removeCombo(s),v=E.children;var O=v.indexOf(p);return O!==-1&&v.splice(O,1),(B=p.children)===null||B===void 0||B.forEach(function(T){var L=i.findById(T.id),k=L.getModel();L.getType&&L.getType()==="combo"?(T.parentId=u,delete T.comboId,k.parentId=u,delete k.comboId):L.getType&&L.getType()==="node"&&(T.comboId=u,k.comboId=u),y.addChild(L),v.push(T)}),i.updateCombo(y),!1}return!0})}),!u&&p){var S=h.indexOf(p);h.splice(S,1),(a=p.children)===null||a===void 0||a.forEach(function(C){C.parentId=void 0;var E=i.findById(C.id).getModel();delete E.parentId,delete E.comboId,C.itemType!=="node"&&h.push(C)})}if(m){var I={nodes:[],combos:[]},M={nodes:[],combos:[]};(n=p.children)===null||n===void 0||n.forEach(function(C){var E=i.findById(C.id),B=E.getType();B!=="node"&&B!=="combo"||(I["".concat(B,"s")].push({id:C.id,parentId:d}),M["".concat(B,"s")].push({id:C.id,parentId:u}))}),I.combos.push(b),this.pushStack("uncombo",{before:I,after:M})}},e.prototype.updateCombos=function(t){var r=this;t===void 0&&(t=!1);var i=this,a=this.get("comboTrees"),n=i.get("itemController"),o=i.get("itemMap");(a||[]).forEach(function(s){ue(s,function(f){var u;if(!f)return!0;var h=o[f.id];if(((u=h==null?void 0:h.getType)===null||u===void 0?void 0:u.call(h))==="combo"){var c=Le([],h.getStates(),!0);F(c,function(d){return r.setItemState(h,d,!1)}),n.updateCombo(h,f.children,t),F(c,function(d){return r.setItemState(h,d,!0)})}return!0})}),i.sortCombos()},e.prototype.updateCombo=function(t){var r=this,i=this,a=t,n;if(A(t)&&(a=this.findById(t)),!a||a.getType&&a.getType()!=="combo"){console.warn("The item to be updated is not a combo!");return}n=a.get("id");var o=this.get("comboTrees"),s=i.get("itemController"),f=i.get("itemMap");(o||[]).forEach(function(u){ue(u,function(h){if(!h)return!0;var c=f[h.id];if(n===h.id&&c&&c.getType&&c.getType()==="combo"){var d=Le([],c.getStates(),!0);F(d,function(p){c.getStateStyle(p)&&r.setItemState(c,p,!1)}),s.updateCombo(c,h.children),F(d,function(p){c.getStateStyle(p)&&r.setItemState(c,p,!0)}),n&&(n=h.parentId)}return!0})})},e.prototype.updateComboTree=function(t,r,i){i===void 0&&(i=!0);var a=this;this.set("comboSorted",!1);var n;A(t)?n=a.findById(t):n=t;var o=n.getModel(),s=o.comboId||o.parentId,f="";if(n.getType&&(f=n.getType()),r&&f==="combo"){var u=this.get("comboTrees"),h=!0,c;if((u||[]).forEach(function(m){c||J(m,function(b){if(!c)return b.id===n.getID()&&(c=b),!0})}),J(c,function(m){return m.id===r?(h=!1,!1):!0}),!h){console.warn("Failed to update the combo tree! The parentId points to a descendant of the combo!");return}}if(i&&this.get("enabledStack")){var d={},p={};f==="combo"?(d.combos=[{id:o.id,parentId:o.parentId}],p.combos=[{id:o.id,parentId:r}]):f==="node"&&(d.nodes=[{id:o.id,parentId:o.comboId}],p.nodes=[{id:o.id,parentId:r}]),this.pushStack("updateComboTree",{before:d,after:p})}if(o.parentId||o.comboId){var v=this.findById(o.parentId||o.comboId);v&&v.removeChild(n)}if(f==="combo"?o.parentId=r:f==="node"&&(o.comboId=r),r){var g=this.findById(r);g&&g.addChild(n)}if(s){var g=this.findById(s);g&&g.removeChild(n)}var y=Nt(this.get("comboTrees"),o.id,r);this.set("comboTrees",y),this.updateCombos()},e.prototype.save=function(){var t=[],r=[],i=[];return F(this.get("nodes"),function(a){t.push(a.getModel())}),F(this.get("edges"),function(a){r.push(a.getModel())}),F(this.get("combos"),function(a){i.push(a.getModel())}),{nodes:t,edges:r,combos:i}},e.prototype.changeSize=function(t,r){var i=this.get("viewController");return i.changeSize(t,r),this},e.prototype.refresh=function(){var t=this;if(t.emit("beforegraphrefresh"),t.get("animate"))t.positionsAnimate();else{var r=t.get("nodes"),i=t.get("edges"),a=t.get("edges");F(r,function(n){n.refresh()}),F(i,function(n){n.refresh()}),F(a,function(n){n.refresh()})}t.emit("aftergraphrefresh"),t.autoPaint()},e.prototype.getNodes=function(){return this.get("nodes")},e.prototype.getEdges=function(){return this.get("edges")},e.prototype.getCombos=function(){return this.get("combos")},e.prototype.getComboChildren=function(t){if(A(t)&&(t=this.findById(t)),!t||t.getType&&t.getType()!=="combo"){console.warn("The combo does not exist!");return}return t.getChildren()},e.prototype.positionsAnimate=function(t){var r=this;r.emit("beforeanimate");var i=r.get("animateCfg"),a=i.onFrame,n=t?r.getNodes().concat(r.getCombos()):r.getNodes(),o=n.map(function(f){var u=f.getModel();return{id:u.id,x:u.x,y:u.y}});r.stopAnimate();var s=r.get("canvas");r.animating=!0,setTimeout(function(){s.animate(function(f){F(o,function(u){var h=r.findById(u.id);if(!(!h||h.destroyed)){var c=h.get("originAttrs"),d=h.get("model"),p=h.getContainer().getMatrix();if(c==null&&(p&&(c={x:p[6],y:p[7]}),h.set("originAttrs",c||0)),a){var v=a(h,f,u,c||{x:0,y:0});h.set("model",Object.assign(d,v))}else c?(d.x=c.x+(u.x-c.x)*f,d.y=c.y+(u.y-c.y)*f):(d.x=u.x,d.y=u.y)}}),r.refreshPositions(t)},{duration:i.duration,easing:i.easing,callback:function(){F(n,function(u){u.set("originAttrs",null)}),i.callback&&i.callback(),r.emit("afteranimate"),r.animating=!1}})},0)},e.prototype.refreshPositions=function(t){var r=this;r.emit("beforegraphrefreshposition");var i=r.get("nodes"),a=r.get("edges"),n=r.get("vedges"),o=r.get("combos"),s,f={},u=function(c){F(c,function(d){s=d.getModel();var p=d.get("originAttrs");if(!(p&&s.x===p.x&&s.y===p.y)){var v=d.updatePosition({x:s.x,y:s.y});f[s.id]=v,s.comboId&&(f[s.comboId]=f[s.comboId]||v),s.parentId&&(f[s.parentId]=f[s.parentId]||v)}})};u(o),u(i),o&&o.length!==0&&(t&&u(o),r.updateCombos()),F(a,function(h){var c=h.getSource().getModel(),d=h.getTarget();if(!re(d)){var p=d.getModel();(f[c.id]||f[p.id]||h.getModel().isComboEdge)&&h.refresh()}}),F(n,function(h){h.refresh()}),r.emit("aftergraphrefreshposition"),r.autoPaint()},e.prototype.stopAnimate=function(){var t=this.get("canvas"),r=t.cfg.timeline;r&&r.stopAllAnimations()},e.prototype.isAnimating=function(){return this.animating},e.prototype.getZoom=function(){var t=this.get("group").getMatrix();return t?t[0]:1},e.prototype.getCurrentMode=function(){var t=this.get("modeController");return t.getMode()},e.prototype.setMode=function(t){var r=this.get("modeController");return r.setMode(t),this},e.prototype.clear=function(t){var r;return t===void 0&&(t=!1),(r=this.get("canvas"))===null||r===void 0||r.clear(),this.initGroups(),this.set({itemMap:{},nodes:[],edges:[],vedges:[],groups:[],combos:[],comboTrees:[]}),t||this.emit("afterrender"),this},e.prototype.updateLayout=function(t,r,i,a){var n=this;t===void 0&&(t={}),a===void 0&&(a=!0);var o=this.get("layoutController");if(A(t)&&(t={type:t}),r){var s=i;s||(r==="begin"?s={x:0,y:0}:s={x:this.getWidth()/2,y:this.getHeight()/2}),s=this.getPointByCanvas(s.x,s.y);var f=["force","gForce","fruchterman","force2"];f.includes(t.type)||!t.type&&f.includes(o==null?void 0:o.layoutType)?t.center=[s.x,s.y]:this.once("afterlayout",function(c){var d=n.getGroup().getMatrix()||[1,0,0,0,1,0,0,0,1];s.x=s.x*d[0]+d[6],s.y=s.y*d[0]+d[7];var p=n.getGroup().getCanvasBBox(),v=p.minX,g=p.maxX,y=p.minY,m=p.maxY,b={x:(v+g)/2,y:(y+m)/2};r==="begin"&&(b.x=v,b.y=y),n.translate(s.x-b.x,s.y-b.y)})}var u=w({},this.get("layout")),h={};Object.assign(h,u,t),t.pipes&&!t.type?delete h.type:!t.pipes&&h.type&&delete h.pipes,this.set("layout",h),o&&(o.isLayoutTypeSame(h)&&h.gpuEnabled===u.gpuEnabled?o.updateLayoutCfg(h):o.changeLayout(h),a&&this.get("enabledStack")&&this.pushStack("layout",{before:u,after:h}))},e.prototype.destroyLayout=function(){var t=this.get("layoutController");t==null||t.destroyLayout()},e.prototype.layout=function(){var t,r=this.get("layoutController"),i=this.get("layout");if(!(!i||!r)){if(i.workerEnabled){r.layout();return}!((t=r.layoutMethods)===null||t===void 0)&&t.length?r.relayout(!0):r.layout()}},e.prototype.collapseCombo=function(t,r){var i=this;if(r===void 0&&(r=!0),!this.destroyed){if(A(t)&&(t=this.findById(t)),!t){console.warn("The combo to be collapsed does not exist!");return}this.emit("beforecollapseexpandcombo",{action:"collapse",item:t});var a=t.getModel(),n=this.get("itemController");n.collapseCombo(t,r),a.collapsed=!0;var o=this.getEdges().concat(this.get("vedges")),s=[],f=this.get("comboTrees"),u=!1;(f||[]).forEach(function(c){u||J(c,function(d){if(u&&d.depth<=a.depth)return!1;if(a.id===d.id&&(u=!0),u){var p=i.findById(d.id);p&&p.getType&&p.getType()==="combo"&&(s=s.concat(p.getNodes()),s=s.concat(p.getCombos()))}return!0})});var h={};o.forEach(function(c){var d=c.getModel(),p=d.isVEdge,v=d.size,g=v===void 0?1:v;if(!(c.isVisible()&&!p)){var y=c.getSource(),m=c.getTarget(),b=null,S;if(y.getModel().id===a.id||s.includes(y)&&!s.includes(m)?(b=m,S=!1):(m.getModel().id===a.id||!s.includes(y)&&s.includes(m))&&(b=y,S=!0),b){if(p){i.removeItem(c,!1);return}for(var I=b.getModel();!b.isVisible();){var M=I.parentId,C=I.comboId,E=M||C;if(b=i.findById(E),!b||!E)return;I=b.getModel()}var B=I.id,P=S?{source:B,target:a.id,size:g,isVEdge:!0}:{source:a.id,target:B,size:g,isVEdge:!0},O="".concat(P.source,"-").concat(P.target);if(h[O]){h[O].size+=g;return}h[O]=P}}}),this.addItems(Object.values(h).map(function(c){return{type:"vedge",model:c}}),!1),this.emit("aftercollapseexpandcombo",{action:"collapse",item:t})}},e.prototype.expandCombo=function(t,r){var i=this;if(r===void 0&&(r=!0),A(t)&&(t=this.findById(t)),!t||t.getType&&t.getType()!=="combo"){console.warn("The combo to be collapsed does not exist!");return}this.emit("beforecollapseexpandcombo",{action:"expand",item:t});var a=t.getModel(),n=this.get("itemController");n.expandCombo(t,r),a.collapsed=!1;var o=this.getEdges().concat(this.get("vedges")),s=[],f=this.get("comboTrees"),u=!1;(f||[]).forEach(function(c){u||J(c,function(d){if(u&&d.depth<=a.depth)return!1;if(a.id===d.id&&(u=!0),u){var p=i.findById(d.id);p&&p.getType&&p.getType()==="combo"&&(s=s.concat(p.getNodes()),s=s.concat(p.getCombos()))}return!0})});var h={};o.forEach(function(c){if(!(c.isVisible()&&!c.getModel().isVEdge)){var d=c.getSource(),p=c.getTarget(),v=d.get("id"),g=p.get("id"),y=null,m;if(v===a.id||s.includes(d)&&!s.includes(p)?(y=p,m=!1):g===a.id||!s.includes(d)&&s.includes(p)?(y=d,m=!0):s.includes(d)&&s.includes(p)&&d.isVisible()&&p.isVisible()&&c.show(),y){var b=c.getModel(),S=b.isVEdge,I=b.size,M=I===void 0?1:I;if(S){i.removeItem(c,!1);return}for(var C=y.getModel();!y.isVisible();){var E=C.parentId,B=C.comboId,P=E||B;if(y=i.findById(P),!y||!P)return;C=y.getModel()}for(var O=C.id,Y=m?p:d,j=Y.getModel();!Y.isVisible();){var T=j.parentId,L=j.comboId,k=T||L;if(Y=i.findById(k),!Y||!k)return;if(j.comboId===a.id||j.parentId===a.id)break;j=Y.getModel()}var z=j.id;if(O){var H=m?{source:O,target:z,isVEdge:!0,size:M}:{source:z,target:O,isVEdge:!0,size:M},D="".concat(H.source,"-").concat(H.target);if(h[D]){h[D].size+=M;return}h[D]=H}}}}),this.addItems(Object.values(h).map(function(c){return{type:"vedge",model:c}}),!1),this.emit("aftercollapseexpandcombo",{action:"expand",item:t})},e.prototype.collapseExpandCombo=function(t,r){if(r===void 0&&(r=!0),A(t)&&(t=this.findById(t)),!(!t||t.getType&&t.getType()!=="combo")){for(var i=t.getModel(),a=this.findById(i.parentId);a;){var n=a.getModel();if(n.collapsed){console.warn("Fail to expand the combo since it's ancestor combo is collapsed."),a=void 0;return}a=this.findById(n.parentId)}var o=i.collapsed;o?this.expandCombo(t,r):this.collapseCombo(t,r),this.updateCombo(t)}},e.prototype.getNeighbors=function(t,r){var i=t;return A(t)&&(i=this.findById(t)),i.getNeighbors(r)},e.prototype.getNodeDegree=function(t,r,i){r===void 0&&(r=void 0),i===void 0&&(i=!1);var a=t;A(t)&&(a=this.findById(t));var n=this.get("degrees");(!n||i)&&(n=ia(this.save()),this.set("degrees",n));var o=n[a.getID()],s=0;if(!o)return 0;switch(r){case"in":s=o.inDegree;break;case"out":s=o.outDegree;break;case"all":s=o;break;default:s=o.degree;break}return s},e.prototype.getUndoStack=function(){return this.undoStack},e.prototype.getRedoStack=function(){return this.redoStack},e.prototype.getStackData=function(){return this.get("enabledStack")?{undoStack:this.undoStack.toArray(),redoStack:this.redoStack.toArray()}:null},e.prototype.clearStack=function(){this.get("enabledStack")&&(this.undoStack.clear(),this.redoStack.clear(),this.emit("stackchange",{undoStack:this.undoStack,redoStack:this.redoStack}))},e.prototype.pushStack=function(t,r,i){if(t===void 0&&(t="update"),i===void 0&&(i="undo"),!this.get("enabledStack")){console.warn("请先启用 undo & redo 功能，在实例化 Graph 时候配置 enabledStack: true !");return}var a=r?V(r):{before:{},after:V(this.save())};i==="redo"?this.redoStack.push({action:t,data:a}):this.undoStack.push({action:t,data:a}),this.emit("stackchange",{action:t,stackType:i,undoStack:this.undoStack,redoStack:this.redoStack})},e.prototype.getAdjMatrix=function(t,r){t===void 0&&(t=!0),r===void 0&&(r=this.get("directed"));var i=this.get("adjMatrix");return(!i||!t)&&(i=rr(this.save(),r),this.set("adjMatrix",i)),i},e.prototype.getShortestPathMatrix=function(t,r){t===void 0&&(t=!0),r===void 0&&(r=this.get("directed"));var i=this.get("adjMatrix"),a=this.get("shortestPathMatrix");return(!i||!t)&&(i=rr(this.save(),r),this.set("adjMatrix",i)),(!a||!t)&&(a=aa(this.save(),r),this.set("shortestPathMatrix",a)),a},e.prototype.on=function(t,r,i){return l.prototype.on.call(this,t,r,i)},e.prototype.destroy=function(){var t,r,i,a,n;this.emit("beforedestroy"),this.clear(),this.clearStack(),(t=this.get("itemController"))===null||t===void 0||t.destroy(),(r=this.get("modeController"))===null||r===void 0||r.destroy(),(i=this.get("viewController"))===null||i===void 0||i.destroy(),(a=this.get("stateController"))===null||a===void 0||a.destroy(),(n=this.get("canvas"))===null||n===void 0||n.destroy(),this.cfg=null,this.destroyed=!0,this.redoStack=null,this.undoStack=null,this.emit("afterdestroy")},e.prototype.createHull=function(t){if(!t.members||t.members.length<1){console.warn("Create hull failed! The members is empty.");return}var r=this.get("hullGroup"),i=this.get("hullMap");if(i||(i={},this.set("hullMap",i)),(!r||r.get("destroyed"))&&(r=this.get("group").addGroup({id:"hullGroup"}),r.toBack(),this.set("hullGroup",r)),i[t.id])return console.warn("Existed hull id."),i[t.id];var a=r.addGroup({id:"".concat(t.id,"-container")}),n=new xi(this,w(w({},t),{group:a})),o=n.id;return i[o]=n,n},e.prototype.getHulls=function(){return this.get("hullMap")},e.prototype.getHullById=function(t){return this.get("hullMap")[t]},e.prototype.removeHull=function(t){var r,i;A(t)?i=this.getHullById(t):i=t,(r=this.get("hullMap"))===null||r===void 0||delete r[i.id],i.destroy()},e.prototype.removeHulls=function(){var t=this.getHulls();!t||!Object.keys(t).length||(Object.keys(t).forEach(function(r){var i=t[r];i.destroy()}),this.set("hullMap",{}))},e}(na);function Xt(l){"@babel/helpers - typeof";return Xt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xt(l)}var Se=ot,Ir="-shape",mt="-label",Ze=["startArrow","endArrow"],Pr={lineWidth:1,stroke:void 0,fill:void 0,lineAppendWidth:1,opacity:void 0,strokeOpacity:void 0,fillOpacity:void 0,x:0,y:0,r:10,width:20,height:20,shadowColor:void 0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0},Vn={lineWidth:1,stroke:"#000",lineDash:void 0,startArrow:!1,endArrow:!1,opacity:void 0,strokeOpacity:void 0,fillOpacity:void 0,shadowColor:void 0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0},qe={edge:Vn,node:Pr,combo:Pr},Yt="-label-bg",Ut={options:{labelCfg:{style:{fontFamily:N.windowFontFamily}},descriptionCfg:{style:{fontFamily:N.windowFontFamily}}},itemType:"",type:"",getCustomConfig:function(e){return{}},getOptions:function(e,t){return t==="move"||t!=null&&t.includes("bbox")?e:_({},this.options,this.getCustomConfig(e)||{},e)},draw:function(e,t){t.shapeMap={},this.mergeStyle=this.getOptions(e);var r=this.drawShape(e,t);if(r.set("className",this.itemType+Ir),t.shapeMap[this.itemType+Ir]=r,e.label){var i=this.drawLabel(e,t);i.set("className",this.itemType+mt),t.shapeMap[this.itemType+mt]=i}return r},afterDraw:function(e,t,r){},drawShape:function(e,t){return null},drawLabel:function(e,t){var r=(this.mergeStyle||this.getOptions(e)||{}).labelCfg,i=r||{},a=this.getLabelStyle(e,i,t),n=a.rotate;delete a.rotate;var o=t.addShape("text",{attrs:a,draggable:!0,className:"text-shape",name:"text-shape",labelRelated:!0});if(t.shapeMap["text-shape"]=o,!isNaN(n)&&n!==""){var s=o.getBBox(),f=[1,0,0,0,1,0,0,0,1];if(a.rotateCenter)switch(a.rotateCenter){case"center":f=Se(f,[["t",-s.width/2,-s.height/2],["r",n],["t",s.width/2,s.height/2]]);break;case"lefttop":f=Se(f,[["t",-a.x,-a.y],["r",n],["t",a.x,a.y]]);break;case"leftcenter":f=Se(f,[["t",-a.x,-a.y-s.height/2],["r",n],["t",a.x,a.y+s.height/2]]);break;default:f=Se(f,[["t",-s.width/2,-s.height/2],["r",n],["t",s.width/2,s.height/2]]);break}else f=Se(f,[["t",-a.x,-a.y-s.height/2],["r",n],["t",a.x,a.y+s.height/2]]);o.setMatrix(f)}if(a.background){var u=this.drawLabelBg(e,t,o),h=this.itemType+Yt;u.set("classname",h),t.shapeMap[h]=u,o.toFront()}return o},drawLabelBg:function(e,t,r){var i=this.options.labelCfg,a=$({},i,e.labelCfg),n=this.getLabelBgStyleByPosition(r,a),o=t.addShape("rect",{name:"text-bg-shape",attrs:n,labelRelated:!0});return t.shapeMap["text-bg-shape"]=o,o},getLabelStyleByPosition:function(e,t,r){return{text:e.label}},getLabelBgStyleByPosition:function(e,t){return{}},getLabelStyle:function(e,t,r){var i=this.getLabelStyleByPosition(e,t,r),a="".concat(this.itemType,"Label"),n=N[a]?N[a].style:null;return w(w(w({},n),i),t.style)},getShapeStyle:function(e){return e.style},update:function(e,t,r){this.updateShapeStyle(e,t,r),this.updateLabel(e,t,r)},updateShapeStyle:function(e,t,r){var i,a=t.getContainer(),n=t.getKeyShape(),o=$({},n.attr(),e.style),s=function(h){var c,d=o[h];if(re(d)){var p=((i=a.shapeMap)===null||i===void 0?void 0:i[h])||a.find(function(v){return v.get("name")===h});p==null||p.attr(d)}else n.attr((c={},c[h]=d,c))};for(var f in o)s(f)},updateLabel:function(e,t,r){var i,a,n=t.getContainer(),o=(this.mergeStyle||this.getOptions({},r)||{}).labelCfg,s=o===void 0?{}:o,f=this.itemType+mt,u=n.shapeMap[f]||n.find(function(S){return S.get("className")===f}),h=this.itemType+Yt,c=n.shapeMap[h]||n.find(function(S){return S.get("className")===h});if(u&&e.label===void 0&&(n.removeChild(u),delete n.shapeMap[f],c&&(n.removeChild(c),delete n.shapeMap[h])),e.label||e.label==="")if(u){(!r||r==="bbox|label"||this.itemType==="edge"&&r!=="style")&&(s=_(s,e.labelCfg));var p=this.getLabelStyleByPosition(e,s,n),v=(i=e.labelCfg)===null||i===void 0?void 0:i.style,g=w(w({},p),v),y=g.rotate;if(delete g.rotate,!isNaN(y)&&y!==""){var m=[1,0,0,0,1,0,0,0,1];m=Se(m,[["t",-g.x,-g.y],["r",y],["t",g.x,g.y]]),g.matrix=m,u.attr(g)}else((a=u.getMatrix())===null||a===void 0?void 0:a[4])!==1&&u.resetMatrix(),u.attr(g);if(!c)g.background&&(c=this.drawLabelBg(e,n,u),c.set("classname",h),n.shapeMap[h]=c,u.toFront());else if(g.background){var b=this.getLabelBgStyleByPosition(u,s);c.attr(b)}else n.removeChild(c)}else{var d=this.drawLabel(e,n);d.set("className",f),n.shapeMap[f]=d}},afterUpdate:function(e,t){},setState:function(e,t,r){var i,a,n,o=r.get("keyShape");if(!(!o||o.destroyed)){var s=r.getType(),f=Hr(t)?e:"".concat(e,":").concat(t),u=this.getStateStyle(f,r),h=r.getStateStyle(f);if(!(!h&&!u)){var c=$({},h||u),d=r.getContainer(),p={x:1,y:1,cx:1,cy:1,matrix:1};if(s==="combo"&&(p.r=1,p.width=1,p.height=1),t){var v=function(k){var z,H=c[k];if(re(H)&&!Ze.includes(k)){var D=((n=d.shapeMap)===null||n===void 0?void 0:n[k])||d.find(function(ee){return ee.get("name")===k});D==null||D.attr(H)}else o.attr((z={},z[k]=H,z))};for(var g in c)v(g)}else{var y=Je(r.getCurrentStatesStyle()),m=r.getModel(),b=$({},m.style,Je(r.getOriginStyle())),S=o.get("name"),I=o.attr(),M={};Object.keys(I).forEach(function(L){if(L!=="img"){var k=I[L];k&&Xt(k)==="object"?M[L]=V(k):M[L]=k}});var C={},E=function(k){var z=c[k];if(re(z)&&!Ze.includes(k)){var H=d.shapeMap[k]||d.find(function(Pe){return Pe.get("name")===k});if(H){var D=Je(H.attr());F(z,function(Pe,te){if(k===S&&M[te]&&!p[te]){delete M[te];var Ei=b[k][te]||qe[s][te];o.attr(te,Ei)}else if(D[te]||D[te]===0){delete D[te];var Mi=b[k][te]||qe[s][te];H.attr(te,Mi)}}),C[k]=D}}else if(M[k]&&!p[k]){delete M[k];var ee=b[k]||(b[S]?b[S][k]:void 0)||qe[s][k];o.attr(k,ee)}};for(var B in c)E(B);S?C[S]=M:$(C,M);for(var g in y)if(!p[g]){var P=y[g];(!re(P)||Ze.includes(g))&&(S?($(b[S],(a={},a[g]=P,a)),delete b[g]):$(b,(i={},i[g]=P,i)),delete y[g])}var O={};_(O,b,C,y);var Y=!1,j=function(k){var z,H,D=O[k];if(re(D)&&!Ze.includes(k)){var ee=d.shapeMap[k]||d.find(function(te){return te.get("name")===k});ee&&((ee.get("type")==="text"||ee.get("labelRelated"))&&(delete D.x,delete D.y,delete D.matrix),k===S&&(s==="combo"&&(delete D.r,delete D.width,delete D.height),Y=!0),ee.attr(D))}else if(!Y){var Pe=D||qe[s][k];s==="combo"?S||o.attr((z={},z[k]=Pe,z)):o.attr((H={},H[k]=Pe,H))}};for(var T in O)j(T)}}}},getStateStyle:function(e,t){var r=t.getModel(),i=t.getType(),a=this.getOptions(r),n=a.stateStyles,o=a.style,s=o===void 0?{}:o,f=r.stateStyles?r.stateStyles[e]:n&&n[e];return i==="combo"?V(f):$({},s,f)},getControlPoints:function(e){return e.controlPoints},getAnchorPoints:function(e){var t,r,i=(e==null?void 0:e.anchorPoints)||((t=this.getCustomConfig(e))===null||t===void 0?void 0:t.anchorPoints)||((r=this.options)===null||r===void 0?void 0:r.anchorPoints);return i}},Wn={itemType:"node",shapeType:"single-node",labelPosition:"center",offset:N.nodeLabel.offset,getSize:function(e){var t,r=((t=this.mergeStyle)===null||t===void 0?void 0:t.size)||e.size||this.getOptions({}).size||N.defaultNode.size;return W(r)&&r.length===1&&(r=[r[0],r[0]]),W(r)||(r=[r,r]),r},getLabelStyleByPosition:function(e,t){var r=t.maxLength,i=e.label;r&&(i=ui(i,r));var a=t.position||this.labelPosition;if(a==="center")return{x:0,y:0,text:i,textBaseline:"middle",textAlign:"center"};var n=t.offset;ne(n)&&(n=this.offset);var o=this.getSize(e),s;switch(a){case"top":s={x:0,y:-o[1]/2-n,textBaseline:"bottom",textAlign:"center"};break;case"bottom":s={x:0,y:o[1]/2+n,textBaseline:"top",textAlign:"center"};break;case"left":s={x:-o[0]/2-n,y:0,textBaseline:"middle",textAlign:"right"};break;default:s={x:o[0]/2+n,y:0,textBaseline:"middle",textAlign:"left"};break}return s.text=i,s},getLabelBgStyleByPosition:function(e,t){var r;if(!e)return{};var i=(r=t.style)===null||r===void 0?void 0:r.background;if(!i)return{};var a=e.getBBox(),n=Ht(i.padding),o=a.width+n[1]+n[3],s=a.height+n[0]+n[2];return w(w({x:a.minX-n[3],y:a.minY-n[0]},i),{width:o,height:s})},drawShape:function(e,t){var r=this.shapeType,i=this.getShapeStyle(e),a=t.addShape(r,{attrs:i,draggable:!0,name:"node-shape"});return t.shapeMap["node-shape"]=a,a},updateLinkPoints:function(e,t){var r=(this.mergeStyle||this.getOptions(e)).linkPoints,i=t.shapeMap["link-point-left"]||t.find(function(O){return O.get("className")==="link-point-left"}),a=t.shapeMap["link-point-right"]||t.find(function(O){return O.get("className")==="link-point-right"}),n=t.shapeMap["link-point-top"]||t.find(function(O){return O.get("className")==="link-point-top"}),o=t.shapeMap["link-point-bottom"]||t.find(function(O){return O.get("className")==="link-point-bottom"}),s;i&&(s=i.attr()),a&&!s&&(s=a.attr()),n&&!s&&(s=n.attr()),o&&!s&&(s=o.attr()),s||(s=r);var f=$({},s,e.linkPoints),u=f.fill,h=f.stroke,c=f.lineWidth,d=f.size/2;d||(d=f.r);var p=e.linkPoints?e.linkPoints:{left:void 0,right:void 0,top:void 0,bottom:void 0},v=p.left,g=p.right,y=p.top,m=p.bottom,b=this.getSize(e),S=b[0],I=b[1],M={r:d,fill:u,stroke:h,lineWidth:c};if(i)!v&&v!==void 0?(i.remove(),delete t.shapeMap["link-point-left"]):i.attr(w(w({},M),{x:-S/2,y:0}));else if(v){var C="link-point-left";t.shapeMap[C]=t.addShape("circle",{attrs:w(w({},M),{x:-S/2,y:0}),className:C,name:C,isAnchorPoint:!0})}if(a)!g&&g!==void 0&&(a.remove(),delete t.shapeMap["link-point-right"]),a.attr(w(w({},M),{x:S/2,y:0}));else if(g){var E="link-point-right";t.shapeMap[E]=t.addShape("circle",{attrs:w(w({},M),{x:S/2,y:0}),className:E,name:E,isAnchorPoint:!0})}if(n)!y&&y!==void 0&&(n.remove(),delete t.shapeMap["link-point-top"]),n.attr(w(w({},M),{x:0,y:-I/2}));else if(y){var B="link-point-top";t.shapeMap[B]=t.addShape("circle",{attrs:w(w({},M),{x:0,y:-I/2}),className:B,name:B,isAnchorPoint:!0})}if(o)!m&&m!==void 0?(o.remove(),delete t.shapeMap["link-point-bottom"]):o.attr(w(w({},M),{x:0,y:I/2}));else if(m){var P="link-point-bottom";t.shapeMap[P]=t.addShape("circle",{attrs:w(w({},M),{x:0,y:I/2}),className:P,name:P,isAnchorPoint:!0})}},updateShape:function(e,t,r,i,a){var n=t.get("keyShape");n.attr(w({},r)),this.updateLabel(e,t,a),i&&this.updateIcon(e,t)},updateIcon:function(e,t){var r=this,i=t.getContainer(),a=(this.mergeStyle||this.getOptions(e)).icon,n=e.icon?e.icon:{show:void 0,text:void 0},o=n.show,s=n.text,f=i.shapeMap["".concat(this.type,"-icon")]||i.find(function(y){return y.get("name")==="".concat(r.type,"-icon")});if(f)if(o||o===void 0){var u=$({},f.attr(),a),h=u.width,c=h===void 0?20:h,d=u.height,p=d===void 0?20:d;(u.fontFamily==="iconfont"||u.hasOwnProperty("text"))&&(c=0,p=0),f.attr(w(w({},u),{x:-c/2,y:-p/2}))}else f.remove(),delete i.shapeMap["".concat(this.type,"-icon")];else if(o){var v="".concat(this.type,"-icon");if(s)i.shapeMap[v]=i.addShape("text",{attrs:w({x:0,y:0,fontSize:12,fill:"#000",stroke:"#000",textBaseline:"middle",textAlign:"center"},a),className:v,name:v});else{var c=a.width,p=a.height;i.shapeMap[v]=i.addShape("image",{attrs:w(w({},a),{x:-c/2,y:-p/2}),className:v,name:v})}var g=i.shapeMap["node-label"]||i.find(function(y){return y.get("name")==="node-label"});g&&g.toFront()}}},Hn=w(w({},Ut),Wn);G.registerNode("single-node",Hn);var Ke="edge-shape";function jn(l){var e=l;return l==="start"?e="end":l==="end"&&(e="start"),e}var Un={itemType:"edge",labelPosition:"center",refX:0,refY:0,labelAutoRotate:!1,options:{size:N.defaultEdge.size,style:{x:0,y:0,stroke:N.defaultEdge.style.stroke,lineAppendWidth:N.defaultEdge.style.lineAppendWidth},labelCfg:{style:{fill:N.edgeLabel.style.fill,fontSize:N.edgeLabel.style.fontSize,fontFamily:N.windowFontFamily}},stateStyles:w({},N.edgeStateStyles)},getPath:function(e){var t=[];return F(e,function(r,i){i===0?t.push(["M",r.x,r.y]):t.push(["L",r.x,r.y])}),t},getShapeStyle:function(e){var t=this.options.style,r={stroke:e.color},i=$({},t,r,e.style),a=e.size||N.defaultEdge.size;e=this.getPathPoints(e);var n=e.startPoint,o=e.endPoint,s=this.getControlPoints(e),f=[n];s&&(f=f.concat(s)),f.push(o);var u=this.getPath(f),h=$({},N.defaultEdge.style,{stroke:N.defaultEdge.color,lineWidth:a,path:u},i);return h},updateShapeStyle:function(e,t,r){var i,a=t.getContainer(),n=((i=t.getKeyShape)===null||i===void 0?void 0:i.call(t))||a.shapeMap["edge-shape"],o=e.size;e=this.getPathPoints(e);var s=e.startPoint,f=e.endPoint,u=this.getControlPoints(e),h=[s];u&&(h=h.concat(u)),h.push(f);var c=n.attr(),d=e.style||{};d.stroke===void 0&&(d.stroke=e.color);var p=e.sourceNode,v=e.targetNode,g={radius:d.radius};u||(g={source:p,target:v,offset:d.offset,radius:d.radius});var y=this.getPath(h,g),m={};r==="move"?m={path:y}:(c.endArrow&&d.endArrow===!1&&(e.style.endArrow={path:""}),c.startArrow&&d.startArrow===!1&&(e.style.startArrow={path:""}),m=w({},e.style),m.lineWidth===void 0&&(m.lineWdith=(R(o)?o:o==null?void 0:o[0])||c.lineWidth),m.path===void 0&&(m.path=y),m.stroke===void 0&&(m.stroke=c.stroke||e.color)),n&&n.attr(m)},getLabelStyleByPosition:function(e,t,r){var i=t.position||this.labelPosition,a={},n=r==null?void 0:r.shapeMap[Ke],o;i==="start"?o=0:i==="end"?o=1:o=.5;var s=t.refX||this.refX,f=t.refY||this.refY;if(e.startPoint.x===e.endPoint.x&&e.startPoint.y===e.endPoint.y)return a.x=e.startPoint.x+s,a.y=e.startPoint.y+f,a.text=e.label,a;var u;ne(t.autoRotate)?u=this.labelAutoRotate:u=t.autoRotate;var h=oi(n,o,s,f,u);return a.x=h.x,a.y=h.y,a.rotate=h.rotate,a.textAlign=this._getTextAlign(i,h.angle),a.text=e.label,a},getLabelBgStyleByPosition:function(e,t){if(!e)return{};var r=e.getBBox(),i=t.style&&t.style.background;if(!i)return{};var a=i.padding,n=r.width+a[1]+a[3],o=r.height+a[0]+a[2],s=w(w({},i),{width:n,height:o,x:r.minX-a[3],y:r.minY-a[0],matrix:[1,0,0,0,1,0,0,0,1]}),f;return ne(t.autoRotate)?f=this.labelAutoRotate:f=t.autoRotate,f&&(s.matrix=e.attr("matrix")||[1,0,0,0,1,0,0,0,1]),s},_getTextAlign:function(e,t){var r="center";return t?(t=t%(Math.PI*2),e!=="center"&&(t>=0&&t<=Math.PI/2||t>=3/2*Math.PI&&t<2*Math.PI?r=e:r=jn(e)),r):e},getControlPoints:function(e){return e.controlPoints},getPathPoints:function(e){return e},drawShape:function(e,t){var r=this.getShapeStyle(e),i=t.addShape("path",{className:Ke,name:Ke,attrs:r});return t.shapeMap[Ke]=i,i},drawLabel:function(e,t){var r=this.options.labelCfg,i=_({},r,e.labelCfg),a=this.getLabelStyle(e,i,t),n=a.rotate;delete a.rotate;var o=t.addShape("text",{attrs:a,name:"text-shape",labelRelated:!0,draggable:!0});if(t.shapeMap["text-shape"]=o,!isNaN(n)&&n!==""&&o.rotateAtStart(n),a.background){var s=this.drawLabelBg(e,t,o,a,n),f=this.itemType+Yt;s.set("classname",f),t.shapeMap[f]=s,o.toFront()}return o},drawLabelBg:function(e,t,r,i,a){var n=this.options.labelCfg,o=_({},n,e.labelCfg),s=this.getLabelBgStyleByPosition(r,o),f=t.addShape("rect",{name:"text-bg-shape",attrs:s,labelRelated:!0});return t.shapeMap["text-bg-shape"]=f,f}},$n=w(w({},Ut),Un);G.registerEdge("single-edge",$n);G.registerEdge("line",{getControlPoints:function(){}},"single-edge");G.registerEdge("spline",{getPath:function(e){var t=yi(e);return t}},"single-edge");G.registerEdge("arc",{curveOffset:20,clockwise:1,getControlPoints:function(e){var t=e.startPoint,r=e.endPoint,i={x:(t.x+r.x)/2,y:(t.y+r.y)/2},a,n;if(e.controlPoints!==void 0){if(n=e.controlPoints[0],a=Et(t,n,r),t.x<=r.x&&t.y>r.y?this.clockwise=a.x>n.x?0:1:t.x<=r.x&&t.y<r.y?this.clockwise=a.x>n.x?1:0:t.x>r.x&&t.y<=r.y?this.clockwise=a.y<n.y?0:1:this.clockwise=a.y<n.y?1:0,(n.x-t.x)/(n.y-t.y)===(r.x-t.x)/(r.y-t.y))return[]}else{e.curveOffset===void 0&&(e.curveOffset=this.curveOffset),W(e.curveOffset)&&(e.curveOffset=e.curveOffset[0]),e.curveOffset<0?this.clockwise=0:this.clockwise=1;var o={x:r.x-t.x,y:r.y-t.y},s=Math.atan2(o.y,o.x);n={x:e.curveOffset*Math.cos(-Math.PI/2+s)+i.x,y:e.curveOffset*Math.sin(-Math.PI/2+s)+i.y},a=Et(t,n,r)}var f=rt(t,a),u=[{x:f,y:f}];return u},getPath:function(e){var t=[];return t.push(["M",e[0].x,e[0].y]),e.length===2?t.push(["L",e[1].x,e[1].y]):t.push(["A",e[1].x,e[1].y,0,0,this.clockwise,e[2].x,e[2].y]),t}},"single-edge");G.registerEdge("quadratic",{curvePosition:.5,curveOffset:-20,getControlPoints:function(e){var t=e.controlPoints;if(!t||!t.length){var r=e.startPoint,i=e.endPoint;e.curveOffset===void 0&&(e.curveOffset=this.curveOffset),e.curvePosition===void 0&&(e.curvePosition=this.curvePosition),W(e.curveOffset)&&(e.curveOffset=e.curveOffset[0]),W(e.curvePosition)&&(e.curvePosition=e.curveOffset[0]);var a=nt(r,i,e.curvePosition,e.curveOffset);t=[a]}return t},getPath:function(e){var t=[];return t.push(["M",e[0].x,e[0].y]),t.push(["Q",e[1].x,e[1].y,e[2].x,e[2].y]),t}},"single-edge");G.registerEdge("cubic",{curvePosition:[1/2,1/2],curveOffset:[-20,20],getControlPoints:function(e){var t=e.controlPoints;if(e.curveOffset===void 0&&(e.curveOffset=this.curveOffset),e.curvePosition===void 0&&(e.curvePosition=this.curvePosition),R(e.curveOffset)&&(e.curveOffset=[e.curveOffset,-e.curveOffset]),R(e.curvePosition)&&(e.curvePosition=[e.curvePosition,1-e.curvePosition]),!t||!t.length||t.length<2){var r=e.startPoint,i=e.endPoint,a=nt(r,i,e.curvePosition[0],e.curveOffset[0]),n=nt(r,i,e.curvePosition[1],e.curveOffset[1]);t=[a,n]}return t},getPath:function(e){var t=[];return t.push(["M",e[0].x,e[0].y]),t.push(["C",e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y]),t}},"single-edge");G.registerEdge("cubic-vertical",{curvePosition:[1/2,1/2],minCurveOffset:[0,0],curveOffset:void 0,getControlPoints:function(e){var t=e.startPoint,r=e.endPoint;e.curvePosition===void 0&&(e.curvePosition=this.curvePosition),e.curveOffset===void 0&&(e.curveOffset=this.curveOffset),e.minCurveOffset===void 0&&(e.minCurveOffset=this.minCurveOffset),R(e.curveOffset)&&(e.curveOffset=[e.curveOffset,-e.curveOffset]),R(e.minCurveOffset)&&(e.minCurveOffset=[e.minCurveOffset,-e.minCurveOffset]),R(e.curvePosition)&&(e.curvePosition=[e.curvePosition,1-e.curvePosition]);var i=r.y-t.y,a=[0,0];e.curveOffset?a=e.curveOffset:Math.abs(i)<Math.abs(e.minCurveOffset[0])&&(a=e.minCurveOffset);var n={x:t.x,y:t.y+i*this.curvePosition[0]+a[0]},o={x:r.x,y:r.y-i*this.curvePosition[1]+a[1]};return[n,o]}},"cubic");G.registerEdge("cubic-horizontal",{curvePosition:[1/2,1/2],minCurveOffset:[0,0],curveOffset:void 0,getControlPoints:function(e){var t=e.startPoint,r=e.endPoint;e.curvePosition===void 0&&(e.curvePosition=this.curvePosition),e.curveOffset===void 0&&(e.curveOffset=this.curveOffset),e.minCurveOffset===void 0&&(e.minCurveOffset=this.minCurveOffset),R(e.curveOffset)&&(e.curveOffset=[e.curveOffset,-e.curveOffset]),R(e.minCurveOffset)&&(e.minCurveOffset=[e.minCurveOffset,-e.minCurveOffset]),R(e.curvePosition)&&(e.curvePosition=[e.curvePosition,1-e.curvePosition]);var i=r.x-t.x,a=[0,0];e.curveOffset?a=e.curveOffset:Math.abs(i)<Math.abs(e.minCurveOffset[0])&&(a=e.minCurveOffset);var n={x:t.x+i*this.curvePosition[0]+a[0],y:t.y},o={x:r.x-i*this.curvePosition[1]+a[1],y:r.y},s=[n,o];return s}},"cubic");G.registerEdge("loop",{getPathPoints:function(e){return ni(e)},getControlPoints:function(e){return e.controlPoints},afterDraw:function(e){e.controlPoints=void 0},afterUpdate:function(e){e.controlPoints=void 0}},"cubic");var Zn={itemType:"combo",shapeType:"single-combo",labelPosition:"top",refX:N.comboLabel.refX,refY:N.comboLabel.refY,options:{style:{stroke:N.defaultCombo.style.stroke,fill:N.defaultCombo.style.fill,lineWidth:N.defaultCombo.style.lineWidth},labelCfg:{style:{fill:N.comboLabel.style.fill,fontSize:N.comboLabel.style.fontSize,fontFamily:N.windowFontFamily}},stateStyles:w({},N.comboStateStyles),collapsedSubstituteIcon:{show:!1,img:"https://gw.alipayobjects.com/mdn/rms_f8c6a0/afts/img/A*RsnHRqLfJn4AAAAAAAAAAAAAARQnAQ"}},getSize:function(e){var t=V(e.size||this.options.size||N.defaultCombo.size);return W(t)&&t.length===1&&(t=[t[0],t[0]]),W(t)||(t=[t,t]),t},getLabelStyleByPosition:function(e,t){var r=t.position||this.labelPosition,i=e.style,a=e.padding||this.options.padding;W(a)&&(a=Math.max.apply(Math,a));var n=t.refX,o=t.refY;ne(n)&&(n=this.refX),ne(o)&&(o=this.refY);var s=this.getSize(e),f=Math.max(i.r,s[0]/2)||s[0]/2,u=f+a,h;switch(r){case"top":h={x:0,y:-u-o,textBaseline:"bottom",textAlign:"center"};break;case"bottom":h={x:0,y:u+o,textBaseline:"bottom",textAlign:"center"};break;case"left":h={x:-u+n,y:0,textAlign:"left"};break;case"center":h={x:0,y:0,text:e.label,textAlign:"center"};break;default:h={x:u+n,y:0,textAlign:"right"};break}return h.text=e.label,h},drawShape:function(e,t){var r=this.shapeType,i=this.getShapeStyle(e),a=t.addShape(r,{attrs:i,draggable:!0,name:"combo-shape"});return a},updateCollapsedIcon:function(e,t,r){var i=e.collapsed,a=e.collapsedSubstituteIcon,n=a===void 0?{}:a,o=Object.assign({},this.options.collapsedSubstituteIcon,n),s=o.show,f=o.img,u=o.width,h=o.height,c=t.getContainer(),d=c.find(function(y){return y.get("name")==="combo-collapsed-substitute-icon"}),p=d&&!d.destroyed,v=t.get("keyShape");if(i&&s){if(p)d.show();else{var g={width:u||r.r*2||r.width,height:h||r.r*2||r.height};d=c.addShape("image",{attrs:w({img:f,x:-g.width/2,y:-g.height/2},g),name:"combo-collapsed-substitute-icon",draggable:!0})}v.hide()}else p&&(d.hide(),v.show())},updateShape:function(e,t,r){var i=this,a=t.get("keyShape"),n=t.get("animate"),o=n&&(e.animate===void 0?this.options.animate:e.animate);o&&a.animate?(e.collapsed||this.updateCollapsedIcon(e,t,r),a.animate(r,{duration:200,easing:"easeLinear",callback:function(){e.collapsed&&i.updateCollapsedIcon(e,t,r)}})):(a.attr(w({},r)),this.updateCollapsedIcon(e,t,r)),this.updateLabel(e,t)}},qn=w(w({},Ut),Zn);G.registerCombo("single-combo",qn);G.registerCombo("circle",{options:{size:[N.defaultCombo.size[0],N.defaultCombo.size[0]],padding:Math.max.apply(Math,N.defaultCombo.padding),animate:!0,style:{stroke:N.defaultCombo.style.stroke,fill:N.defaultCombo.style.fill,lineWidth:N.defaultCombo.style.lineWidth},labelCfg:{style:{fill:N.comboLabel.style.fill,fontSize:N.comboLabel.style.fontSize},refX:0,refY:0},stateStyles:w({},N.comboStateStyles),collapsedSubstituteIcon:{show:!1,img:"https://gw.alipayobjects.com/mdn/rms_f8c6a0/afts/img/A*RsnHRqLfJn4AAAAAAAAAAAAAARQnAQ"}},shapeType:"circle",labelPosition:"top",drawShape:function(e,t){var r=this.getShapeStyle(e);delete r.height,delete r.width;var i=t.addShape("circle",{attrs:r,className:"circle-combo",name:"circle-combo",draggable:!0});return i},getShapeStyle:function(e){var t=this.options.style,r=e.padding||this.options.padding;W(r)&&(r=Math.max.apply(Math,r));var i={stroke:e.color},a=$({},t,i,e.style),n=e.collapsed&&e.fixCollapseSize?e.fixCollapseSize:e.fixSize,o;if(n)o=R(n)?n/2:n[0]/2;else{var s=this.getSize(e);!R(a.r)||isNaN(a.r)?o=s[0]/2||N.defaultCombo.style.r:o=Math.max(a.r,s[0]/2)||s[0]/2}a.r=o+r;var f=w({x:0,y:0},a);return e.style?e.style.r=o:e.style={r:o},f},update:function(e,t){var r=this.getSize(e),i=e.padding||this.options.padding;W(i)&&(i=Math.max.apply(Math,i));var a=V(e.style),n=e.collapsed&&e.fixCollapseSize?e.fixCollapseSize:e.fixSize,o;n?o=R(n)?n/2:n[0]/2:o=Math.max(a.r,r[0]/2)||r[0]/2,a.r=o+i;var s=t.get("sizeCache");s&&(s.r=a.r);var f={stroke:e.color},u=t.get("keyShape"),h=$({},u.attr(),f,a);e.style?e.style.r=o:e.style={r:o},this.updateShape(e,t,h,!0)}},"single-combo");G.registerCombo("rect",{options:{size:[40,5],padding:[25,20,15,20],animate:!0,style:{radius:0,stroke:N.defaultCombo.style.stroke,fill:N.defaultCombo.style.fill,lineWidth:N.defaultCombo.style.lineWidth},labelCfg:{style:{fill:N.comboLabel.style.fill,fontSize:N.comboLabel.style.fontSize,fontFamily:N.windowFontFamily}},anchorPoints:[[0,.5],[1,.5]],stateStyles:w({},N.comboStateStyles),collapsedSubstituteIcon:{show:!1,img:"https://gw.alipayobjects.com/mdn/rms_f8c6a0/afts/img/A*RsnHRqLfJn4AAAAAAAAAAAAAARQnAQ"}},shapeType:"rect",labelPosition:"top",drawShape:function(e,t){var r=this.getShapeStyle(e),i=t.addShape("rect",{attrs:r,className:"rect-combo",name:"rect-combo",draggable:!0});return i},getLabelStyleByPosition:function(e,t){var r=t.position||this.labelPosition,i=e.style,a=e.padding||this.options.padding;R(a)&&(a=[a,a,a,a]);var n=t.refX,o=t.refY;ne(n)&&(n=this.refX),ne(o)&&(o=this.refY);var s=-i.width/2-a[3],f=i.width/2+a[1],u=-i.height/2-a[0],h=i.height/2+a[2],c;switch(r){case"top":c={x:s+n,y:u+o,textBaseline:"top",textAlign:"left"};break;case"bottom":c={x:0,y:h+o,textBaseline:"top",textAlign:"center"};break;case"left":c={x:s+o,y:0,textAlign:"left"};break;case"center":c={x:0,y:0,text:e.label,textAlign:"center"};break;case"top-center":c={x:0,y:u+o,textBaseline:"top",textAlign:"center"};break;default:c={x:f+n,y:0,textAlign:"right"};break}return c.text=e.label,c},getShapeStyle:function(e){var t=this.options.style,r=e.padding||this.options.padding;R(r)&&(r=[r,r,r,r]);var i={stroke:e.color},a=$({},t,i,e.style),n=this.getSize(e),o,s,f=e.collapsed&&e.fixCollapseSize?e.fixCollapseSize:e.fixSize;f?R(f)?(o=f,s=f):(o=f[0],s=f[1]):(!R(a.width)||isNaN(a.width)?o=n[0]||N.defaultCombo.style.width:o=Math.max(a.width,n[0])||n[0],!R(a.height)||isNaN(a.height)?s=n[1]||N.defaultCombo.style.height:s=Math.max(a.height,n[1])||n[1]);var u=-o/2-r[3],h=-s/2-r[0];a.width=o+r[1]+r[3],a.height=s+r[0]+r[2];var c=w({x:u,y:h},a);return e.style?(e.style.width=o,e.style.height=s):e.style={width:o,height:s},c},update:function(e,t){var r=this.getSize(e),i=e.padding||this.options.padding;R(i)&&(i=[i,i,i,i]);var a=V(e.style),n,o,s=e.collapsed&&e.fixCollapseSize?e.fixCollapseSize:e.fixSize;s?R(s)?(n=s,o=s):(n=s[0],o=s[1]):(n=Math.max(a.width,r[0])||r[0],o=Math.max(a.height,r[1])||r[1]),a.width=n+i[1]+i[3],a.height=o+i[0]+i[2];var f=t.get("sizeCache");f&&(f.width=a.width,f.height=a.height),a.x=-n/2-i[3],a.y=-o/2-i[0];var u={stroke:e.color},h=t.get("keyShape"),c=$({},h.attr(),u,a);e.style?(e.style.width=n,e.style.height=o):e.style={width:n,height:o},this.updateShape(e,t,c,!1)}},"single-combo");G.registerNode("simple-circle",{options:{size:N.defaultNode.size,style:{x:0,y:0,stroke:N.defaultNode.style.stroke,fill:N.defaultNode.style.fill,lineWidth:N.defaultNode.style.lineWidth},labelCfg:{style:{fill:N.nodeLabel.style.fill,fontSize:N.nodeLabel.style.fontSize,fontFamily:N.windowFontFamily}},stateStyles:w({},N.nodeStateStyles)},shapeType:"simple-circle",labelPosition:"center",shapeMap:{},drawShape:function(e,t){var r=this.getShapeStyle(e),i="".concat(this.type,"-keyShape"),a=t.addShape("circle",{attrs:r,className:"".concat(this.type,"-keyShape"),name:i,draggable:!0});return t.shapeMap[i]=a,a},getShapeStyle:function(e){var t=(this.mergeStyle||this.getOptions(e)).style,r={stroke:e.color},i=_({},t,r),a=this.getSize(e),n=a[0]/2,o=w({x:0,y:0,r:n},i);return o},update:function(e,t,r){var i=this.getSize(e),a={stroke:e.color,r:i[0]/2},n=t.get("keyShape"),o=_({},n.attr(),a,e.style);this.updateShape(e,t,o,!0,r)}},"single-node");G.registerNode("simple-rect",{options:{size:[100,30],style:{radius:0,stroke:N.defaultNode.style.stroke,fill:N.defaultNode.style.fill,lineWidth:N.defaultNode.style.lineWidth},labelCfg:{style:{fill:N.nodeLabel.style.fill,fontSize:N.nodeLabel.style.fontSize,fontFamily:N.windowFontFamily}},anchorPoints:[[0,.5],[1,.5]],stateStyles:w({},N.nodeStateStyles)},shapeType:"simple-rect",labelPosition:"center",drawShape:function(e,t){var r=this.getShapeStyle(e),i=t.addShape("rect",{attrs:r,className:"".concat(this.type,"-keyShape"),name:"".concat(this.type,"-keyShape"),draggable:!0});return i},getShapeStyle:function(e){var t=(this.mergeStyle||this.getOptions(e)).style,r={stroke:e.color},i=$({},t,r),a=this.getSize(e),n=i.width||a[0],o=i.height||a[1],s=w({x:-n/2,y:-o/2,width:n,height:o},i);return s},update:function(e,t,r){t.getContainer();var i=(this.mergeStyle||this.getOptions(e)).style,a=this.getSize(e),n=t.get("keyShape");e.size||(a[0]=n.attr("width")||i.width,a[1]=n.attr("height")||i.height);var o={stroke:e.color,x:-a[0]/2,y:-a[1]/2,width:a[0],height:a[1]},s=$({},i,n.attr(),o);s=$(s,e.style),this.updateShape(e,t,s,!1,r)}},"single-node");G.registerNode("image",{options:{img:"https://gw.alipayobjects.com/mdn/rms_f8c6a0/afts/img/A*eD7nT6tmYgAAAAAAAAAAAABkARQnAQ",size:200,labelCfg:{style:{fontFamily:N.windowFontFamily}},clipCfg:{show:!1,type:"circle",r:50,rx:50,ry:35,width:50,height:35,points:[[30,12],[12,30],[30,48],[48,30]],path:[["M",25,25],["L",50,25],["A",12.5,12.5,0,1,1,50,50],["A",12.5,12.5,0,1,0,50,50],["L",25,75],["Z"]],x:0,y:0}},shapeType:"image",labelPosition:"bottom",drawShape:function(e,t){var r=this.shapeType,i=this.getShapeStyle(e);delete i.fill;var a=t.addShape(r,{attrs:i,className:"".concat(this.type,"-keyShape"),name:"".concat(this.type,"-keyShape"),draggable:!0});return this.drawClip(e,a),a},drawClip:function(e,t){var r=(this.mergeStyle||this.getOptions(e)).clipCfg;if(r.show){var i=r.type,a=r.x,n=r.y,o=r.style;if(i==="circle"){var s=r.r;t.setClip({type:"circle",attrs:w({r:s,x:a,y:n},o)})}else if(i==="rect"){var f=r.width,u=r.height,h=a-f/2,c=n-u/2;t.setClip({type:"rect",attrs:w({x:h,y:c,width:f,height:u},o)})}else if(i==="ellipse"){var d=r.rx,p=r.ry;t.setClip({type:"ellipse",attrs:w({x:a,y:n,rx:d,ry:p},o)})}else if(i==="polygon"){var v=r.points;t.setClip({type:"polygon",attrs:w({points:v},o)})}else if(i==="path"){var g=r.path;t.setClip({type:"path",attrs:w({path:g},o)})}}},getShapeStyle:function(e){var t=this.mergeStyle||this.getOptions(e),r=t.style,i=t.img,a=this.getSize(e),n=a[0],o=a[1];r&&(n=r.width||a[0],o=r.height||a[1]);var s=w({x:-n/2,y:-o/2,width:n,height:o,img:i},r);return s},updateShapeStyle:function(e,t){var r=t.getContainer(),i="".concat(this.itemType,"-shape"),a=r.shapeMap[i]||r.find(function(o){return o.get("className")===i})||t.getKeyShape(),n=this.getShapeStyle(e);a&&!a.destroyed&&a.attr(n)}},"single-node");const Kn={triangle:function(e,t,r){e===void 0&&(e=10),t===void 0&&(t=15),r===void 0&&(r=0);var i=r*2,a="M ".concat(i,",0 L ").concat(i+t,",-").concat(e/2," L ").concat(i+t,",").concat(e/2," Z");return a},vee:function(e,t,r){e===void 0&&(e=15),t===void 0&&(t=20),r===void 0&&(r=0);var i=r*2,a="M ".concat(i,",0 L ").concat(i+t,",-").concat(e/2,`
        L `).concat(i+2*t/3,",0 L ").concat(i+t,",").concat(e/2," Z");return a},circle:function(e,t){e===void 0&&(e=5),t===void 0&&(t=0);var r=t*2,i="M ".concat(r,`, 0
            a `).concat(e,",").concat(e," 0 1,0 ").concat(e*2,`,0
            a `).concat(e,",").concat(e," 0 1,0 ").concat(-e*2,",0");return i},rect:function(e,t,r){e===void 0&&(e=10),t===void 0&&(t=10),r===void 0&&(r=0);var i=r*2,a="M ".concat(i,",").concat(-e/2,` 
        L `).concat(i+t,",").concat(-e/2,` 
        L `).concat(i+t,",").concat(e/2,` 
        L `).concat(i,",").concat(e/2," Z");return a},diamond:function(e,t,r){e===void 0&&(e=15),t===void 0&&(t=15),r===void 0&&(r=0);var i=r*2,a="M ".concat(i,`,0 
        L `).concat(i+t/2,",").concat(-e/2,` 
        L `).concat(i+t,`,0 
        L `).concat(i+t/2,",").concat(e/2," Z");return a},triangleRect:function(e,t,r,i,a,n){e===void 0&&(e=15),t===void 0&&(t=15),r===void 0&&(r=15),i===void 0&&(i=3),a===void 0&&(a=5),n===void 0&&(n=0);var o=n*2,s=o+t+a,f="M ".concat(o,",0 L ").concat(o+t,",-").concat(e/2," L ").concat(o+t,",").concat(e/2,` Z
            M `).concat(s,", -").concat(r/2,`
            L `).concat(s+i," -").concat(r/2,`
            L `).concat(s+i," ").concat(r/2,`
            L `).concat(s," ").concat(r/2,`
            Z`);return f}},Qn={collapse:function(e,t,r){return[["M",e-r,t],["a",r,r,0,1,0,r*2,0],["a",r,r,0,1,0,-r*2,0],["M",e-r+4,t],["L",e+r-4,t]]},expand:function(e,t,r){return[["M",e-r,t],["a",r,r,0,1,0,r*2,0],["a",r,r,0,1,0,-r*2,0],["M",e-r+4,t],["L",e-r+2*r-4,t],["M",e-r+r,t-r+4],["L",e,t+r-4]]},upTriangle:function(e,t,r){var i=r*Math.cos(Math.PI/6),a=r*Math.sin(Math.PI/6);return[["M",e-i,t+a],["L",e+i,t+a],["L",e,t-r],["Z"]]},downTriangle:function(e,t,r){var i=r*Math.cos(Math.PI/6),a=r*Math.sin(Math.PI/6);return[["M",e-i,t-a],["L",e+i,t-a],["L",e,t+r],["Z"]]}};var Jn=["#5F95FF","#61DDAA","#65789B","#F6BD16","#7262FD","#78D3F8","#9661BC","#F6903D","#008685","#F08BB4"];const _n=Object.freeze(Object.defineProperty({__proto__:null,defaultSubjectColors:Jn},Symbol.toStringTag,{value:"Module"}));var Si=function(e){return e==="force"||e==="g6force"||e==="gForce"||e==="force2"};const eo=Object.freeze(Object.defineProperty({__proto__:null,isForce:Si},Symbol.toStringTag,{value:"Module"}));var to=ot,Ci=w(w(w(w(w(w(w({},gn),un),Tn),_a),_n),eo),{transform:to,mat3:oa}),ro=function(){function l(e){this.graph=e,this.layoutCfg=e.get("layout")||{},this.layoutType=this.getLayoutType(),this.layoutMethods=[],this.initLayout()}return l.prototype.initLayout=function(){},l.prototype.getLayoutType=function(){return this.getLayoutCfgType(this.layoutCfg)},l.prototype.getLayoutCfgType=function(e){var t=e.type;if(t)return t;var r=e.pipes;return Array.isArray(r)?r.map(function(i){return(i==null?void 0:i.type)||""}):null},l.prototype.isLayoutTypeSame=function(e){var t=this.getLayoutCfgType(e),r=Array.isArray(this.layoutType),i=Array.isArray(t);return r&&i?this.layoutType.every(function(a,n){return a===t[n]}):Array.isArray(t)||Array.isArray(this.layoutType)?!1:(e==null?void 0:e.type)===this.layoutType},l.prototype.refreshLayout=function(){var e=this,t=e.graph,r=e.layoutType,i=e.layoutCfg,a=i===void 0?{}:i;if(t){var n=a.animate,o=n===void 0&&(r==="force"||r==="force2"),s=Si(r)&&(n||o);t.get("animate")&&!s?t.positionsAnimate(r==="comboCombined"):t.refreshPositions(r==="comboCombined")}},l.prototype.changeLayout=function(e){var t=e.disableTriggerLayout,r=St(e,["disableTriggerLayout"]);this.layoutCfg=r,this.layoutType=r.type||this.layoutType,!t&&this.layout()},l.prototype.changeData=function(e){this.layout(e)},l.prototype.destoryLayoutMethods=function(){var e=this.layoutMethods,t=[];return e==null||e.forEach(function(r){var i,a=(i=r.getType)===null||i===void 0?void 0:i.call(r);a&&t.push(a),r.destroy()}),this.layoutMethods=[],t},l.prototype.destroyLayout=function(){this.destoryLayoutMethods();var e=this.graph;e&&!e.get("destroyed")&&e.set("layout",void 0),this.layoutCfg=void 0,this.layoutType=void 0,this.layoutMethods=void 0},l.prototype.setDataFromGraph=function(){for(var e,t=[],r=[],i=[],a=[],n=[],o=[],s=[],f=this.graph.getNodes(),u=this.graph.getEdges(),h=this.graph.getCombos(),c=f.length,d=0;d<c;d++){var p=f[d];if(!(!p||p.destroyed)){var v=p.getModel();if(!p.isVisible()){r.push(v);continue}t.push(v)}}for(var g=u.length,d=0;d<g;d++){var y=u[d];if(!(!y||y.destroyed)){var v=y.getModel();if(!y.isVisible()){a.push(v);continue}v.isComboEdge?n.push(v):i.push(v)}}for(var m=h.length,d=0;d<m;d++){var b=h[d];if(!b.destroyed){var v=b.getModel();if(!b.isVisible()){s.push(v);continue}o.push(v)}}return{nodes:t,hiddenNodes:r,edges:i,hiddenEdges:a,combos:o,hiddenCombos:s,comboEdges:n,vedges:(e=this.graph.get("vedges"))===null||e===void 0?void 0:e.map(function(S){return S.getModel()})}},l.prototype.relayout=function(e){var t=this,r=this,i=r.graph,a=r.layoutMethods,n=r.layoutCfg;if(!(!i||i.get("destroyed"))){var o=Promise.resolve();if(e){this.data=this.setDataFromGraph();var s=this.data.nodes;if(!s)return!1;o=this.initPositions(n.center,s)}i.emit("beforelayout"),a==null||a.forEach(function(f,u){var h=n[u]||n;o=o.then(function(){var c,d=t.execLayoutMethod(h,u);return u===a.length-1&&((c=n.onAllLayoutEnd)===null||c===void 0||c.call(n)),d})})}},l.prototype.filterLayoutData=function(e,t){var r=e.nodes,i=e.edges,a=St(e,["nodes","edges"]);if(!r)return e;var n,o;ze(t==null?void 0:t.nodesFilter)?n=t.nodesFilter:n=function(){return!0};var s=r.filter(n);if(ze(t==null?void 0:t.edgesFilter))o=t.edgesFilter;else{var f=s.reduce(function(u,h){return u[h.id]=!0,u},{});o=function(h){return f[h.source]&&f[h.target]}}return w({nodes:s,edges:i.filter(o)},a)},l.prototype.getLayoutBBox=function(e){var t=this.graph,r=nr(t.getNodes(),function(n){return n.getModel().layoutOrder}),i=Object.values(r).map(function(n){var o=fi(n);return o.size=[o.width,o.height],o}),a=Object.values(nr(e,"layoutOrder"));return{groupNodes:a,layoutNodes:i}},l.prototype.layoutAnimate=function(){},l.prototype.moveToZero=function(){var e=this.graph,t=e.get("data"),r=t.nodes;if(!(r[0].x===void 0||r[0].x===null||fe(r[0].x))){for(var i=[0,0],a=r.length,n=0;n<a;n++){var o=r[n];i[0]+=o.x,i[1]+=o.y}i[0]/=r.length,i[1]/=r.length;for(var n=0;n<a;n++){var o=r[n];o.x-=i[0],o.y-=i[1]}}},l.prototype.initPositions=function(e,t){var r;return sa(this,void 0,void 0,function(){var i,a,n;return la(this,function(o){return i=this.graph,t!=null&&t.length?(a=t.filter(function(s){return fe(s.x)||fe(s.y)}),n=a?a.length:0,n?[2,(r=this.initWithPreset)===null||r===void 0?void 0:r.call(this,function(){},function(){var s=i.get("width")*.85,f=i.get("height")*.85,u=Math.ceil(Math.sqrt(n)*(s/f)),h=Math.ceil(n/u),c=s/(u-1),d=f/(h-1);(!isFinite(c)||!c)&&(c=0),(!isFinite(d)||!c)&&(d=0);for(var p=e[0]-s/2,v=e[1]-f/2,g=0;g<n;g++){var y=a[g];fe(+y.x)&&(y.x=g%u*c+p),fe(+y.y)&&(y.y=Math.floor(g/u)*d+v)}})]:[2]):[2,Promise.resolve()]})})},l.prototype.destroy=function(){this.graph=null,this.destoryLayoutMethods(),this.destroyed=!0},l}(),io=function(){function l(e){this.graph=e,this.destroyed=!1,this.initEvents()}return l}();G.registerNode;G.registerEdge;G.registerCombo;var ae=N;N.version,G.registerNode,G.registerEdge,G.registerCombo,Ur.registerBehavior;var ao={}.toString,no=function(l,e){return ao.call(l)==="[object "+e+"]"};const $t=no,oo=function(l){return Array.isArray?Array.isArray(l):$t(l,"Array")};var so=function(l){return typeof l=="object"&&l!==null};const lo=so;var uo=function(l){if(!lo(l)||!$t(l,"Object"))return!1;if(Object.getPrototypeOf(l)===null)return!0;for(var e=l;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(l)===e};const kr=uo;var fo=function(l){return $t(l,"Number")};const ho=fo;var co=5;function vo(l,e){if(Object.hasOwn)return Object.hasOwn(l,e);if(l==null)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(l),e)}function wi(l,e,t,r){t=t||0,r=r||co;for(var i in e)if(vo(e,i)){var a=e[i];a!==null&&kr(a)?(kr(l[i])||(l[i]={}),t<r?wi(l[i],a,t+1,r):l[i]=e[i]):oo(a)?(l[i]=[],l[i]=l[i].concat(a)):a!==void 0&&(l[i]=a)}}var po=function(l){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];for(var r=0;r<e.length;r+=1)wi(l,e[r]);return l};const go=po,{defaultSubjectColors:Te}=Ci,yo=(l,e,t,r,i)=>{ua("donut",{options:{size:ae.defaultNode.size,style:{x:0,y:0,stroke:ae.defaultNode.style.stroke,fill:ae.defaultNode.style.fill,lineWidth:ae.defaultNode.style.lineWidth},labelCfg:{style:{fill:ae.nodeLabel.style.fill,fontSize:ae.nodeLabel.style.fontSize}},linkPoints:{top:!1,right:!1,bottom:!1,left:!1,size:ae.defaultNode.linkPoints.size,lineWidth:ae.defaultNode.linkPoints.lineWidth,fill:ae.defaultNode.linkPoints.fill,stroke:ae.defaultNode.linkPoints.stroke},icon:{show:!1,img:"https://gw.alipayobjects.com/zos/bmw-prod/5d015065-8505-4e7a-baec-976f81e3c41d.svg",width:20,height:20},stateStyles:{...ae.nodeStateStyles}},shapeType:"circle",labelPosition:"center",drawShape(a,n){const{icon:o={}}=this.getOptions(a),s=this.getShapeStyle(a),f=go({},o,a.icon),u=n.addShape("circle",{attrs:s,className:`${this.type}-keyShape`,draggable:!0,name:`${this.type}-keyShape`}),{width:h,height:c,show:d,text:p}=f;if(d)if(p){let I=!1;if(e){const M=a.label;if(i.find(E=>E==M))I=!0;else{const E=t.split(",");for(const B of E)if(!ye.isEmpty(B)&&new RegExp(B.trim()).test(M.toString())){I=!0;break}}}n.addShape("text",{attrs:{x:0,y:0,fontSize:I?14:12,fill:I?r:l=="light"?ir.textColorRGB.light:ir.textColorRGB.dark,strokerWidth:1,textBaseline:"middle",textAlign:"center",...f},className:`${this.type}-icon`,name:`${this.type}-icon`,draggable:!0})}else n.addShape("image",{attrs:{x:-h/2,y:-c/2,...f},className:`${this.type}-icon`,name:`${this.type}-icon`,draggable:!0});const v=u.attr("r"),g=v-1.5,y=(v+g)/2,{donutAttrs:m={},donutColorMap:b={}}=a,S=Object.keys(m).length;if(m&&S>1){const I=[];let M=0;if(Object.keys(m).forEach(C=>{const E=m[C]||0;ho(E)&&(I.push({key:C,value:E,color:b[C]}),M+=E)}),M){const C=v-g;if(S===1){n.addShape("circle",{attrs:{r:y,x:0,y:0,stroke:I[0].color||Te[0],lineWidth:C},name:"fan-shape-0"});return}let E=[y,0],B=0;I.forEach((P,O)=>{let Y=P.value/M;if(Y<.001)return;if(Y>.999&&(Y=1),Y===1){n.addShape("circle",{attrs:{r:y,x:0,y:0,stroke:P.color||Te[O%Te.length],lineWidth:C},name:`fan-shape-${O}`});return}P.percent=Y,P.angle=Y*Math.PI*2,P.beginAgnle=B,B+=P.angle,P.endAngle=B,P.arcBegin=E,P.arcEnd=[y*Math.cos(P.endAngle),-y*Math.sin(P.endAngle)];const j=P.angle>Math.PI?1:0,T=[["M",P.arcBegin[0],P.arcBegin[1]],["A",y,y,0,j,0,P.arcEnd[0],P.arcEnd[1]],["L",P.arcEnd[0],P.arcEnd[1]]];n.addShape("path",{attrs:{path:T,lineWidth:C,stroke:P.color||Te[O%Te.length]},name:`fan-shape-${O}`}),E=P.arcEnd})}}return u},update:void 0},"circle")},mo=l=>l&&l.nodes&&l.edges,Mo=l=>Yr(l.data)?x.createElement(_e,{height:"100%"},"No data"):x.createElement(x.Fragment,null,mo(l.data[0])?x.createElement(bo,{...l}):x.createElement(_e,{height:"100%"},x.createElement(Ce,null,x.createElement(Z,{fontWeight:500,fontSize:"1.1rem"},"Data format not support!"),x.createElement(Z,{className:"color-text"},"Try to change to Testdata datasource, then look into its data format in Panel Debug"))));let bt;const bo=({data:l,panel:e,dashboardId:t,width:r,height:i})=>{if(Yr(l))return x.createElement(_e,{height:"100%"},"No data");const a=fa(pa),n=Rt(),o=x.useRef(null),[s,f]=U.useState(null),{colorMode:u}=ha(),h=Wr(u),c=Rr(u,e.plugins.nodeGraph),[d,p]=U.useState(!1),v=Ia(e.plugins.nodeGraph),g={};e.plugins.nodeGraph.node.donutColors.forEach(I=>{g[I.attr]=I.color});const y=U.useMemo(()=>Sa(g),[]),m=U.useMemo(()=>{let I=[];if(e.plugins.nodeGraph.node.enableHighlight){const M=zr(e.plugins.nodeGraph.node.highlightNodesByFunc);ye.isFunction(M)?I=M(l[0],ca):n({description:a.invalidHighlight,status:"warning",duration:3e3,isClosable:!0})}return I},[e.plugins.nodeGraph.node.highlightNodesByFunc,e.plugins.nodeGraph.node.enableHighlight]);U.useEffect(()=>{s&&(s.changeSize(r,i),s.render())},[r,i]),U.useEffect(()=>{s&&So(s,l,u,t,e),bt=u,yo(u,e.plugins.nodeGraph.node.enableHighlight,e.plugins.nodeGraph.node.highlightNodes,de(e.plugins.nodeGraph.node.highlightColor),m),s&&da(va+e.id)},[u,e.plugins.nodeGraph.node.enableHighlight,e.plugins.nodeGraph.node.highlightNodes,e.plugins.nodeGraph.node.highlightColor,m]),U.useEffect(()=>{s&&Br(e,l,u,t,s)},[l]),U.useEffect(()=>{if(s){Br(e,l,u,t,s);const I={nodeStrength:e.plugins.nodeGraph.layout.nodeStrength,gravity:e.plugins.nodeGraph.layout.gravity};s.updateLayout(I)}},[e.plugins]);const b=I=>{const M=et(l[0],t,e.id,I);M!=l[0]?(s.data(M),s.render()):s.changeData(M)};U.useEffect(()=>{if(!s){console.time("init node graph, time used: ");const I=xa(e.plugins.nodeGraph);Dr(e.plugins.nodeGraph,l[0],u);const M=[I,v];e.plugins.nodeGraph.legend.enable&&M.push(y);const C=new Me.Graph({container:o.current,fitCenter:!0,fitViewPadding:16,plugins:M,modes:{default:[e.plugins.nodeGraph.zoomCanvas&&"zoom-canvas",e.plugins.nodeGraph.scrollCanvas&&"scroll-canvas",e.plugins.nodeGraph.dragNode&&"drag-node","activate-relations",e.plugins.nodeGraph.dragCanvas&&"drag-canvas","click-select",{type:"lasso-select",onSelect(P,O){p(!0)}}],fisheyeMode:[]},layout:{type:"force2",gpuEnabled:!0,preventOverlap:!0,nodeStrength:e.plugins.nodeGraph.layout.nodeStrength,gravity:e.plugins.nodeGraph.layout.gravity,preset:{type:"radial"}},defaultEdge:{type:e.plugins.nodeGraph.edge.shape??"quadratic",style:{radius:10,endArrow:e.plugins.nodeGraph.edge.arrow=="default"?!0:{path:Me.Arrow[e.plugins.nodeGraph.edge.arrow](),fill:u=="light"?de(e.plugins.nodeGraph.edge.color.light,u):de(e.plugins.nodeGraph.edge.color.dark,u)},opacity:e.plugins.nodeGraph.edge.opacity,lineWidth:1,stroke:u=="light"?de(e.plugins.nodeGraph.edge.color.light,u):de(e.plugins.nodeGraph.edge.color.dark,u)},labelCfg:c,stateStyles:{}},defaultNode:{type:"donut",style:{lineWidth:0,fill:"transparent",stroke:de(e.plugins.nodeGraph.node.borderColor,u)},size:e.plugins.nodeGraph.node.baseSize,labelCfg:h,donutColorMap:g,stateStyles:{}},nodeStateStyles:Gr(e.plugins.nodeGraph,u),edgeStateStyles:Vr(e.plugins.nodeGraph,u)}),E=C;E.on("node:mouseenter",P=>{const{item:O}=P;E.setItemState(O,"active",!0),C.getEdges().forEach(Y=>{C.updateItem(Y,{labelCfg:{...c,style:{opacity:0}}})}),O.getEdges().forEach(Y=>{E.updateItem(Y,{labelCfg:ar(bt,e.plugins.nodeGraph)})})}),E.on("node:mouseleave",P=>{const{item:O}=P;E.setItemState(O,"active",!1),O.hasState("selected")||O.getEdges().forEach(Y=>{E.updateItem(Y,{labelCfg:c})}),C.getEdges().forEach(Y=>{C.updateItem(Y,{labelCfg:c})})}),E.on("node:click",P=>{const{item:O}=P;E.setItemState(O,"selected",!0),p(!0)}),E.on("node:dblclick",P=>{const{item:O}=P;E.setItemState(O,"selected",!0),O.getEdges().forEach(Y=>{E.updateItem(Y,{labelCfg:ar(bt,e.plugins.nodeGraph)}),E.setItemState(Y,"selected",!0)})}),E.on("canvas:click",P=>{xo(E,c),p(!1)});const B=et(l[0],t,e.id);C.data(B),C.render(),f(C)}},[e.plugins.nodeGraph]);const S=U.useCallback(I=>p(I),[]);return x.createElement(x.Fragment,null,s&&x.createElement(wa,{graph:s,dashboardId:t,panelId:e.id,data:l[0],onFilterRulesChange:b}),x.createElement(Q,{ml:"10px",width:"calc(100% - 20px)",height:"100%",ref:o}),x.createElement(Ea,{data:Ma,iconSize:"0.8rem"}),s&&x.createElement(Q,null,x.createElement(Pa,{dashboardId:t,panelId:e.id,selected:d,graph:s,onSelectChange:S,data:l})))},xo=(l,e)=>{l.getEdges().forEach(t=>{l.updateItem(t,{labelCfg:e})})},So=(l,e,t,r,i)=>{const a=Wr(t),n=Rr(t,i.plugins.nodeGraph);e[0].nodes.forEach(s=>{s.labelCfg?s.labelCfg.style.fill=t=="light"?"#000":"#fff":s.labelCfg=a;const f=Gr(i.plugins.nodeGraph,t);s.stateStyles||(s.stateStyles={}),Object.keys(f).forEach(u=>{s.stateStyles[u]=f[u]})}),e[0].edges.forEach(s=>{s.labelCfg?s.labelCfg.style.fill=t=="light"?"#000":"#fff":s.labelCfg=n,s.style.stroke=t=="light"?de(i.plugins.nodeGraph.edge.color.light,t):de(i.plugins.nodeGraph.edge.color.dark,t);const f=Vr(i.plugins.nodeGraph,t);s.stateStyles||(s.stateStyles={}),Object.keys(f).forEach(u=>{s.stateStyles[u]=f[u]})});const o=et(e[0],r,i.id);l.data(o),l.render()},Br=(l,e,t,r,i)=>{Dr(l.plugins.nodeGraph,e[0],t);const a=et(e[0],r,l.id);a!=e[0]?(i.data(a),i.render()):i.changeData(a)};export{Mo as default};
