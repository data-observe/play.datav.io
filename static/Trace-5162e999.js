import{gL as Ue,a3 as j,bm as Ke,gM as me,r as t,ad as he,dq as ne,bk as z,dt as be,gN as Z,au as k,as as Qe,ce as Ye,ds as O,gO as Ze,gP as et,a$ as A,V as e,b1 as tt,b2 as q,bi as ye,aL as ke,bl as K,aS as F,b9 as at,ba as ue,ac as re,aN as C,aQ as f,b0 as G,an as nt,ar as rt,cO as ee,ay as D,ao as we,a7 as te,aV as Q,c1 as st,ez as lt,ek as ot,gQ as ct,e2 as Ne,b7 as it,bg as mt,bV as Ie,bW as Me,bZ as ze,cH as Le,cI as Oe,aR as de,b as ce,ab as pe,aU as ut,bd as dt,a5 as pt,M as ft,a8 as gt,a9 as Et,aF as ht,aP as ae,aO as bt,aa as yt,b5 as St,cl as ie,cu as vt,gR as xt,dl as Y,gS as Ct,eI as Dt}from"./index-3a76b207.js";import{b as Se,i as Tt,E as kt,d as wt,e as Nt,h as It,a as Mt,D as Fe,L as zt,j as Lt,t as Ot}from"./transform-trace-data-def61dd7.js";import{o as Pe,q as J,r as ve,C as Ft,t as Pt}from"./index-9076ce45.js";import{f as fe,g as Re}from"./useLandscapeMode-e7a72966.js";const oe=new Map,Rt=({timeRange:a,dashboardId:n,panel:r,onSearch:s,onSearchIds:u})=>{const[m]=Ue(),o=j(Ke),d=j(me),[g,l]=t.useState(!1),[c,y]=t.useState([]),[v,T]=t.useState([]),w=t.useMemo(()=>he.get(Se+n+r.id)??{},[]),[N,B,E,h,i,p,M]=$t(m,r,w),[b,L]=t.useState(N),[x,X]=t.useState(B),[I,Ve]=t.useState(E),[P,He]=t.useState(h),[R,qe]=t.useState(i),[$,Je]=t.useState(p),[V,We]=t.useState(M),[_,je]=t.useState(!0),se=ne(r.datasource.id);t.useEffect(()=>()=>{delete oe[n+r.id]},[]),t.useEffect(()=>{g&&(z(V)?b&&x&&s(b,x,I,R,P,$):u(V))},[a]),t.useEffect(()=>{Ge()},[se.type]),t.useEffect(()=>{b?(ge(),s(b,x,I,R,P,$,_)):T([])},[b]),t.useEffect(()=>{if(be(x))return;const S=Z(b),H=oe[n+r.id];k.isEqual(S,H)||Ae()},[o]);const Ae=async()=>{ge(),s(b,x,I,R,P,$,_)};Qe(Ye,()=>{z(V)?(z(b)||(J.service=b),z(x)||(J.operation=x),z(I)||(J.tags=I),z(P)||(J.max=P),z(R)||(J.min=R),z($)||(J.limit=$)):J.traceIds=V},[b,x,I,P,R,$,V]);const Ge=async()=>{switch(se.type){case O.Jaeger:const S=await Ze(r.datasource.id),H=k.sortBy(S);y(H),H.length>0&&z(b)&&L(H[0]),setTimeout(()=>{l(!0)},500);break}},ge=async S=>{switch(se.type){case O.Jaeger:const H=S??Z(b);oe[n+r.id]=H;const _e=await Promise.all(H.map(le=>et(r.datasource.id,le))),Ee=k.sortBy(k.uniq(_e.filter(le=>le).flat()));T(["all"].concat(Ee)),be(x)||(!x||!Ee.includes(x))&&X("all");break}},Xe=()=>{z(V)?(s(b,x,I,R,P,$,_),he.set(Se+n+r.id,{service:b,operation:x,tags:I,min:R,max:P,limit:$})):u(V)},[W]=A(G),U="sm";return e.createElement(e.Fragment,null,e.createElement(tt,{spacing:W?4:2,fontSize:W?"0.8rem":"0.7rem"},e.createElement(q,{title:"Service",spacing:1},r.plugins.trace.enableEditService?e.createElement(ye,{value:b,options:c.map(S=>({label:S,value:S})),size:U,onChange:S=>L(S)}):e.createElement(ke,{value:b,disabled:!0,size:U})),e.createElement(q,{title:"Operation",spacing:1},e.createElement(ye,{value:x,options:v.map(S=>({label:S,value:S})),size:U,onChange:S=>X(S)})),e.createElement(q,{title:"Tags",spacing:1},e.createElement(K,{value:I,placeholder:"e.g http.status_code=200 error=true",onChange:S=>Ve(S)})),e.createElement(F,{flexDir:W?"row":"column",gap:1},e.createElement(q,{title:d.maxDuration,spacing:1},e.createElement(K,{value:P,placeholder:"e.g 1.2s,100ms",onChange:S=>He(S)})),e.createElement(q,{title:d.minDuration,spacing:1},e.createElement(K,{value:R,placeholder:"e.g 1.2s,100ms",onChange:S=>qe(S)}))),e.createElement(q,{title:d.limitResults,spacing:1},e.createElement(at,{value:$,min:0,onChange:S=>Je(S),size:"md"})),e.createElement(ue,{pt:"2"}),e.createElement(q,{title:"Trace ids",spacing:1,desc:d.traceIdsTips},e.createElement(K,{placeholder:d.traceIdsInputTips,value:V,onChange:S=>We(S),size:"md"})),e.createElement(F,{flexDir:W?"row":"column",gap:1},e.createElement(re,{width:W?"150px":null,size:U,onClick:Xe},W?d.findTraces:"Search"),e.createElement(C,{spacing:1},e.createElement(Pe,{isChecked:_,onChange:S=>je(S.currentTarget.checked)}),e.createElement(f,{opacity:"0.7"},d.useLatestTime)))))},$t=(a,n,r)=>{let s;const u=a.get("service");z(u)?n.plugins.trace.enableEditService?s=r.service??null:s=n.plugins.trace.defaultService:s=u;const m=a.get("operation")??r.operation??null,o=a.get("tags")??r.tags??"",d=a.get("max")??r.max??"",g=a.get("min")??r.min??"",l=a.get("limit")??r.limit??20,c=a.get("traceIds")??null;return[s,m,o,d,g,l,c]};var $e={};(function(a){a.debug=!1,a.parse=function(n){var r="",s="",u=!1,m=!1,o=!1,d=!1,g={},l=a.debug;n[n.length-1]==`
`&&(n=n.slice(0,n.length-1));for(var c=0;c<=n.length;c++){if(n[c]==" "&&!o||c==n.length){if(u&&r.length>0?g[r]=!0:m&&(s=="true"?s=!0:s=="false"?s=!1:s===""&&!d&&(s=null),g[r]=s,s=""),c==n.length)break;u=!1,m=!1,o=!1,d=!1}n[c]=="="&&!o?(l&&console.log("split"),u=!1,m=!0):n[c]=="\\"?(c++,s+=n[c],l&&console.log("escape: "+n[c])):n[c]=='"'?(d=!0,o=!o,l&&console.log("in quote: "+o)):n[c]!=" "&&!m&&!u?(l&&console.log("start key with: "+n[c]),u=!0,r=n[c]):u?(l&&console.log("add to key: "+n[c]),r+=n[c]):m&&(l&&console.log("add to value: "+n[c]),s+=n[c])}return g}})($e);const Bt=nt($e),Vt=t.memo(({traces:a,timeRange:n,onSelect:r,height:s})=>{const u=j(me),m=j(we),[o,d]=t.useState(null),{colorMode:g}=rt(),[l,c,y,v]=t.useMemo(()=>{let E,h;const i=[],p=[];for(const L of a){const x=k.round(L.startTime/1e3);(x<E||!E)&&(E=x),(x>h||!h)&&(h=x);const X=L.duration/1e3,I=[x,X,L.traceID,L.traceName];Tt(L)?p.push(I):i.push(I)}const M=n.start.getTime(),b=n.end.getTime();return E>M&&(E=M),h<b&&(h=b),[E,h,i,p]},[a]);t.useEffect(()=>(o&&(o.on("click",function(E){r([E.data[2]])}),o.on("brushSelected",function(E){const h=[],i=E.batch[0].selected;for(const p of i)for(const M of p.dataIndex)p.seriesName=="Success"?h.push(y[M][2]):h.push(v[M][2]);h.length>0&&r(h)}),o.on("brushEnd",function(){setTimeout(()=>{o.dispatchAction({type:"brush",areas:[]})},200)}),o.dispatchAction({type:"takeGlobalCursor",key:"brush",brushOption:{brushType:"rect"}})),()=>{o&&(o.off("click"),o.off("brushSelected"),o.off("brushEnd"))}),[o,a]),t.useEffect(()=>{o&&o.dispatchAction({type:"takeGlobalCursor",key:"brush",brushOption:{brushType:"rect"}})},[g,a]);const w={type:"scatter",itemStyle:{opacity:.8,shadowBlur:10,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0,0,0,0.3)"},symbolSize:function(E){let h=Math.sqrt(E[1]);return h<20?h=20:h>50&&(h=50),h},emphasis:{focus:"self"}},[N]=A(G),B=t.useMemo(()=>({brush:{throttleType:"debounce",throttleDelay:100},legend:{top:10,data:["Success","Error"],textStyle:{fontSize:N?13:10}},grid:{left:"50px",right:"40px",top:"18%",bottom:"10%"},tooltip:{backgroundColor:"rgba(255,255,255,0.9)",trigger:"item",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},formatter:function(E){var h=E.value;return'<div style="border-bottom: 1px solid rgba(255,255,255,.3); font-size: 18px;padding-bottom: 7px;margin-bottom: 7px">'+h[3]+`</div><div>${u.startTime}: <span style="font-size:16px;font-weight:500">`+ee(h[0]).format("yy-MM-DD HH:mm:ss")+`</span></div><div style="margin-top:5px">${m.duration}: <span style="font-size:16px;font-weight:500;">`+h[1]+"ms</span></div>"}},xAxis:{type:"time",nameTextStyle:{fontSize:16},splitLine:{show:!1},axisLabel:{formatter:function(E){return ee(E).format("MM-DD HH:mm:ss")},fontSize:N?12:10},min:l,max:c,splitNumber:2},yAxis:{type:"value",name:"Duration",nameLocation:"end",nameGap:20,splitLine:{show:!0},splitNumber:3,axisLabel:{formatter:function(E,h){return E+"ms"},fontSize:N?12:10},nameTextStyle:{align:"right"}},series:[{...w,name:"Error",data:v,color:ve("#dd4444",.7)},{...w,name:"Success",data:y,color:ve("#80F1BE",.7)}]}),[g,a]);return e.createElement(e.Fragment,null,B&&e.createElement(D,{width:"100%",key:g,className:"echarts-panel"},e.createElement(Ft,{height:s,options:B,theme:g,onChartCreated:E=>d(E)})))}),Be=({trace:a,maxDuration:n,checked:r=!1,onChecked:s=null,simple:u=!1,checkDisabled:m=!1,dsId:o=null})=>{const d=ee(a.startTime/1e3),g=d.format("h:mm:ss a"),l=ne(o),c=()=>{l&&window.open(`/trace/${a.traceID}/${l.id}/`)},[y]=A(G);return e.createElement(D,{width:"100%",className:"bordered",borderRadius:"0",cursor:"pointer",onClick:c,fontSize:y?"sm":"xs"},e.createElement(D,{width:"100%",position:"relative",className:"label-bg"},e.createElement(C,{spacing:0,py:"5px"},s&&e.createElement(F,{alignItems:"center",px:"2",zIndex:2,onClick:v=>{v.stopPropagation()}},e.createElement(Pe,{defaultChecked:r,isChecked:r,isDisabled:m,bg:te("white","transparent"),onChange:v=>s(a.traceID)})),e.createElement(D,{width:`${a.duration/n*100}%`,bg:te("#d7e7ea","brand.800"),height:"100%",position:"absolute",top:"0"}),e.createElement(F,{alignItems:"center",width:"100%",justifyContent:"space-between",position:"relative",pr:"2"},e.createElement(F,{flexDir:y?"row":"column",gap:y?1:0},e.createElement(f,null,a.traceName),e.createElement(f,{opacity:"0.7"},a.traceID.slice(0,7))),e.createElement(f,{minWidth:"fit-content"},fe(a.duration))))),e.createElement(F,{flexDir:y?"row":"column",alignItems:y?"center":"start",width:"100%",justifyContent:y?"space-between":null,pt:y?4:2,pb:y?3:1,px:y?2:1},e.createElement(D,null,e.createElement(C,{alignItems:"top"},e.createElement(Q,{size:"md",variant:"subtle",colorScheme:"gray",bg:"transparent",className:"bordered",fontSize:"0.7rem"},a.spans.length," Spans"),e.createElement(Q,{size:"md",variant:"subtle",colorScheme:"gray",bg:"transparent",className:"bordered",fontSize:"0.7rem"},Object.keys(a.processes).length," Services"),a.errorsCount>0&&e.createElement(Q,{size:"md",variant:"subtle",colorScheme:"red",className:"bordered",fontSize:"0.8rem"},a.errorsCount," Errors")),!u&&e.createElement(st,{mt:y?4:2,spacingX:3},k.sortBy(a.services,v=>v.name).map(v=>{const{name:T,numberOfSpans:w}=v;return e.createElement(lt,{key:T},e.createElement(Q,{variant:"subtle",colorScheme:"gray",bg:"transparent",className:"bordered",borderLeft:`12px solid ${ot.getColorByKey(T)}`,size:"sm",borderRadius:4,opacity:.8},a.errorServices.has(T)&&e.createElement(ct,{color:"red",as:Ne}),e.createElement(it,null,T," ",w)))}))),e.createElement(D,{mt:y?0:2},!u&&e.createElement(C,{spacing:1},e.createElement(f,{className:"bordered-right",pr:"1"},Re(a.startTime/1e3)),e.createElement(f,null,g)),y&&e.createElement(f,{mt:"1"},d.fromNow()))))};const xe=Math.abs,Ht=Math.max;class qt extends t.PureComponent{render(){const{a:n,b:r,operation:s,service:u,dataA:m,dataB:o}=this.props,d=n===r,g=mt({"is-same":d,"is-changed":!d,"is-more":r>n&&n>0,"is-added":n===0,"is-less":n>r&&r>0,"is-removed":r===0}),l=n<r?"+":"-",c=t.createElement("table",{className:`DiffNode ${g}`,style:{fontSize:"1.4rem"}},t.createElement("tbody",{className:"DiffNode--body"},t.createElement("tr",null,t.createElement("td",{className:`DiffNode--metricCell ${g}`,rowSpan:d?2:1},d?null:t.createElement("span",{className:"DiffNode--metricSymbol"},l),d?n:xe(r-n)),t.createElement("td",{className:`DiffNode--labelCell ${g}`},t.createElement("strong",null,u))),t.createElement("tr",null,d?null:t.createElement("td",{className:`DiffNode--metricCell ${g}`},t.createElement("span",{className:"DiffNode--metricSymbol"},l),n===0||r===0?100:xe((n-r)/Ht(n,r)*100).toFixed(0),t.createElement("span",{className:"DiffNode--metricSymbol"},"%")),t.createElement("td",{className:`DiffNode--labelCell ${g}`},s))));return t.createElement(Ie,{trigger:"hover",openDelay:200,placement:"auto"},t.createElement(Me,null,c),t.createElement(Pt,null,t.createElement(ze,{minWidth:"800px"},t.createElement(Le,null),t.createElement(Oe,null,t.createElement(C,{spacing:4,divider:t.createElement(de,null),alignItems:"top",maxH:"400px",overflowY:"auto"},(m==null?void 0:m.length)>0&&t.createElement(D,{width:"50%"},t.createElement(Ce,{service:u,operation:s,data:m,data1:o})),(o==null?void 0:o.length)>0&&t.createElement(D,{width:"50%"},t.createElement(Ce,{service:u,operation:s,data:o,data1:m})))))))}}function Jt(a){const{a:n,b:r,operation:s,service:u}=a.data,m=n?n.length:0,o=r?r.length:0;return t.createElement(qt,{a:m,b:o,operation:s,service:u,dataA:n,dataB:r})}function Wt(a){return function(r){return a.has(r.vertex.key)?t.createElement(kt,{height:r.height,width:r.width}):null}}const Ce=({service:a,operation:n,data:r,data1:s})=>{const[u,m]=t.useState(null),[o,d]=t.useState(null),g=l=>{const c=k.cloneDeep(l.span);return delete c.references,JSON.stringify(c,null,1)};return t.createElement(t.Fragment,null,t.createElement(F,{fontSize:"1rem",justifyContent:"space-between",alignItems:"center"},t.createElement(C,null,t.createElement(f,null,a,":"),t.createElement(f,null,n)),t.createElement(f,{fontSize:"0.8rem",opacity:"0.7"},r[0].span.traceID.slice(0,7))),t.createElement(f,{fontSize:"0.9rem",opacity:"0.8",mt:"1"},"Spans numbers: ",t.createElement(ce.span,{color:"brand.500",fontWeight:"600"},r.length)),t.createElement(ue,{mt:"2"}),t.createElement(pe,{alignItems:"left",mt:"2",divider:t.createElement(de,null),fontSize:"0.8rem"},r.map((l,c)=>{var y;return t.createElement(D,null,t.createElement(F,{justifyContent:"space-between",alignItems:"center",onMouseEnter:()=>m(l),onMouseLeave:()=>m(null)},t.createElement(D,null,t.createElement(C,null,t.createElement(f,null,"Span ID: ",l.id," "),l.span.tags.some(wt)&&t.createElement(ut,{label:"There is a error in this span, click to see details"},t.createElement(D,null,t.createElement(Ne,{color:"red"})))),t.createElement(f,null,"Duration: ",t.createElement(ce.span,{color:l.span.duration>(s?(y=s[c])==null?void 0:y.span.duration:0)?"orange":"inherit",fontWeight:"600"},fe(l.span.duration)))),(u==null?void 0:u.id)==l.id&&t.createElement(re,{size:"xs",variant:"ghost",onClick:()=>d(o!=l.id?l.id:null)},o!=l.id?"View detail":"Hide detail"," ")),o==l.id&&t.createElement(D,{height:"300px"},t.createElement(dt,{fontSize:8,value:g(l),readonly:!0})))})))},{classNameIsSmall:jt,scaleOpacity:At,scaleStrokeOpacity:Gt}=Fe.propsFactories,Xt=({traceA:a,traceB:n})=>{const[r,s]=t.useState(null),[u,m]=t.useState(""),o=Nt.makeScope();t.useEffect(()=>{const c=new zt({useDotEdges:!0,splines:"polyline"});return s(c),()=>{c.stopAndRelease()}},[]);const{edges:d,vertices:g}=It(a,n),l=Mt(u,g);return e.createElement(e.Fragment,null,e.createElement(D,{position:"absolute",top:"0",bottom:"0",left:"0",right:"0",bg:te("#f7f9fb","inherit"),sx:{".DiffNode.is-same":{background:te("#f7f9fb","#2D3748")}}},r&&e.createElement(Fe,{key:`${a.traceID} vs ${n.traceID}`,minimap:!0,zoom:!0,minimapClassName:"u-miniMap",layoutManager:r,measurableNodesKey:"nodes",layers:[{key:"emphasis-nodes",layerType:"svg",renderNode:Wt(l)},{key:"edges",layerType:"svg",edges:!0,defs:[{localId:"arrow"}],markerEndId:"arrow",setOnContainer:o("edges/container",[At,Gt,{stroke:"#bbb",fill:"#bbb"}])},{renderNode:Jt,key:"nodes",measurable:!0,layerType:"html"}],setOnGraph:jt,edges:d,vertices:g})),e.createElement(D,{position:"absolute",right:"20px",bottom:"20px",width:"200px"},e.createElement(ke,{value:u,onChange:c=>m(c.currentTarget.value),placeholder:"find..",className:"highlight-bordered"})))},_t=({traces:a})=>{const n=j(we),{isOpen:r,onOpen:s,onClose:u}=pt(),m=()=>{s()};return e.createElement(e.Fragment,null,e.createElement(re,{size:"sm",variant:"outline",onClick:m,isDisabled:a.length<=1},n.compore),e.createElement(ft,{isOpen:r,onClose:u,size:"full"},e.createElement(gt,null),a.length==2&&e.createElement(Et,null,e.createElement(ht,{p:"0"},e.createElement(C,null,e.createElement(D,{width:"47%",className:"bordered",p:"3"},e.createElement(De,{trace:a[0]})),e.createElement(ae,{width:"6%"},e.createElement(f,{fontSize:"1.5rem",color:"brand.500"},"VS")),e.createElement(D,{width:"47%",className:"bordered",p:"3"},e.createElement(De,{trace:a[1]})))),e.createElement(bt,{left:"49%",top:"0"}),e.createElement(yt,{position:"relative"},e.createElement(Xt,{traceA:a[0],traceB:a[1]})))))},De=({trace:a})=>{const r=ee(a.startTime/1e3).format("h:mm:ss a");return e.createElement(e.Fragment,null,e.createElement(C,null,e.createElement(f,null,a.traceName),e.createElement(f,null,a.traceID.slice(0,7))),e.createElement(ue,{mt:"2"}),e.createElement(F,{justifyContent:"space-between",alignItems:"center",fontSize:"0.85rem",mt:"2"},e.createElement(C,null,e.createElement(C,null,e.createElement(f,{opacity:"0.7"},"Duration:"),e.createElement(f,null,fe(a.duration))),e.createElement(C,null,e.createElement(f,{opacity:"0.7"},"Spans:"),e.createElement(f,null,a.spans.length)),e.createElement(C,null,e.createElement(f,{opacity:"0.7"},"Services:"),e.createElement(f,null,a.services.length)),e.createElement(C,null,e.createElement(f,{opacity:"0.7"},"Errors:"),e.createElement(f,{color:"red"},a.errorsCount))),e.createElement(C,null,e.createElement(f,{className:"bordered-right",pr:"1"},Re(a.startTime/1e3)),e.createElement(f,null,r))))},Ut=({panel:a,traces:n,timeRange:r,height:s})=>{const u=j(me),[m,o]=t.useState([]),[d,g]=t.useState(Te[0].value),[l,c]=t.useState([]);t.useEffect(()=>{o(k.clone(n)),c([])},[n]);const y=t.useMemo(()=>Math.max(...n.map(i=>i.duration)),[n]),v=t.useCallback(i=>{const p=n.filter(M=>i.includes(M.traceID));o(p)},[]),T=t.useMemo(()=>{switch(d){case"recent":return m.sort((i,p)=>p.startTime-i.startTime);case"mostErrors":return m.sort((i,p)=>p.errorsCount-i.errorsCount);case"longest":return m.sort((i,p)=>p.duration-i.duration);case"shortest":return m.sort((i,p)=>i.duration-p.duration);case"mostSpans":return m.sort((i,p)=>p.spans.length-i.spans.length);case"leastSpans":return m.sort((i,p)=>i.spans.length-p.spans.length);default:return n}},[m,d]),w=i=>{l.includes(i)?k.remove(l,p=>p==i):l.push(i),c([...l])},N=l.map(i=>n.find(p=>p.traceID==i)).filter(i=>i),B=i=>{k.remove(l,p=>p==i),c([...l])},[E]=A(G),h=200;return e.createElement(D,{pl:"2"},e.createElement(Vt,{traces:n,timeRange:r,onSelect:v,height:h}),e.createElement(D,{pl:"2",pr:"20px"},e.createElement(F,{alignItems:"center",justifyContent:"space-between",mb:"1",fontSize:E?null:"xs"},e.createElement(C,{height:"40px",textStyle:E?"title":null},m.length!=n.length?e.createElement(f,null,m.length," ",u.tracesSelected):e.createElement(f,null,m.length," ",u.tracesTotal),m.length!=n.length&&e.createElement(re,{size:"sm",variant:"outline",onClick:()=>o(k.clone(n))},u.clearSelection)),l.length>0&&e.createElement(C,{textStyle:"title"},e.createElement(f,null,e.createElement(Kt,{removeFromCompare:B,comparedTraces:N,maxDuration:y})," ",u.selectForCompre),e.createElement(_t,{traces:N})),e.createElement(C,{alignItems:"center"},e.createElement(f,{minWidth:"fit-content"},"排序"),e.createElement(St,{size:E?"sm":"xs",value:d,onChange:i=>g(i.currentTarget.value)},Te.map(i=>e.createElement("option",{key:i.value,value:i.value},u[i.value]))))),e.createElement(pe,{alignItems:"left",maxH:s-h},e.createElement(ie,null,T.map(i=>e.createElement(Be,{key:i.traceID,trace:i,maxDuration:y,checked:l.includes(i.traceID),checkDisabled:l.length>=2&&!l.includes(i.traceID),onChecked:w,dsId:a.datasource.id}))))))},Kt=({comparedTraces:a,maxDuration:n,removeFromCompare:r})=>e.createElement(e.Fragment,null,e.createElement(Ie,{trigger:"hover",placement:"left"},e.createElement(Me,null,e.createElement(ce.span,{color:"brand.500",cursor:"pointer"},a.length)),e.createElement(ze,{minWidth:"500px"},e.createElement(Le,null),e.createElement(Oe,null,e.createElement(pe,{alignItems:"left",divider:e.createElement(de,null)},a.map(s=>s&&e.createElement(C,{spacing:2},e.createElement(Be,{trace:s,maxDuration:n,simple:!0}),e.createElement(vt,{cursor:"pointer",onClick:()=>r(s.traceID)})))))))),Te=[{label:"Most Recent",value:"recent"},{label:"Most Errors",value:"mostErrors"},{label:"Longest Duruation",value:"longest"},{label:"Shortest Duruation",value:"shortest"},{label:"Most Spans",value:"mostSpans"},{label:"Least Spans",value:"leastSpans"}],na=t.memo(a=>{const n=ne(a.panel.datasource.id);return Lt(a.data)?(console.log("here33333: ",a.data),e.createElement(e.Fragment,null,n.type!=O.Jaeger&&n.type!=O.TestData?e.createElement(ae,{height:"100%"},"Trace panel only support Jaeger and Testdata datasource"):e.createElement(Qt,{...a}))):e.createElement(ae,{height:"100%"},"Trace panel only support Jaeger and Testdata datasource!")}),Qt=a=>{const[n,r]=t.useState(null),s=ne(a.panel.datasource.id);t.useEffect(()=>{s.type==O.TestData&&u(null,null,null,null,null,null,!0)},[s.type,a.data]);const u=async(c,y,v,T,w,N,B)=>{v=Yt(v);let E=xt();switch(B||(E=a.timeRange),s.type){case O.Jaeger:v=Y(v),T=Y(T),w=Y(w),N=Y(N);const h=Z(c),i=Z(y,"all"),p=[];for(const b of h)for(const L of i)p.push(Ct(a.panel.datasource.id,E,b,L,v,T,w,N));const M=await Promise.all(p);r(k.uniqBy(M.filter(b=>b).flat(),b=>b.traceID));break;case O.TestData:r(k.uniqBy(k.cloneDeep(a.data).flat().filter(b=>b).flat(),b=>b.traceID));break;default:r([]);break}},m=c=>{const y=c.split(",");switch(s.type){case O.Jaeger:Promise.all(y.map(v=>Dt(a.panel.datasource.id,v))).then(v=>{r(v.filter(T=>T).flat())});break;default:r([]);break}},o=t.useMemo(()=>n==null?void 0:n.map(Ot),[n]),d=a.height-7,[g]=A(G),l=g?"400px":"120px";return e.createElement(e.Fragment,null,s.type!=O.Jaeger&&s.type!=O.TestData?e.createElement(ae,{height:"100%"},"No data"):e.createElement(C,{alignItems:"top",px:"2",py:"1"},e.createElement(D,{width:l,pt:"2",pl:"1",maxH:a.height},e.createElement(ie,null,e.createElement(Rt,{timeRange:a.timeRange,dashboardId:a.dashboardId,panel:a.panel,onSearch:u,onSearchIds:m}))),e.createElement(D,{width:`calc(100% - ${l})`,maxH:d},e.createElement(ie,null,o&&e.createElement(Ut,{traces:o,panel:a.panel,timeRange:a.timeRange,height:d})))))};function Yt(a){if(!a)return"";const n=Bt.parse(a);return Object.keys(n).forEach(r=>{const s=n[r];typeof s!="string"&&(n[r]=String(s))}),JSON.stringify(n)}export{Yt as convTagsLogfmt,na as default};
