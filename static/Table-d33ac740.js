import{V as o,eT as ae,eU as H,r as T,aN as ce,aQ as de,bk as y,av as pe,aZ as ge,ar as ue,au as E,eV as he,d1 as V,bU as M,dl as ne,dz as be,cO as xe,d5 as _e,ay as U,aU as Ce,ac as ye,d2 as oe,ad as le,eW as re,aP as A,df as we,aS as Ee,cl as ve,b5 as Se}from"./index-3a76b207.js";import{c as ke,d as h,i as p,a as Ie,j as Te,k as De,l as Fe,h as Ne}from"./index-9076ce45.js";import{B as ze}from"./BarGauge-2322fffd.js";import{b as Me}from"./Table-c8993972.js";import"./useLandscapeMode-e7a72966.js";const ie=(a,u,s)=>{if(u.length>0){const c=u[0][a.dataIndex];s=s??(typeof c=="number"?"number":"string"),s=="number"?(a.onFilter=(e,i)=>{let t=null,m=null;if(e){const l=e.toString().split("-");l.length==2&&(l[0].trim()==""?t=null:t=Number(l[0]),l[1].trim()==""?m=null:m=Number(l[1]))}if(t==null&&m==null)return!0;if(isNaN(t)||isNaN(m))return!1;const x=i[a.dataIndex];return!(t!==null&&x<t||m!=null&&x>m)},a.filterDropdown=({setSelectedKeys:e,selectedKeys:i,confirm:t,clearFilters:m,close:x})=>o.createElement("div",{style:{padding:8},onKeyDown:l=>l.stopPropagation()},o.createElement(Pe,{onChange:l=>{e(l?[l]:[])},value:i[0]}),o.createElement(ae,{type:"primary",onClick:()=>t({closeDropdown:!1}),size:"small",style:{marginTop:8}},"Search"))):(a.filterDropdown=({setSelectedKeys:e,selectedKeys:i,confirm:t,clearFilters:m,close:x})=>o.createElement("div",{style:{padding:8},onKeyDown:l=>l.stopPropagation()},o.createElement(H,{placeholder:`Search ${a.dataIndex}`,value:i[0],onChange:l=>e(l.target.value?[l.target.value]:[]),onPressEnter:()=>t({closeDropdown:!1}),style:{display:"block"}}),o.createElement(ae,{type:"primary",onClick:()=>t({closeDropdown:!1}),size:"small",style:{width:90,marginTop:8}},"Search")),a.onFilter=(e,i)=>i[a.dataIndex].toString().toLowerCase().includes(e.toLowerCase()))}a.filterSearch=!0},Pe=({value:a,onChange:u})=>{const[s,c]=T.useState(""),[e,i]=T.useState("");return T.useEffect(()=>{if(a){const t=a.split("-");t.length==2&&(c(t[0]),i(t[1]))}},[a]),o.createElement(ce,null,o.createElement(H,{placeholder:"min",value:s,onChange:t=>c(t.target.value),onBlur:()=>u(`${s}-${e}`)}),o.createElement(de,{minW:"fit-content"},"to"),o.createElement(H,{placeholder:"max",value:e,onChange:t=>i(t.target.value),onBlur:()=>u(`${s}-${e}`)}))},se=(a,u)=>{let s,c;for(const e of u)if(!y(e.text)){if(e.type=="value"&&e.value==a){s=e.text,c=e.color;break}else if(e.type=="range"&&a>=e.value.from&&a<=e.value.to){s=e.text,c=e.color;break}else if(e.type=="null"&&y(a)){s=e.text,c=e.color;break}else if(e.type=="regex"&&(a!=null&&a.toString().match(e.value))){s=e.text,c=e.color;break}}return[s,c]},Be="tablePage",Oe=T.memo(a=>{var I;const u=pe();ge();const{colorMode:s}=ue(),{dashboardId:c,panel:e}=a,i=E.cloneDeep(a.data),t=a.panel.plugins.table,m=Be+c+e.id,x=(f,n)=>{le.set(m,n)},l=t.cellSize=="small"?"8px 8px":t.cellSize=="large"?"16px 16px":"12px 8px",v=[];for(const f of a.columns){const n=E.cloneDeep(f),d=ke(e,n.dataIndex);if(h(d,p.ColumnDisplay)===!1)continue;t.column.align!="auto"?n.align=t.column.align:i.length>0&&(typeof i[0][n.dataIndex]=="number"?n.align="right":n.align="left");const D=h(d,p.ColumnWidth);D&&(n.width=D);const N=h(d,p.ColumnFixed);N&&(n.fixed=N);const P=h(d,p.ColumnSort);(t.column.enableSort||P)&&(n.sorter=(r,g)=>r.__value__[n.dataIndex]>=g.__value__[n.dataIndex]?1:-1,n.sortDirections=["descend","ascend","descend"],P&&(n.defaultSortOrder=P));const K=h(d,p.ColumnFilter);K?ie(n,i,K):t.column.enableFilter&&ie(n,i);const B=h(d,p.ColumnUnit),O=h(d,p.ColumnDecimal)??he,j=h(d,p.ColumnTransform);let W;j&&(W=V(j));const G=E.isFunction(W),S=h(d,p.ColumnThreshold),w=h(d,p.ColumnType);let R,Q;if(w||(S==null?void 0:S.mode)==Ie.Percentage){const r=i.map(g=>g[n.dataIndex]);R=Math.max(...r),Q=Math.min(...r)}let z=h(d,p.ColumnBg);z=M(z,s);let $=0;const Z=h(d,p.ColumnColor),q=h(d,p.ColumnValueMapping);if(B||O||G||S||w||e.valueMapping.length>0)for(const r of i){let g="inherit";Z&&(g=Z);const _=r[n.dataIndex];if(r.__value__={...r.__value__,[n.dataIndex]:_},z&&(r.__bg__={...r.__bg__,[n.dataIndex]:z}),S&&E.isNumber(_)){const b=Te(_,S,R);if(b){const C=M(b.color,s);r.__bg__={...r.__bg__,[n.dataIndex]:C}}}let F=!1;if(((I=e.valueMapping)==null?void 0:I.length)>0){const[b,C]=se(_,e.valueMapping);b&&(r[n.dataIndex]=ne(b,{[re]:_}),F=!0,y(C)||(g=C))}if(q){const[b,C]=se(_,q);b&&(r[n.dataIndex]=ne(b,{[re]:_}),F=!0,y(C)||(g=C))}if(F||(B?r[n.dataIndex]=De(_,B.units,O):E.isNumber(_)&&(r[n.dataIndex]=E.round(_,O))),G&&(r[n.dataIndex]=W(r[n.dataIndex],be,xe)),(w==null?void 0:w.type)=="gauge"){const b=_e(r[n.dataIndex].toString()).width;b>$&&($=b)}g=M(g,s),g&&(r.__color__={...r.__color__,[n.dataIndex]:g})}const J=h(d,p.ColumnEllipsis),me=h(d,p.ColumnOpacity);n.render=(r,g,_)=>{var C,Y;const F=(C=g.__bg__)==null?void 0:C[n.dataIndex],b=(Y=g.__color__)==null?void 0:Y[n.dataIndex];return(w==null?void 0:w.type)=="gauge"?o.createElement(Fe,null,({width:ee,height:fe})=>{var te;return ee===0?null:o.createElement(U,{position:"absolute",top:"6px",left:"6px",right:"6px",bottom:"6px"},o.createElement(ze,{width:ee,height:fe,data:[{value:(te=g.__value__)==null?void 0:te[n.dataIndex],max:R,min:Q,text:r,color:b}],textWidth:$,threshods:S,showUnfilled:!0,fillOpacity:me??.6,mode:w.mode}))}):o.createElement(U,{padding:l,bg:F},o.createElement(Ce,{label:J?r:null,openDelay:300},o.createElement(de,{color:b??"inherit",wordBreak:"break-all",noOfLines:J?1:null},r)))};const X=Ne(e,n.dataIndex,p.ColumnTitle);X&&(n.title=X),v.push(n)}t.rowActions.length>0&&t.rowActions.some(f=>!y(f.name))&&v.push({title:y(t.actionColumnName)?"Action":t.actionColumnName,key:"action",width:y(t.actionClumnWidth)?90*t.rowActions.length:t.actionClumnWidth,render:(f,n)=>o.createElement(ce,{spacing:1},a.panel.plugins.table.rowActions.map((d,L)=>{if(y(d.name))return;const D=V(d.action);return o.createElement(ye,{key:L+d.name,colorScheme:d.color,variant:d.style,size:t.actionButtonSize,onClick:N=>{N.stopPropagation(),E.isFunction(D)?oe(D,n):u({title:"Error",description:"The action function you defined is not valid",status:"error",duration:4e3,isClosable:!0})}},d.name)}))});const k=V(a.panel.plugins.table.onRowClick);return o.createElement(o.Fragment,null,o.createElement(Me,{columns:v,dataSource:i,size:t.cellSize,showHeader:t.showHeader,pagination:t.enablePagination?{position:["bottomCenter"],showTotal:f=>`Total ${f}`,total:i.length,showSizeChanger:!0,defaultPageSize:le.get(m)??10,pageSizeOptions:[5,10,20,50,100],onShowSizeChange:x}:!1,sticky:t.stickyHeader,showSorterTooltip:!1,scroll:{x:t.tableWidth+"%"},bordered:t.bordered,rowClassName:t.enableRowClick?"cursor-pointer":null,onRow:t.enableRowClick?f=>({onClick:n=>{E.isFunction(k)?oe(k,f):u({title:"Error",description:"The row click function you defined is not valid",status:"error",duration:4e3,isClosable:!0})}}):null}))}),Le=T.memo(a=>{const{colorMode:u}=ue(),{panel:s}=a;if(y(a.data))return o.createElement(A,{height:"100%"},"No data");if(!we(a.data))return o.createElement(A,{height:"100%"},"Data format not support!");const c=Re(a.data),[e,i]=o.useState(c[0].name),[t,m,x]=T.useMemo(()=>{const l=[],v=[];let k=!1;c.forEach(f=>{f.name==e&&(k=!0),v.push(f.name),l.push(f)});for(var I=0;I<l.length;I++){const f=l[I];if(!k||f.name==e)return k||i(f.name),[f.columns,f.rows,v]}return[[],[],v]},[e,c,a.panel.overrides,s.enableTransform]);return o.createElement(o.Fragment,null,y(m)?o.createElement(A,{height:"100%"},"No data"):o.createElement(Ee,{h:"100%",justify:"space-between",direction:"column"},o.createElement(ve,null,o.createElement(U,{maxH:e&&x.length>1?"calc(100% - 32px)":"100%",sx:We(u,a.panel.plugins.table.column.colorTitle)},o.createElement(Oe,{panel:a.panel,dashboardId:a.dashboardId,columns:t,data:m}))),e&&x.length>1&&o.createElement(Se,{value:e,mt:"1",size:"sm",onChange:l=>i(l.currentTarget.value)},x.map(l=>o.createElement("option",{key:l,value:l},l)))))}),We=(a,u)=>({".ant-table-wrapper":{maxWidth:"calc(100% - 1px) !important"},".ant-table":{background:"transparent !important"},"td.ant-table-cell":{padding:"0 0 !important"},"th.ant-table-cell":{background:"inherit !important",color:`${M(u,a)} !important`},".ant-table-cell.ant-table-column-sort":{background:"inherit !important"},".chakra-table thead tr th input":{background:"transparent",outline:"none"},".pagination":{input:{background:"transparent",outline:"none"}},".ant-table-wrapper .ant-table-tbody >tr >td":{borderBottomWidth:"0.5px"},"th.ant-table-cell:before":{width:"0 !important"}}),Re=a=>{const u=[],s=[];if(a.length==0||a[0].length==0)return u;for(const c of a[0][0].fields)s.push({title:c.name,dataIndex:c.name,key:c.name});if(s.length==0)return u;for(const c of a)for(const e of c){const i=[];for(let m=0;m<e.fields[0].values.length;m++){const x={};for(const l of e.fields)x[l.name]=l.values[m];i.push(x)}const t={columns:s,name:e.name,rawName:e.name,rows:i};u.push(t)}return u};export{Le as default,Re as seriesDataToTableData};
